var K=(U,O,E)=>new Promise((r,m)=>{var N=d=>{try{x(E.next(d))}catch(v){m(v)}},n=d=>{try{x(E.throw(d))}catch(v){m(v)}},x=d=>d.done?r(d.value):Promise.resolve(d.value).then(N,n);x((E=E.apply(U,O)).next())});import{x as Nt,u as Et,j as p,M as et,y as At,f as V,t as ct,n as Ct,z as Dt,B as Y,l as Ot,m as Pt,A as Lt,L as pt,D as It,T as Ut}from"./index-BJ2Ssq_J.js";import{f as ht,h as $t,g as Ft,u as Rt,b as B,m as Mt}from"./vendor-KAqkdx26.js";import{P as G}from"./paimentService-DInxGFTk.js";import{f as dt}from"./date-format-qL-o8H-f.js";import{P as Ht}from"./precommandeService-UY997qkc.js";import"./UserContext-DT4YZ-cJ.js";var Q={},rt,vt;function Tt(){if(vt)return rt;vt=1;function U(O,E){if(!(O&&E&&O.config["PAYDUNYA-MASTER-KEY"]&&O.config["PAYDUNYA-PRIVATE-KEY"]&&O.config["PAYDUNYA-TOKEN"]&&E.name))throw new Error("Invalid parameters;");this.baseURL=O.baseURL,this.config=O.config,E.return_url&&(this.returnURL=E.return_url),E.cancel_url&&(this.cancelURL=E.cancel_url),E.callback_url&&(this.callbackURL=E.callback_url),this.store=E,this.description="",this.items={},this.customData={},this.taxes={},this.channels=[],this.totalAmount=0}return U.prototype.addItem=function(O,E,r,m,N){if(!O)throw new Error("Invalid parameters; name is required.");var n=Object.keys(this.items).length+1;this.items["item_"+n]={name:O,quantity:E||0,unit_price:r||0,total_price:m||0},N&&(this.items["item_"+n].description=N)},U.prototype.addTax=function(O,E){if(!(O&&typeof O=="string"&&typeof Number(E)=="number"))throw new Error("Invalid parameters.");var r=Object.keys(this.taxes).length+1;this.taxes["tax_"+r]={name:O,amount:Number(E)}},U.prototype.addChannel=function(O){if(!(O&&typeof O=="string"))throw new Error("Invalid parameters.");this.channels.push(O)},U.prototype.addChannels=function(O){if(!(O&&O instanceof Array))throw new Error("Invalid parameters.");this.channels=[];for(var E=0;E<O.length;E++)this.channels.push(O[E])},U.prototype.addCustomData=function(O,E){if(!(O&&E))throw new Error("Invalid parameters.");this.customData[O]=E},U.prototype.generateRequestBody=function(){if(!(this.store&&this.store.name&&this.baseURL&&this.totalAmount>0))throw new Error(`Invalid parameters. Initialize Invoice with valid instances of Setup and Store. Total amount must also be set.
eg: var invoice = new Invoice; invoice.init(setup, store); invoice.setTotalAmount(40)`);var O={invoice:{total_amount:this.totalAmount},store:this.store};return this.description&&(O.invoice.description=this.description),Object.keys(this.channels).length>0&&(O.invoice.channels=this.channels),Object.keys(this.items).length>0&&(O.invoice.items=this.items),(this.returnURL||this.cancelURL||this.callbackURL)&&(O.actions={},this.returnURL&&(O.actions.return_url=this.returnURL),this.cancelURL&&(O.actions.cancel_url=this.cancelURL),this.callbackURL&&(O.actions.callback_url=this.callbackURL)),Object.keys(this.taxes).length>0&&(O.invoice.taxes=this.taxes),Object.keys(this.customData).length>0&&(O.custom_data=this.customData),O},rt=U,rt}var nt,_t;function Vt(){if(_t)return nt;_t=1,nt=U;function U(E){if(E)return O(E)}function O(E){for(var r in U.prototype)E[r]=U.prototype[r];return E}return U.prototype.on=U.prototype.addEventListener=function(E,r){return this._callbacks=this._callbacks||{},(this._callbacks[E]=this._callbacks[E]||[]).push(r),this},U.prototype.once=function(E,r){var m=this;this._callbacks=this._callbacks||{};function N(){m.off(E,N),r.apply(this,arguments)}return N.fn=r,this.on(E,N),this},U.prototype.off=U.prototype.removeListener=U.prototype.removeAllListeners=U.prototype.removeEventListener=function(E,r){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var m=this._callbacks[E];if(!m)return this;if(arguments.length==1)return delete this._callbacks[E],this;for(var N,n=0;n<m.length;n++)if(N=m[n],N===r||N.fn===r){m.splice(n,1);break}return this},U.prototype.emit=function(E){this._callbacks=this._callbacks||{};var r=[].slice.call(arguments,1),m=this._callbacks[E];if(m){m=m.slice(0);for(var N=0,n=m.length;N<n;++N)m[N].apply(this,r)}return this},U.prototype.listeners=function(E){return this._callbacks=this._callbacks||{},this._callbacks[E]||[]},U.prototype.hasListeners=function(E){return!!this.listeners(E).length},nt}var it,mt;function qt(){return mt||(mt=1,it=function(U,O,E){for(var r=0,m=U.length,N=arguments.length==3?E:U[r++];r<m;)N=O.call(null,N,U[r],++r,U);return N}),it}var W,yt;function ut(){if(yt)return W;yt=1;var U=Vt(),O=qt(),E=typeof window=="undefined"?W:window;function r(){}function m(t){var e={}.toString.call(t);switch(e){case"[object File]":case"[object Blob]":case"[object FormData]":return!0;default:return!1}}function N(){if(E.XMLHttpRequest&&(E.location.protocol!="file:"||!E.ActiveXObject))return new XMLHttpRequest;try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(t){}try{return new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(t){}try{return new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(t){}try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(t){}return!1}var n="".trim?function(t){return t.trim()}:function(t){return t.replace(/(^\s*|\s*$)/g,"")};function x(t){return t===Object(t)}function d(t){if(!x(t))return t;var e=[];for(var l in t)t[l]!=null&&e.push(encodeURIComponent(l)+"="+encodeURIComponent(t[l]));return e.join("&")}o.serializeObject=d;function v(t){for(var e={},l=t.split("&"),s,w,R=0,g=l.length;R<g;++R)w=l[R],s=w.split("="),e[decodeURIComponent(s[0])]=decodeURIComponent(s[1]);return e}o.parseString=v,o.types={html:"text/html",json:"application/json",xml:"application/xml",urlencoded:"application/x-www-form-urlencoded",form:"application/x-www-form-urlencoded","form-data":"application/x-www-form-urlencoded"},o.serialize={"application/x-www-form-urlencoded":d,"application/json":JSON.stringify},o.parse={"application/x-www-form-urlencoded":v,"application/json":JSON.parse};function h(t){var e=t.split(/\r?\n/),l={},s,w,R,g;e.pop();for(var j=0,k=e.length;j<k;++j)w=e[j],s=w.indexOf(":"),R=w.slice(0,s).toLowerCase(),g=n(w.slice(s+1)),l[R]=g;return l}function _(t){return t.split(/ *; */).shift()}function y(t){return O(t.split(/ *; */),function(e,l){var s=l.split(/ *= */),w=s.shift(),R=s.shift();return w&&R&&(e[w]=R),e},{})}function f(t,e){this.req=t,this.xhr=this.req.xhr,this.text=this.xhr.responseText,this.setStatusProperties(this.xhr.status),this.header=this.headers=h(this.xhr.getAllResponseHeaders()),this.header["content-type"]=this.xhr.getResponseHeader("content-type"),this.setHeaderProperties(this.header),this.body=this.req.method!="HEAD"?this.parseBody(this.text):null}f.prototype.get=function(t){return this.header[t.toLowerCase()]},f.prototype.setHeaderProperties=function(t){var e=this.header["content-type"]||"";this.type=_(e);var l=y(e);for(var s in l)this[s]=l[s]},f.prototype.parseBody=function(t){var e=o.parse[this.type];return e?e(t):null},f.prototype.setStatusProperties=function(t){var e=t/100|0;this.status=t,this.statusType=e,this.info=e==1,this.ok=e==2,this.clientError=e==4,this.serverError=e==5,this.error=e==4||e==5?this.toError():!1,this.accepted=t==202,this.noContent=t==204||t==1223,this.badRequest=t==400,this.unauthorized=t==401,this.notAcceptable=t==406,this.notFound=t==404,this.forbidden=t==403},f.prototype.toError=function(){var t=this.req,e=t.method,l=t.url,s="cannot "+e+" "+l+" ("+this.status+")",w=new Error(s);return w.status=this.status,w.method=e,w.url=l,w},o.Response=f;function u(t,e){var l=this;U.call(this),this._query=this._query||[],this.method=t,this.url=e,this.header={},this._header={},this.on("end",function(){var s=new f(l);t=="HEAD"&&(s.text=null),l.callback(null,s)})}U(u.prototype),u.prototype.use=function(t){return t(this),this},u.prototype.timeout=function(t){return this._timeout=t,this},u.prototype.clearTimeout=function(){return this._timeout=0,clearTimeout(this._timer),this},u.prototype.abort=function(){if(!this.aborted)return this.aborted=!0,this.xhr.abort(),this.clearTimeout(),this.emit("abort"),this},u.prototype.set=function(t,e){if(x(t)){for(var l in t)this.set(l,t[l]);return this}return this._header[t.toLowerCase()]=e,this.header[t]=e,this},u.prototype.getHeader=function(t){return this._header[t.toLowerCase()]},u.prototype.type=function(t){return this.set("Content-Type",o.types[t]||t),this},u.prototype.accept=function(t){return this.set("Accept",o.types[t]||t),this},u.prototype.auth=function(t,e){var l=btoa(t+":"+e);return this.set("Authorization","Basic "+l),this},u.prototype.query=function(t){return typeof t!="string"&&(t=d(t)),t&&this._query.push(t),this},u.prototype.field=function(t,e){return this._formData||(this._formData=new FormData),this._formData.append(t,e),this},u.prototype.attach=function(t,e,l){return this._formData||(this._formData=new FormData),this._formData.append(t,e,l),this},u.prototype.send=function(t){var e=x(t),l=this.getHeader("Content-Type");if(e&&x(this._data))for(var s in t)this._data[s]=t[s];else typeof t=="string"?(l||this.type("form"),l=this.getHeader("Content-Type"),l=="application/x-www-form-urlencoded"?this._data=this._data?this._data+"&"+t:t:this._data=(this._data||"")+t):this._data=t;return e?(l||this.type("json"),this):this},u.prototype.callback=function(t,e){var l=this._callback;if(l.length==2)return l(t,e);if(t)return this.emit("error",t);l(e)},u.prototype.crossDomainError=function(){var t=new Error("Origin is not allowed by Access-Control-Allow-Origin");t.crossDomain=!0,this.callback(t)},u.prototype.timeoutError=function(){var t=this._timeout,e=new Error("timeout of "+t+"ms exceeded");e.timeout=t,this.callback(e)},u.prototype.withCredentials=function(){return this._withCredentials=!0,this},u.prototype.end=function(t){var e=this,l=this.xhr=N(),s=this._query.join("&"),w=this._timeout,R=this._formData||this._data;if(this._callback=t||r,l.onreadystatechange=function(){if(l.readyState==4){if(l.status==0)return e.aborted?e.timeoutError():e.crossDomainError();e.emit("end")}},l.upload&&(l.upload.onprogress=function(k){k.percent=k.loaded/k.total*100,e.emit("progress",k)}),w&&!this._timer&&(this._timer=setTimeout(function(){e.abort()},w)),s&&(s=o.serializeObject(s),this.url+=~this.url.indexOf("?")?"&"+s:"?"+s),l.open(this.method,this.url,!0),this._withCredentials&&(l.withCredentials=!0),this.method!="GET"&&this.method!="HEAD"&&typeof R!="string"&&!m(R)){var g=o.serialize[this.getHeader("Content-Type")];g&&(R=g(R))}for(var j in this.header)this.header[j]!=null&&l.setRequestHeader(j,this.header[j]);return this.emit("request",this),l.send(R),this},o.Request=u;function o(t,e){return typeof e=="function"?new u("GET",t).end(e):arguments.length==1?new u("GET",t):new u(t,e)}return o.get=function(t,e,l){var s=o("GET",t);return typeof e=="function"&&(l=e,e=null),e&&s.query(e),l&&s.end(l),s},o.head=function(t,e,l){var s=o("HEAD",t);return typeof e=="function"&&(l=e,e=null),e&&s.send(e),l&&s.end(l),s},o.del=function(t,e){var l=o("DELETE",t);return e&&l.end(e),l},o.patch=function(t,e,l){var s=o("PATCH",t);return typeof e=="function"&&(l=e,e=null),e&&s.send(e),l&&s.end(l),s},o.post=function(t,e,l){var s=o("POST",t);return typeof e=="function"&&(l=e,e=null),e&&s.send(e),l&&s.end(l),s},o.put=function(t,e,l){var s=o("PUT",t);return typeof e=="function"&&(l=e,e=null),e&&s.send(e),l&&s.end(l),s},W=o,W}var st={exports:{}},gt;function ft(){return gt||(gt=1,(function(U,O){var E={};/* @preserve
 * The MIT License (MIT)
 * 
 * Copyright (c) 2013-2015 Petka Antonov
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 * 
 */(function(r){U.exports=r()})(function(){return(function r(m,N,n){function x(h,_){if(!N[h]){if(!m[h]){var y=typeof _dereq_=="function"&&_dereq_;if(!_&&y)return y(h,!0);if(d)return d(h,!0);var f=new Error("Cannot find module '"+h+"'");throw f.code="MODULE_NOT_FOUND",f}var u=N[h]={exports:{}};m[h][0].call(u.exports,function(o){var t=m[h][1][o];return x(t||o)},u,u.exports,r,m,N,n)}return N[h].exports}for(var d=typeof _dereq_=="function"&&_dereq_,v=0;v<n.length;v++)x(n[v]);return x})({1:[function(r,m,N){m.exports=function(n){var x=n._SomePromiseArray;function d(v){var h=new x(v),_=h.promise();return h.setHowMany(1),h.setUnwrap(),h.init(),_}n.any=function(v){return d(v)},n.prototype.any=function(){return d(this)}}},{}],2:[function(r,m,N){var n;try{throw new Error}catch(u){n=u}var x=r("./schedule.js"),d=r("./queue.js"),v=r("./util.js");function h(){this._isTickUsed=!1,this._lateQueue=new d(16),this._normalQueue=new d(16),this._trampolineEnabled=!0;var u=this;this.drainQueues=function(){u._drainQueues()},this._schedule=x.isStatic?x(this.drainQueues):x}h.prototype.disableTrampolineIfNecessary=function(){v.hasDevTools&&(this._trampolineEnabled=!1)},h.prototype.enableTrampoline=function(){this._trampolineEnabled||(this._trampolineEnabled=!0,this._schedule=function(u){setTimeout(u,0)})},h.prototype.haveItemsQueued=function(){return this._normalQueue.length()>0},h.prototype.throwLater=function(u,o){if(arguments.length===1&&(o=u,u=function(){throw o}),typeof setTimeout!="undefined")setTimeout(function(){u(o)},0);else try{this._schedule(function(){u(o)})}catch(t){throw new Error(`No async scheduler available

    See http://goo.gl/m3OTXk
`)}};function _(u,o,t){this._lateQueue.push(u,o,t),this._queueTick()}function y(u,o,t){this._normalQueue.push(u,o,t),this._queueTick()}function f(u){this._normalQueue._pushOne(u),this._queueTick()}v.hasDevTools?(x.isStatic&&(x=function(u){setTimeout(u,0)}),h.prototype.invokeLater=function(u,o,t){this._trampolineEnabled?_.call(this,u,o,t):this._schedule(function(){setTimeout(function(){u.call(o,t)},100)})},h.prototype.invoke=function(u,o,t){this._trampolineEnabled?y.call(this,u,o,t):this._schedule(function(){u.call(o,t)})},h.prototype.settlePromises=function(u){this._trampolineEnabled?f.call(this,u):this._schedule(function(){u._settlePromises()})}):(h.prototype.invokeLater=_,h.prototype.invoke=y,h.prototype.settlePromises=f),h.prototype.invokeFirst=function(u,o,t){this._normalQueue.unshift(u,o,t),this._queueTick()},h.prototype._drainQueue=function(u){for(;u.length()>0;){var o=u.shift();if(typeof o!="function"){o._settlePromises();continue}var t=u.shift(),e=u.shift();o.call(t,e)}},h.prototype._drainQueues=function(){this._drainQueue(this._normalQueue),this._reset(),this._drainQueue(this._lateQueue)},h.prototype._queueTick=function(){this._isTickUsed||(this._isTickUsed=!0,this._schedule(this.drainQueues))},h.prototype._reset=function(){this._isTickUsed=!1},m.exports=new h,m.exports.firstLineError=n},{"./queue.js":28,"./schedule.js":31,"./util.js":38}],3:[function(r,m,N){m.exports=function(n,x,d){var v=function(f,u){this._reject(u)},h=function(f,u){u.promiseRejectionQueued=!0,u.bindingPromise._then(v,v,null,this,f)},_=function(f,u){this._isPending()&&this._resolveCallback(u.target)},y=function(f,u){u.promiseRejectionQueued||this._reject(f)};n.prototype.bind=function(f){var u=d(f),o=new n(x);o._propagateFrom(this,1);var t=this._target();if(o._setBoundTo(u),u instanceof n){var e={promiseRejectionQueued:!1,promise:o,target:t,bindingPromise:u};t._then(x,h,o._progress,o,e),u._then(_,y,o._progress,o,e)}else o._resolveCallback(t);return o},n.prototype._setBoundTo=function(f){f!==void 0?(this._bitField=this._bitField|131072,this._boundTo=f):this._bitField=this._bitField&-131073},n.prototype._isBound=function(){return(this._bitField&131072)===131072},n.bind=function(f,u){var o=d(f),t=new n(x);return t._setBoundTo(o),o instanceof n?o._then(function(){t._resolveCallback(u)},t._reject,t._progress,t,null):t._resolveCallback(u),t}}},{}],4:[function(r,m,N){var n;typeof Promise!="undefined"&&(n=Promise);function x(){try{Promise===d&&(Promise=n)}catch(v){}return d}var d=r("./promise.js")();d.noConflict=x,m.exports=d},{"./promise.js":23}],5:[function(r,m,N){var n=Object.create;if(n){var x=n(null),d=n(null);x[" size"]=d[" size"]=0}m.exports=function(v){var h=r("./util.js"),_=h.canEvaluate;h.isIdentifier;var y;function f(e,l){var s;if(e!=null&&(s=e[l]),typeof s!="function"){var w="Object "+h.classString(e)+" has no method '"+h.toString(l)+"'";throw new v.TypeError(w)}return s}function u(e){var l=this.pop(),s=f(e,l);return s.apply(e,this)}v.prototype.call=function(e){for(var l=arguments.length,s=new Array(l-1),w=1;w<l;++w)s[w-1]=arguments[w];return s.push(e),this._then(u,void 0,void 0,s,void 0)};function o(e){return e[this]}function t(e){var l=+this;return l<0&&(l=Math.max(0,l+e.length)),e[l]}v.prototype.get=function(e){var l=typeof e=="number",s;if(l)s=t;else if(_){var w=y(e);s=w!==null?w:o}else s=o;return this._then(s,void 0,void 0,e,void 0)}}},{"./util.js":38}],6:[function(r,m,N){m.exports=function(n){var x=r("./errors.js"),d=r("./async.js"),v=x.CancellationError;n.prototype._cancel=function(h){if(!this.isCancellable())return this;for(var _,y=this;(_=y._cancellationParent)!==void 0&&_.isCancellable();)y=_;this._unsetCancellable(),y._target()._rejectCallback(h,!1,!0)},n.prototype.cancel=function(h){return this.isCancellable()?(h===void 0&&(h=new v),d.invokeLater(this._cancel,this,h),this):this},n.prototype.cancellable=function(){return this._cancellable()?this:(d.enableTrampoline(),this._setCancellable(),this._cancellationParent=void 0,this)},n.prototype.uncancellable=function(){var h=this.then();return h._unsetCancellable(),h},n.prototype.fork=function(h,_,y){var f=this._then(h,_,y,void 0,void 0);return f._setCancellable(),f._cancellationParent=void 0,f}}},{"./async.js":2,"./errors.js":13}],7:[function(r,m,N){m.exports=function(){var n=r("./async.js"),x=r("./util.js"),d=/[\\\/]bluebird[\\\/]js[\\\/](main|debug|zalgo|instrumented)/,v=null,h=null,_=!1,y;function f(T){this._parent=T;var i=this._length=1+(T===void 0?0:T._length);k(this,f),i>32&&this.uncycle()}x.inherits(f,Error),f.prototype.uncycle=function(){var T=this._length;if(!(T<2)){for(var i=[],P={},a=0,c=this;c!==void 0;++a)i.push(c),c=c._parent;T=this._length=a;for(var a=T-1;a>=0;--a){var C=i[a].stack;P[C]===void 0&&(P[C]=a)}for(var a=0;a<T;++a){var A=i[a].stack,F=P[A];if(F!==void 0&&F!==a){F>0&&(i[F-1]._parent=void 0,i[F-1]._length=1),i[a]._parent=void 0,i[a]._length=1;var L=a>0?i[a-1]:this;F<T-1?(L._parent=i[F+1],L._parent.uncycle(),L._length=L._parent._length+1):(L._parent=void 0,L._length=1);for(var b=L._length+1,I=a-2;I>=0;--I)i[I]._length=b,b++;return}}}},f.prototype.parent=function(){return this._parent},f.prototype.hasParent=function(){return this._parent!==void 0},f.prototype.attachExtraTrace=function(T){if(!T.__stackCleaned__){this.uncycle();for(var i=f.parseStackAndMessage(T),P=i.message,a=[i.stack],c=this;c!==void 0;)a.push(e(c.stack.split(`
`))),c=c._parent;t(a),o(a),x.notEnumerableProp(T,"stack",u(P,a)),x.notEnumerableProp(T,"__stackCleaned__",!0)}};function u(T,i){for(var P=0;P<i.length-1;++P)i[P].push("From previous event:"),i[P]=i[P].join(`
`);return P<i.length&&(i[P]=i[P].join(`
`)),T+`
`+i.join(`
`)}function o(T){for(var i=0;i<T.length;++i)(T[i].length===0||i+1<T.length&&T[i][0]===T[i+1][0])&&(T.splice(i,1),i--)}function t(T){for(var i=T[0],P=1;P<T.length;++P){for(var a=T[P],c=i.length-1,C=i[c],A=-1,F=a.length-1;F>=0;--F)if(a[F]===C){A=F;break}for(var F=A;F>=0;--F){var L=a[F];if(i[c]===L)i.pop(),c--;else break}i=a}}function e(T){for(var i=[],P=0;P<T.length;++P){var a=T[P],c=v.test(a)||a==="    (No stack trace)",C=c&&R(a);c&&!C&&(_&&a.charAt(0)!==" "&&(a="    "+a),i.push(a))}return i}function l(T){for(var i=T.stack.replace(/\s+$/g,"").split(`
`),P=0;P<i.length;++P){var a=i[P];if(a==="    (No stack trace)"||v.test(a))break}return P>0&&(i=i.slice(P)),i}f.parseStackAndMessage=function(T){var i=T.stack,P=T.toString();return i=typeof i=="string"&&i.length>0?l(T):["    (No stack trace)"],{message:P,stack:e(i)}},f.formatAndLogError=function(T,i){if(typeof console!="undefined"){var P;if(typeof T=="object"||typeof T=="function"){var a=T.stack;P=i+h(a,T)}else P=i+String(T);typeof y=="function"?y(P):(typeof console.log=="function"||typeof console.log=="object")&&console.log(P)}},f.unhandledRejection=function(T){f.formatAndLogError(T,"^--- With additional stack trace: ")},f.isSupported=function(){return typeof k=="function"},f.fireRejectionEvent=function(T,i,P,a){var c=!1;try{typeof i=="function"&&(c=!0,T==="rejectionHandled"?i(a):i(P,a))}catch(F){n.throwLater(F)}var C=!1;try{C=D(T,P,a)}catch(F){C=!0,n.throwLater(F)}var A=!1;if(S)try{A=S(T.toLowerCase(),{reason:P,promise:a})}catch(F){A=!0,n.throwLater(F)}!C&&!c&&!A&&T==="unhandledRejection"&&f.formatAndLogError(P,"Unhandled rejection ")};function s(T){var i;if(typeof T=="function")i="[function "+(T.name||"anonymous")+"]";else{i=T.toString();var P=/\[object [a-zA-Z0-9$_]+\]/;if(P.test(i))try{var a=JSON.stringify(T);i=a}catch(c){}i.length===0&&(i="(empty array)")}return"(<"+w(i)+">, no stack trace)"}function w(T){var i=41;return T.length<i?T:T.substr(0,i-3)+"..."}var R=function(){return!1},g=/[\/<\(]([^:\/]+):(\d+):(?:\d+)\)?\s*$/;function j(T){var i=T.match(g);if(i)return{fileName:i[1],line:parseInt(i[2],10)}}f.setBounds=function(T,i){if(f.isSupported()){for(var P=T.stack.split(`
`),a=i.stack.split(`
`),c=-1,C=-1,A,F,L=0;L<P.length;++L){var b=j(P[L]);if(b){A=b.fileName,c=b.line;break}}for(var L=0;L<a.length;++L){var b=j(a[L]);if(b){F=b.fileName,C=b.line;break}}c<0||C<0||!A||!F||A!==F||c>=C||(R=function(I){if(d.test(I))return!0;var H=j(I);return!!(H&&H.fileName===A&&c<=H.line&&H.line<=C)})}};var k=(function(){var i=/^\s*at\s*/,P=function(A,F){return typeof A=="string"?A:F.name!==void 0&&F.message!==void 0?F.toString():s(F)};if(typeof Error.stackTraceLimit=="number"&&typeof Error.captureStackTrace=="function"){Error.stackTraceLimit=Error.stackTraceLimit+6,v=i,h=P;var a=Error.captureStackTrace;return R=function(A){return d.test(A)},function(A,F){Error.stackTraceLimit=Error.stackTraceLimit+6,a(A,F),Error.stackTraceLimit=Error.stackTraceLimit-6}}var c=new Error;if(typeof c.stack=="string"&&c.stack.split(`
`)[0].indexOf("stackDetection@")>=0)return v=/@/,h=P,_=!0,function(F){F.stack=new Error().stack};var C;try{throw new Error}catch(A){C="stack"in A}return!("stack"in c)&&C&&typeof Error.stackTraceLimit=="number"?(v=i,h=P,function(F){Error.stackTraceLimit=Error.stackTraceLimit+6;try{throw new Error}catch(L){F.stack=L.stack}Error.stackTraceLimit=Error.stackTraceLimit-6}):(h=function(A,F){return typeof A=="string"?A:(typeof F=="object"||typeof F=="function")&&F.name!==void 0&&F.message!==void 0?F.toString():s(F)},null)})(),S,D=(function(){if(x.isNode)return function(C,A,F){return C==="rejectionHandled"?process.emit(C,F):process.emit(C,A,F)};var T=!1,i=!0;try{var P=new self.CustomEvent("test");T=P instanceof CustomEvent}catch(C){}if(!T)try{var a=document.createEvent("CustomEvent");a.initCustomEvent("testingtheevent",!1,!0,{}),self.dispatchEvent(a)}catch(C){i=!1}i&&(S=function(C,A){var F;return T?F=new self.CustomEvent(C,{detail:A,bubbles:!1,cancelable:!0}):self.dispatchEvent&&(F=document.createEvent("CustomEvent"),F.initCustomEvent(C,!1,!0,A)),F?!self.dispatchEvent(F):!1});var c={};return c.unhandledRejection="onunhandledRejection".toLowerCase(),c.rejectionHandled="onrejectionHandled".toLowerCase(),function(C,A,F){var L=c[C],b=self[L];return b?(C==="rejectionHandled"?b.call(self,F):b.call(self,A,F),!0):!1}})();return typeof console!="undefined"&&typeof console.warn!="undefined"&&(y=function(T){console.warn(T)},x.isNode&&process.stderr.isTTY?y=function(T){process.stderr.write("\x1B[31m"+T+`\x1B[39m
`)}:!x.isNode&&typeof new Error().stack=="string"&&(y=function(T){console.warn("%c"+T,"color: red")})),f}},{"./async.js":2,"./util.js":38}],8:[function(r,m,N){m.exports=function(n){var x=r("./util.js"),d=r("./errors.js"),v=x.tryCatch,h=x.errorObj,_=r("./es5.js").keys,y=d.TypeError;function f(o,t,e){this._instances=o,this._callback=t,this._promise=e}function u(o,t){var e={},l=v(o).call(e,t);if(l===h)return l;var s=_(e);return s.length?(h.e=new y(`Catch filter must inherit from Error or be a simple predicate function

    See http://goo.gl/o84o68
`),h):l}return f.prototype.doFilter=function(o){for(var t=this._callback,e=this._promise,l=e._boundValue(),s=0,w=this._instances.length;s<w;++s){var R=this._instances[s],g=R===Error||R!=null&&R.prototype instanceof Error;if(g&&o instanceof R){var j=v(t).call(l,o);return j===h?(n.e=j.e,n):j}else if(typeof R=="function"&&!g){var k=u(R,o);if(k===h){o=h.e;break}else if(k){var j=v(t).call(l,o);return j===h?(n.e=j.e,n):j}}}return n.e=o,n},f}},{"./errors.js":13,"./es5.js":14,"./util.js":38}],9:[function(r,m,N){m.exports=function(n,x,d){var v=[];function h(){this._trace=new x(y())}h.prototype._pushContext=function(){d()&&this._trace!==void 0&&v.push(this._trace)},h.prototype._popContext=function(){d()&&this._trace!==void 0&&v.pop()};function _(){if(d())return new h}function y(){var f=v.length-1;if(f>=0)return v[f]}return n.prototype._peekContext=y,n.prototype._pushContext=h.prototype._pushContext,n.prototype._popContext=h.prototype._popContext,_}},{}],10:[function(r,m,N){m.exports=function(n,x){var d=n._getDomain,v=r("./async.js"),h=r("./errors.js").Warning,_=r("./util.js"),y=_.canAttachTrace,f,u,o=_.isNode&&(!!E.BLUEBIRD_DEBUG||!1);return _.isNode&&E.BLUEBIRD_DEBUG==0&&(o=!1),o&&v.disableTrampolineIfNecessary(),n.prototype._ignoreRejections=function(){this._unsetRejectionIsUnhandled(),this._bitField=this._bitField|16777216},n.prototype._ensurePossibleRejectionHandled=function(){(this._bitField&16777216)===0&&(this._setRejectionIsUnhandled(),v.invokeLater(this._notifyUnhandledRejection,this,void 0))},n.prototype._notifyUnhandledRejectionIsHandled=function(){x.fireRejectionEvent("rejectionHandled",f,void 0,this)},n.prototype._notifyUnhandledRejection=function(){if(this._isRejectionUnhandled()){var t=this._getCarriedStackTrace()||this._settledValue;this._setUnhandledRejectionIsNotified(),x.fireRejectionEvent("unhandledRejection",u,t,this)}},n.prototype._setUnhandledRejectionIsNotified=function(){this._bitField=this._bitField|524288},n.prototype._unsetUnhandledRejectionIsNotified=function(){this._bitField=this._bitField&-524289},n.prototype._isUnhandledRejectionNotified=function(){return(this._bitField&524288)>0},n.prototype._setRejectionIsUnhandled=function(){this._bitField=this._bitField|2097152},n.prototype._unsetRejectionIsUnhandled=function(){this._bitField=this._bitField&-2097153,this._isUnhandledRejectionNotified()&&(this._unsetUnhandledRejectionIsNotified(),this._notifyUnhandledRejectionIsHandled())},n.prototype._isRejectionUnhandled=function(){return(this._bitField&2097152)>0},n.prototype._setCarriedStackTrace=function(t){this._bitField=this._bitField|1048576,this._fulfillmentHandler0=t},n.prototype._isCarryingStackTrace=function(){return(this._bitField&1048576)>0},n.prototype._getCarriedStackTrace=function(){return this._isCarryingStackTrace()?this._fulfillmentHandler0:void 0},n.prototype._captureStackTrace=function(){return o&&(this._trace=new x(this._peekContext())),this},n.prototype._attachExtraTrace=function(t,e){if(o&&y(t)){var l=this._trace;if(l!==void 0&&e&&(l=l._parent),l!==void 0)l.attachExtraTrace(t);else if(!t.__stackCleaned__){var s=x.parseStackAndMessage(t);_.notEnumerableProp(t,"stack",s.message+`
`+s.stack.join(`
`)),_.notEnumerableProp(t,"__stackCleaned__",!0)}}},n.prototype._warn=function(t){var e=new h(t),l=this._peekContext();if(l)l.attachExtraTrace(e);else{var s=x.parseStackAndMessage(e);e.stack=s.message+`
`+s.stack.join(`
`)}x.formatAndLogError(e,"")},n.onPossiblyUnhandledRejection=function(t){var e=d();u=typeof t=="function"?e===null?t:e.bind(t):void 0},n.onUnhandledRejectionHandled=function(t){var e=d();f=typeof t=="function"?e===null?t:e.bind(t):void 0},n.longStackTraces=function(){if(v.haveItemsQueued()&&o===!1)throw new Error(`cannot enable long stack traces after promises have been created

    See http://goo.gl/DT1qyG
`);o=x.isSupported(),o&&v.disableTrampolineIfNecessary()},n.hasLongStackTraces=function(){return o&&x.isSupported()},x.isSupported()||(n.longStackTraces=function(){},o=!1),function(){return o}}},{"./async.js":2,"./errors.js":13,"./util.js":38}],11:[function(r,m,N){var n=r("./util.js"),x=n.isPrimitive;m.exports=function(d){var v=function(){return this},h=function(){throw this},_=function(){},y=function(){throw void 0},f=function(u,o){if(o===1)return function(){throw u};if(o===2)return function(){return u}};d.prototype.return=d.prototype.thenReturn=function(u){return u===void 0?this.then(_):x(u)?this._then(f(u,2),void 0,void 0,void 0,void 0):(u instanceof d&&u._ignoreRejections(),this._then(v,void 0,void 0,u,void 0))},d.prototype.throw=d.prototype.thenThrow=function(u){return u===void 0?this.then(y):x(u)?this._then(f(u,1),void 0,void 0,void 0,void 0):this._then(h,void 0,void 0,u,void 0)}}},{"./util.js":38}],12:[function(r,m,N){m.exports=function(n,x){var d=n.reduce;n.prototype.each=function(v){return d(this,v,null,x)},n.each=function(v,h){return d(v,h,null,x)}}},{}],13:[function(r,m,N){var n=r("./es5.js"),x=n.freeze,d=r("./util.js"),v=d.inherits,h=d.notEnumerableProp;function _(j,k){function S(D){if(!(this instanceof S))return new S(D);h(this,"message",typeof D=="string"?D:k),h(this,"name",j),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):Error.call(this)}return v(S,Error),S}var y,f,u=_("Warning","warning"),o=_("CancellationError","cancellation error"),t=_("TimeoutError","timeout error"),e=_("AggregateError","aggregate error");try{y=TypeError,f=RangeError}catch(j){y=_("TypeError","type error"),f=_("RangeError","range error")}for(var l="join pop push shift unshift slice filter forEach some every map indexOf lastIndexOf reduce reduceRight sort reverse".split(" "),s=0;s<l.length;++s)typeof Array.prototype[l[s]]=="function"&&(e.prototype[l[s]]=Array.prototype[l[s]]);n.defineProperty(e.prototype,"length",{value:0,configurable:!1,writable:!0,enumerable:!0}),e.prototype.isOperational=!0;var w=0;e.prototype.toString=function(){var j=Array(w*4+1).join(" "),k=`
`+j+`AggregateError of:
`;w++,j=Array(w*4+1).join(" ");for(var S=0;S<this.length;++S){for(var D=this[S]===this?"[Circular AggregateError]":this[S]+"",T=D.split(`
`),i=0;i<T.length;++i)T[i]=j+T[i];D=T.join(`
`),k+=D+`
`}return w--,k};function R(j){if(!(this instanceof R))return new R(j);h(this,"name","OperationalError"),h(this,"message",j),this.cause=j,this.isOperational=!0,j instanceof Error?(h(this,"message",j.message),h(this,"stack",j.stack)):Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}v(R,Error);var g=Error.__BluebirdErrorTypes__;g||(g=x({CancellationError:o,TimeoutError:t,OperationalError:R,RejectionError:R,AggregateError:e}),h(Error,"__BluebirdErrorTypes__",g)),m.exports={Error,TypeError:y,RangeError:f,CancellationError:g.CancellationError,OperationalError:g.OperationalError,TimeoutError:g.TimeoutError,AggregateError:g.AggregateError,Warning:u}},{"./es5.js":14,"./util.js":38}],14:[function(r,m,N){var n=(function(){return this===void 0})();if(n)m.exports={freeze:Object.freeze,defineProperty:Object.defineProperty,getDescriptor:Object.getOwnPropertyDescriptor,keys:Object.keys,names:Object.getOwnPropertyNames,getPrototypeOf:Object.getPrototypeOf,isArray:Array.isArray,isES5:n,propertyIsWritable:function(t,e){var l=Object.getOwnPropertyDescriptor(t,e);return!!(!l||l.writable||l.set)}};else{var x={}.hasOwnProperty,d={}.toString,v={}.constructor.prototype,h=function(t){var e=[];for(var l in t)x.call(t,l)&&e.push(l);return e},_=function(t,e){return{value:t[e]}},y=function(t,e,l){return t[e]=l.value,t},f=function(t){return t},u=function(t){try{return Object(t).constructor.prototype}catch(e){return v}},o=function(t){try{return d.call(t)==="[object Array]"}catch(e){return!1}};m.exports={isArray:o,keys:h,names:h,defineProperty:y,getDescriptor:_,freeze:f,getPrototypeOf:u,isES5:n,propertyIsWritable:function(){return!0}}}},{}],15:[function(r,m,N){m.exports=function(n,x){var d=n.map;n.prototype.filter=function(v,h){return d(this,v,h,x)},n.filter=function(v,h,_){return d(v,h,_,x)}}},{}],16:[function(r,m,N){m.exports=function(n,x,d){var v=r("./util.js"),h=v.isPrimitive,_=v.thrower;function y(){return this}function f(){throw this}function u(s){return function(){return s}}function o(s){return function(){throw s}}function t(s,w,R){var g;return h(w)?g=R?u(w):o(w):g=R?y:f,s._then(g,_,void 0,w,void 0)}function e(s){var w=this.promise,R=this.handler,g=w._isBound()?R.call(w._boundValue()):R();if(g!==void 0){var j=d(g,w);if(j instanceof n)return j=j._target(),t(j,s,w.isFulfilled())}return w.isRejected()?(x.e=s,x):s}function l(s){var w=this.promise,R=this.handler,g=w._isBound()?R.call(w._boundValue(),s):R(s);if(g!==void 0){var j=d(g,w);if(j instanceof n)return j=j._target(),t(j,s,!0)}return s}n.prototype._passThroughHandler=function(s,w){if(typeof s!="function")return this.then();var R={promise:this,handler:s};return this._then(w?e:l,w?e:void 0,void 0,R,void 0)},n.prototype.lastly=n.prototype.finally=function(s){return this._passThroughHandler(s,!0)},n.prototype.tap=function(s){return this._passThroughHandler(s,!1)}}},{"./util.js":38}],17:[function(r,m,N){m.exports=function(n,x,d,v){var h=r("./errors.js"),_=h.TypeError,y=r("./util.js"),f=y.errorObj,u=y.tryCatch,o=[];function t(l,s,w){for(var R=0;R<s.length;++R){w._pushContext();var g=u(s[R])(l);if(w._popContext(),g===f){w._pushContext();var j=n.reject(f.e);return w._popContext(),j}var k=v(g,w);if(k instanceof n)return k}return null}function e(l,s,w,R){var g=this._promise=new n(d);g._captureStackTrace(),this._stack=R,this._generatorFunction=l,this._receiver=s,this._generator=void 0,this._yieldHandlers=typeof w=="function"?[w].concat(o):o}e.prototype.promise=function(){return this._promise},e.prototype._run=function(){this._generator=this._generatorFunction.call(this._receiver),this._receiver=this._generatorFunction=void 0,this._next(void 0)},e.prototype._continue=function(l){if(l===f)return this._promise._rejectCallback(l.e,!1,!0);var s=l.value;if(l.done===!0)this._promise._resolveCallback(s);else{var w=v(s,this._promise);if(!(w instanceof n)&&(w=t(w,this._yieldHandlers,this._promise),w===null)){this._throw(new _(`A value %s was yielded that could not be treated as a promise

    See http://goo.gl/4Y4pDk

`.replace("%s",s)+`From coroutine:
`+this._stack.split(`
`).slice(1,-7).join(`
`)));return}w._then(this._next,this._throw,void 0,this,null)}},e.prototype._throw=function(l){this._promise._attachExtraTrace(l),this._promise._pushContext();var s=u(this._generator.throw).call(this._generator,l);this._promise._popContext(),this._continue(s)},e.prototype._next=function(l){this._promise._pushContext();var s=u(this._generator.next).call(this._generator,l);this._promise._popContext(),this._continue(s)},n.coroutine=function(l,s){if(typeof l!="function")throw new _(`generatorFunction must be a function

    See http://goo.gl/6Vqhm0
`);var w=Object(s).yieldHandler,R=e,g=new Error().stack;return function(){var j=l.apply(this,arguments),k=new R(void 0,void 0,w,g);return k._generator=j,k._next(void 0),k.promise()}},n.coroutine.addYieldHandler=function(l){if(typeof l!="function")throw new _(`fn must be a function

    See http://goo.gl/916lJJ
`);o.push(l)},n.spawn=function(l){if(typeof l!="function")return x(`generatorFunction must be a function

    See http://goo.gl/6Vqhm0
`);var s=new e(l,this),w=s.promise();return s._run(n.spawn),w}}},{"./errors.js":13,"./util.js":38}],18:[function(r,m,N){m.exports=function(n,x,d,v){var h=r("./util.js");h.canEvaluate,h.tryCatch,h.errorObj,n.join=function(){var _=arguments.length-1,y;if(_>0&&typeof arguments[_]=="function"){y=arguments[_];var t}for(var f=arguments.length,u=new Array(f),o=0;o<f;++o)u[o]=arguments[o];y&&u.pop();var t=new x(u).promise();return y!==void 0?t.spread(y):t}}},{"./util.js":38}],19:[function(r,m,N){m.exports=function(n,x,d,v,h){var _=n._getDomain,y=r("./async.js"),f=r("./util.js"),u=f.tryCatch,o=f.errorObj,t={},e=[];function l(R,g,j,k){this.constructor$(R),this._promise._captureStackTrace();var S=_();this._callback=S===null?g:S.bind(g),this._preservedValues=k===h?new Array(this.length()):null,this._limit=j,this._inFlight=0,this._queue=j>=1?[]:e,y.invoke(s,this,void 0)}f.inherits(l,x);function s(){this._init$(void 0,-2)}l.prototype._init=function(){},l.prototype._promiseFulfilled=function(R,g){var j=this._values,k=this.length(),S=this._preservedValues,D=this._limit;if(j[g]===t){if(j[g]=R,D>=1&&(this._inFlight--,this._drainQueue(),this._isResolved()))return}else{if(D>=1&&this._inFlight>=D){j[g]=R,this._queue.push(g);return}S!==null&&(S[g]=R);var T=this._callback,i=this._promise._boundValue();this._promise._pushContext();var P=u(T).call(i,R,g,k);if(this._promise._popContext(),P===o)return this._reject(P.e);var a=v(P,this._promise);if(a instanceof n){if(a=a._target(),a._isPending())return D>=1&&this._inFlight++,j[g]=t,a._proxyPromiseArray(this,g);if(a._isFulfilled())P=a._value();else return this._reject(a._reason())}j[g]=P}var c=++this._totalResolved;c>=k&&(S!==null?this._filter(j,S):this._resolve(j))},l.prototype._drainQueue=function(){for(var R=this._queue,g=this._limit,j=this._values;R.length>0&&this._inFlight<g;){if(this._isResolved())return;var k=R.pop();this._promiseFulfilled(j[k],k)}},l.prototype._filter=function(R,g){for(var j=g.length,k=new Array(j),S=0,D=0;D<j;++D)R[D]&&(k[S++]=g[D]);k.length=S,this._resolve(k)},l.prototype.preservedValues=function(){return this._preservedValues};function w(R,g,j,k){var S=typeof j=="object"&&j!==null?j.concurrency:0;return S=typeof S=="number"&&isFinite(S)&&S>=1?S:0,new l(R,g,S,k)}n.prototype.map=function(R,g){return typeof R!="function"?d(`fn must be a function

    See http://goo.gl/916lJJ
`):w(this,R,g,null).promise()},n.map=function(R,g,j,k){return typeof g!="function"?d(`fn must be a function

    See http://goo.gl/916lJJ
`):w(R,g,j,k).promise()}}},{"./async.js":2,"./util.js":38}],20:[function(r,m,N){m.exports=function(n,x,d,v){var h=r("./util.js"),_=h.tryCatch;n.method=function(y){if(typeof y!="function")throw new n.TypeError(`fn must be a function

    See http://goo.gl/916lJJ
`);return function(){var f=new n(x);f._captureStackTrace(),f._pushContext();var u=_(y).apply(this,arguments);return f._popContext(),f._resolveFromSyncValue(u),f}},n.attempt=n.try=function(y,f,u){if(typeof y!="function")return v(`fn must be a function

    See http://goo.gl/916lJJ
`);var o=new n(x);o._captureStackTrace(),o._pushContext();var t=h.isArray(f)?_(y).apply(u,f):_(y).call(u,f);return o._popContext(),o._resolveFromSyncValue(t),o},n.prototype._resolveFromSyncValue=function(y){y===h.errorObj?this._rejectCallback(y.e,!1,!0):this._resolveCallback(y,!0)}}},{"./util.js":38}],21:[function(r,m,N){m.exports=function(n){var x=r("./util.js"),d=r("./async.js"),v=x.tryCatch,h=x.errorObj;function _(u,o){var t=this;if(!x.isArray(u))return y.call(t,u,o);var e=v(o).apply(t._boundValue(),[null].concat(u));e===h&&d.throwLater(e.e)}function y(u,o){var t=this,e=t._boundValue(),l=u===void 0?v(o).call(e,null):v(o).call(e,null,u);l===h&&d.throwLater(l.e)}function f(u,o){var t=this;if(!u){var e=t._target(),l=e._getCarriedStackTrace();l.cause=u,u=l}var s=v(o).call(t._boundValue(),u);s===h&&d.throwLater(s.e)}n.prototype.asCallback=n.prototype.nodeify=function(u,o){if(typeof u=="function"){var t=y;o!==void 0&&Object(o).spread&&(t=_),this._then(t,f,void 0,this,u)}return this}}},{"./async.js":2,"./util.js":38}],22:[function(r,m,N){m.exports=function(n,x){var d=r("./util.js"),v=r("./async.js"),h=d.tryCatch,_=d.errorObj;n.prototype.progressed=function(y){return this._then(void 0,void 0,y,void 0,void 0)},n.prototype._progress=function(y){this._isFollowingOrFulfilledOrRejected()||this._target()._progressUnchecked(y)},n.prototype._progressHandlerAt=function(y){return y===0?this._progressHandler0:this[(y<<2)+y-5+2]},n.prototype._doProgressWith=function(y){var f=y.value,u=y.handler,o=y.promise,t=y.receiver,e=h(u).call(t,f);if(e===_){if(e.e!=null&&e.e.name!=="StopProgressPropagation"){var l=d.canAttachTrace(e.e)?e.e:new Error(d.toString(e.e));o._attachExtraTrace(l),o._progress(e.e)}}else e instanceof n?e._then(o._progress,null,null,o,void 0):o._progress(e)},n.prototype._progressUnchecked=function(y){for(var f=this._length(),u=this._progress,o=0;o<f;o++){var t=this._progressHandlerAt(o),e=this._promiseAt(o);if(!(e instanceof n)){var l=this._receiverAt(o);typeof t=="function"?t.call(l,y,e):l instanceof x&&!l._isResolved()&&l._promiseProgressed(y,e);continue}typeof t=="function"?v.invoke(this._doProgressWith,this,{handler:t,promise:e,receiver:this._receiverAt(o),value:y}):v.invoke(u,e,y)}}}},{"./async.js":2,"./util.js":38}],23:[function(r,m,N){m.exports=function(){var n=function(){return new u(`circular promise resolution chain

    See http://goo.gl/LhFpo0
`)},x=function(){return new i.PromiseInspection(this._target())},d=function(a){return i.reject(new u(a))},v=r("./util.js"),h;v.isNode?h=function(){var a=process.domain;return a===void 0&&(a=null),a}:h=function(){return null},v.notEnumerableProp(i,"_getDomain",h);var _={},y=r("./async.js"),f=r("./errors.js"),u=i.TypeError=f.TypeError;i.RangeError=f.RangeError,i.CancellationError=f.CancellationError,i.TimeoutError=f.TimeoutError,i.OperationalError=f.OperationalError,i.RejectionError=f.OperationalError,i.AggregateError=f.AggregateError;var o=function(){},t={},e={e:null},l=r("./thenables.js")(i,o),s=r("./promise_array.js")(i,o,l,d),w=r("./captured_trace.js")(),R=r("./debuggability.js")(i,w),g=r("./context.js")(i,w,R),j=r("./catch_filter.js")(e),k=r("./promise_resolver.js"),S=k._nodebackForPromise,D=v.errorObj,T=v.tryCatch;function i(a){if(typeof a!="function")throw new u(`the promise constructor requires a resolver function

    See http://goo.gl/EC22Yn
`);if(this.constructor!==i)throw new u(`the promise constructor cannot be invoked directly

    See http://goo.gl/KsIlge
`);this._bitField=0,this._fulfillmentHandler0=void 0,this._rejectionHandler0=void 0,this._progressHandler0=void 0,this._promise0=void 0,this._receiver0=void 0,this._settledValue=void 0,a!==o&&this._resolveFromResolver(a)}i.prototype.toString=function(){return"[object Promise]"},i.prototype.caught=i.prototype.catch=function(a){var c=arguments.length;if(c>1){var C=new Array(c-1),A=0,F;for(F=0;F<c-1;++F){var L=arguments[F];if(typeof L=="function")C[A++]=L;else return i.reject(new u(`Catch filter must inherit from Error or be a simple predicate function

    See http://goo.gl/o84o68
`))}C.length=A,a=arguments[F];var b=new j(C,a,this);return this._then(void 0,b.doFilter,void 0,b,void 0)}return this._then(void 0,a,void 0,void 0,void 0)},i.prototype.reflect=function(){return this._then(x,x,void 0,this,void 0)},i.prototype.then=function(a,c,C){if(R()&&arguments.length>0&&typeof a!="function"&&typeof c!="function"){var A=".then() only accepts functions but was passed: "+v.classString(a);arguments.length>1&&(A+=", "+v.classString(c)),this._warn(A)}return this._then(a,c,C,void 0,void 0)},i.prototype.done=function(a,c,C){var A=this._then(a,c,C,void 0,void 0);A._setIsFinal()},i.prototype.spread=function(a,c){return this.all()._then(a,c,void 0,t,void 0)},i.prototype.isCancellable=function(){return!this.isResolved()&&this._cancellable()},i.prototype.toJSON=function(){var a={isFulfilled:!1,isRejected:!1,fulfillmentValue:void 0,rejectionReason:void 0};return this.isFulfilled()?(a.fulfillmentValue=this.value(),a.isFulfilled=!0):this.isRejected()&&(a.rejectionReason=this.reason(),a.isRejected=!0),a},i.prototype.all=function(){return new s(this).promise()},i.prototype.error=function(a){return this.caught(v.originatesFromRejection,a)},i.getNewLibraryCopy=m.exports,i.is=function(a){return a instanceof i},i.fromNode=function(a){var c=new i(o),C=T(a)(S(c));return C===D&&c._rejectCallback(C.e,!0,!0),c},i.all=function(a){return new s(a).promise()},i.defer=i.pending=function(){var a=new i(o);return new k(a)},i.cast=function(a){var c=l(a);if(!(c instanceof i)){var C=c;c=new i(o),c._fulfillUnchecked(C)}return c},i.resolve=i.fulfilled=i.cast,i.reject=i.rejected=function(a){var c=new i(o);return c._captureStackTrace(),c._rejectCallback(a,!0),c},i.setScheduler=function(a){if(typeof a!="function")throw new u(`fn must be a function

    See http://goo.gl/916lJJ
`);var c=y._schedule;return y._schedule=a,c},i.prototype._then=function(a,c,C,A,F){var L=F!==void 0,b=L?F:new i(o);L||(b._propagateFrom(this,5),b._captureStackTrace());var I=this._target();I!==this&&(A===void 0&&(A=this._boundTo),L||b._setIsMigrated());var H=I._addCallbacks(a,c,C,b,A,h());return I._isResolved()&&!I._isSettlePromisesQueued()&&y.invoke(I._settlePromiseAtPostResolution,I,H),b},i.prototype._settlePromiseAtPostResolution=function(a){this._isRejectionUnhandled()&&this._unsetRejectionIsUnhandled(),this._settlePromiseAt(a)},i.prototype._length=function(){return this._bitField&131071},i.prototype._isFollowingOrFulfilledOrRejected=function(){return(this._bitField&939524096)>0},i.prototype._isFollowing=function(){return(this._bitField&536870912)===536870912},i.prototype._setLength=function(a){this._bitField=this._bitField&-131072|a&131071},i.prototype._setFulfilled=function(){this._bitField=this._bitField|268435456},i.prototype._setRejected=function(){this._bitField=this._bitField|134217728},i.prototype._setFollowing=function(){this._bitField=this._bitField|536870912},i.prototype._setIsFinal=function(){this._bitField=this._bitField|33554432},i.prototype._isFinal=function(){return(this._bitField&33554432)>0},i.prototype._cancellable=function(){return(this._bitField&67108864)>0},i.prototype._setCancellable=function(){this._bitField=this._bitField|67108864},i.prototype._unsetCancellable=function(){this._bitField=this._bitField&-67108865},i.prototype._setIsMigrated=function(){this._bitField=this._bitField|4194304},i.prototype._unsetIsMigrated=function(){this._bitField=this._bitField&-4194305},i.prototype._isMigrated=function(){return(this._bitField&4194304)>0},i.prototype._receiverAt=function(a){var c=a===0?this._receiver0:this[a*5-5+4];if(c!==_)return c===void 0&&this._isBound()?this._boundValue():c},i.prototype._promiseAt=function(a){return a===0?this._promise0:this[a*5-5+3]},i.prototype._fulfillmentHandlerAt=function(a){return a===0?this._fulfillmentHandler0:this[a*5-5+0]},i.prototype._rejectionHandlerAt=function(a){return a===0?this._rejectionHandler0:this[a*5-5+1]},i.prototype._boundValue=function(){var a=this._boundTo;return a!==void 0&&a instanceof i?a.isFulfilled()?a.value():void 0:a},i.prototype._migrateCallbacks=function(a,c){var C=a._fulfillmentHandlerAt(c),A=a._rejectionHandlerAt(c),F=a._progressHandlerAt(c),L=a._promiseAt(c),b=a._receiverAt(c);L instanceof i&&L._setIsMigrated(),b===void 0&&(b=_),this._addCallbacks(C,A,F,L,b,null)},i.prototype._addCallbacks=function(a,c,C,A,F,L){var b=this._length();if(b>=131066&&(b=0,this._setLength(0)),b===0)this._promise0=A,F!==void 0&&(this._receiver0=F),typeof a=="function"&&!this._isCarryingStackTrace()&&(this._fulfillmentHandler0=L===null?a:L.bind(a)),typeof c=="function"&&(this._rejectionHandler0=L===null?c:L.bind(c)),typeof C=="function"&&(this._progressHandler0=L===null?C:L.bind(C));else{var I=b*5-5;this[I+3]=A,this[I+4]=F,typeof a=="function"&&(this[I+0]=L===null?a:L.bind(a)),typeof c=="function"&&(this[I+1]=L===null?c:L.bind(c)),typeof C=="function"&&(this[I+2]=L===null?C:L.bind(C))}return this._setLength(b+1),b},i.prototype._setProxyHandlers=function(a,c){var C=this._length();if(C>=131066&&(C=0,this._setLength(0)),C===0)this._promise0=c,this._receiver0=a;else{var A=C*5-5;this[A+3]=c,this[A+4]=a}this._setLength(C+1)},i.prototype._proxyPromiseArray=function(a,c){this._setProxyHandlers(a,c)},i.prototype._resolveCallback=function(a,c){if(!this._isFollowingOrFulfilledOrRejected()){if(a===this)return this._rejectCallback(n(),!1,!0);var C=l(a,this);if(!(C instanceof i))return this._fulfill(a);var A=1|(c?4:0);this._propagateFrom(C,A);var F=C._target();if(F._isPending()){for(var L=this._length(),b=0;b<L;++b)F._migrateCallbacks(this,b);this._setFollowing(),this._setLength(0),this._setFollowee(F)}else F._isFulfilled()?this._fulfillUnchecked(F._value()):this._rejectUnchecked(F._reason(),F._getCarriedStackTrace())}},i.prototype._rejectCallback=function(a,c,C){C||v.markAsOriginatingFromRejection(a);var A=v.ensureErrorObject(a),F=A===a;this._attachExtraTrace(A,c?F:!1),this._reject(a,F?void 0:A)},i.prototype._resolveFromResolver=function(a){var c=this;this._captureStackTrace(),this._pushContext();var C=!0,A=T(a)(function(F){c!==null&&(c._resolveCallback(F),c=null)},function(F){c!==null&&(c._rejectCallback(F,C),c=null)});C=!1,this._popContext(),A!==void 0&&A===D&&c!==null&&(c._rejectCallback(A.e,!0,!0),c=null)},i.prototype._settlePromiseFromHandler=function(a,c,C,A){if(!A._isRejected()){A._pushContext();var F;if(c===t&&!this._isRejected()?F=T(a).apply(this._boundValue(),C):F=T(a).call(c,C),A._popContext(),F===D||F===A||F===e){var L=F===A?n():F.e;A._rejectCallback(L,!1,!0)}else A._resolveCallback(F)}},i.prototype._target=function(){for(var a=this;a._isFollowing();)a=a._followee();return a},i.prototype._followee=function(){return this._rejectionHandler0},i.prototype._setFollowee=function(a){this._rejectionHandler0=a},i.prototype._cleanValues=function(){this._cancellable()&&(this._cancellationParent=void 0)},i.prototype._propagateFrom=function(a,c){(c&1)>0&&a._cancellable()&&(this._setCancellable(),this._cancellationParent=a),(c&4)>0&&a._isBound()&&this._setBoundTo(a._boundTo)},i.prototype._fulfill=function(a){this._isFollowingOrFulfilledOrRejected()||this._fulfillUnchecked(a)},i.prototype._reject=function(a,c){this._isFollowingOrFulfilledOrRejected()||this._rejectUnchecked(a,c)},i.prototype._settlePromiseAt=function(a){var c=this._promiseAt(a),C=c instanceof i;if(C&&c._isMigrated())return c._unsetIsMigrated(),y.invoke(this._settlePromiseAt,this,a);var A=this._isFulfilled()?this._fulfillmentHandlerAt(a):this._rejectionHandlerAt(a),F=this._isCarryingStackTrace()?this._getCarriedStackTrace():void 0,L=this._settledValue,b=this._receiverAt(a);this._clearCallbackDataAtIndex(a),typeof A=="function"?C?this._settlePromiseFromHandler(A,b,L,c):A.call(b,L,c):b instanceof s?b._isResolved()||(this._isFulfilled()?b._promiseFulfilled(L,c):b._promiseRejected(L,c)):C&&(this._isFulfilled()?c._fulfill(L):c._reject(L,F)),a>=4&&(a&31)===4&&y.invokeLater(this._setLength,this,0)},i.prototype._clearCallbackDataAtIndex=function(a){if(a===0)this._isCarryingStackTrace()||(this._fulfillmentHandler0=void 0),this._rejectionHandler0=this._progressHandler0=this._receiver0=this._promise0=void 0;else{var c=a*5-5;this[c+3]=this[c+4]=this[c+0]=this[c+1]=this[c+2]=void 0}},i.prototype._isSettlePromisesQueued=function(){return(this._bitField&-1073741824)===-1073741824},i.prototype._setSettlePromisesQueued=function(){this._bitField=this._bitField|-1073741824},i.prototype._unsetSettlePromisesQueued=function(){this._bitField=this._bitField&1073741823},i.prototype._queueSettlePromises=function(){y.settlePromises(this),this._setSettlePromisesQueued()},i.prototype._fulfillUnchecked=function(a){if(a===this){var c=n();return this._attachExtraTrace(c),this._rejectUnchecked(c,void 0)}this._setFulfilled(),this._settledValue=a,this._cleanValues(),this._length()>0&&this._queueSettlePromises()},i.prototype._rejectUncheckedCheckError=function(a){var c=v.ensureErrorObject(a);this._rejectUnchecked(a,c===a?void 0:c)},i.prototype._rejectUnchecked=function(a,c){if(a===this){var C=n();return this._attachExtraTrace(C),this._rejectUnchecked(C)}if(this._setRejected(),this._settledValue=a,this._cleanValues(),this._isFinal()){y.throwLater(function(A){throw"stack"in A&&y.invokeFirst(w.unhandledRejection,void 0,A),A},c===void 0?a:c);return}c!==void 0&&c!==a&&this._setCarriedStackTrace(c),this._length()>0?this._queueSettlePromises():this._ensurePossibleRejectionHandled()},i.prototype._settlePromises=function(){this._unsetSettlePromisesQueued();for(var a=this._length(),c=0;c<a;c++)this._settlePromiseAt(c)},v.notEnumerableProp(i,"_makeSelfResolutionError",n),r("./progress.js")(i,s),r("./method.js")(i,o,l,d),r("./bind.js")(i,o,l),r("./finally.js")(i,e,l),r("./direct_resolve.js")(i),r("./synchronous_inspection.js")(i),r("./join.js")(i,s,l,o),i.version="2.11.0",i.Promise=i,r("./map.js")(i,s,d,l,o),r("./cancel.js")(i),r("./using.js")(i,d,l,g),r("./generators.js")(i,d,o,l),r("./nodeify.js")(i),r("./call_get.js")(i),r("./props.js")(i,s,l,d),r("./race.js")(i,o,l,d),r("./reduce.js")(i,s,d,l,o),r("./settle.js")(i,s),r("./some.js")(i,s,d),r("./promisify.js")(i,o),r("./any.js")(i),r("./each.js")(i,o),r("./timers.js")(i,o),r("./filter.js")(i,o),v.toFastProperties(i),v.toFastProperties(i.prototype);function P(a){var c=new i(o);c._fulfillmentHandler0=a,c._rejectionHandler0=a,c._progressHandler0=a,c._promise0=a,c._receiver0=a,c._settledValue=a}return P({a:1}),P({b:2}),P({c:3}),P(1),P(function(){}),P(void 0),P(!1),P(new i(o)),w.setBounds(y.firstLineError,v.lastLineError),i}},{"./any.js":1,"./async.js":2,"./bind.js":3,"./call_get.js":5,"./cancel.js":6,"./captured_trace.js":7,"./catch_filter.js":8,"./context.js":9,"./debuggability.js":10,"./direct_resolve.js":11,"./each.js":12,"./errors.js":13,"./filter.js":15,"./finally.js":16,"./generators.js":17,"./join.js":18,"./map.js":19,"./method.js":20,"./nodeify.js":21,"./progress.js":22,"./promise_array.js":24,"./promise_resolver.js":25,"./promisify.js":26,"./props.js":27,"./race.js":29,"./reduce.js":30,"./settle.js":32,"./some.js":33,"./synchronous_inspection.js":34,"./thenables.js":35,"./timers.js":36,"./using.js":37,"./util.js":38}],24:[function(r,m,N){m.exports=function(n,x,d,v){var h=r("./util.js"),_=h.isArray;function y(u){switch(u){case-2:return[];case-3:return{}}}function f(u){var o=this._promise=new n(x),t;u instanceof n&&(t=u,o._propagateFrom(t,5)),this._values=u,this._length=0,this._totalResolved=0,this._init(void 0,-2)}return f.prototype.length=function(){return this._length},f.prototype.promise=function(){return this._promise},f.prototype._init=function u(o,t){var e=d(this._values,this._promise);if(e instanceof n)if(e=e._target(),this._values=e,e._isFulfilled()){if(e=e._value(),!_(e)){var l=new n.TypeError(`expecting an array, a promise or a thenable

    See http://goo.gl/s8MMhc
`);this.__hardReject__(l);return}}else if(e._isPending()){e._then(u,this._reject,void 0,this,t);return}else{this._reject(e._reason());return}else if(!_(e)){this._promise._reject(v(`expecting an array, a promise or a thenable

    See http://goo.gl/s8MMhc
`)._reason());return}if(e.length===0){t===-5?this._resolveEmptyArray():this._resolve(y(t));return}var s=this.getActualLength(e.length);this._length=s,this._values=this.shouldCopyValues()?new Array(s):this._values;for(var w=this._promise,R=0;R<s;++R){var g=this._isResolved(),j=d(e[R],w);j instanceof n?(j=j._target(),g?j._ignoreRejections():j._isPending()?j._proxyPromiseArray(this,R):j._isFulfilled()?this._promiseFulfilled(j._value(),R):this._promiseRejected(j._reason(),R)):g||this._promiseFulfilled(j,R)}},f.prototype._isResolved=function(){return this._values===null},f.prototype._resolve=function(u){this._values=null,this._promise._fulfill(u)},f.prototype.__hardReject__=f.prototype._reject=function(u){this._values=null,this._promise._rejectCallback(u,!1,!0)},f.prototype._promiseProgressed=function(u,o){this._promise._progress({index:o,value:u})},f.prototype._promiseFulfilled=function(u,o){this._values[o]=u;var t=++this._totalResolved;t>=this._length&&this._resolve(this._values)},f.prototype._promiseRejected=function(u,o){this._totalResolved++,this._reject(u)},f.prototype.shouldCopyValues=function(){return!0},f.prototype.getActualLength=function(u){return u},f}},{"./util.js":38}],25:[function(r,m,N){var n=r("./util.js"),x=n.maybeWrapAsError,d=r("./errors.js"),v=d.TimeoutError,h=d.OperationalError,_=n.haveGetters,y=r("./es5.js");function f(s){return s instanceof Error&&y.getPrototypeOf(s)===Error.prototype}var u=/^(?:name|message|stack|cause)$/;function o(s){var w;if(f(s)){w=new h(s),w.name=s.name,w.message=s.message,w.stack=s.stack;for(var R=y.keys(s),g=0;g<R.length;++g){var j=R[g];u.test(j)||(w[j]=s[j])}return w}return n.markAsOriginatingFromRejection(s),s}function t(s){return function(w,R){if(s!==null){if(w){var g=o(x(w));s._attachExtraTrace(g),s._reject(g)}else if(arguments.length>2){for(var j=arguments.length,k=new Array(j-1),S=1;S<j;++S)k[S-1]=arguments[S];s._fulfill(k)}else s._fulfill(R);s=null}}}var e;if(_?e=function(s){this.promise=s}:e=function(s){this.promise=s,this.asCallback=t(s),this.callback=this.asCallback},_){var l={get:function(){return t(this.promise)}};y.defineProperty(e.prototype,"asCallback",l),y.defineProperty(e.prototype,"callback",l)}e._nodebackForPromise=t,e.prototype.toString=function(){return"[object PromiseResolver]"},e.prototype.resolve=e.prototype.fulfill=function(s){if(!(this instanceof e))throw new TypeError(`Illegal invocation, resolver resolve/reject must be called within a resolver context. Consider using the promise constructor instead.

    See http://goo.gl/sdkXL9
`);this.promise._resolveCallback(s)},e.prototype.reject=function(s){if(!(this instanceof e))throw new TypeError(`Illegal invocation, resolver resolve/reject must be called within a resolver context. Consider using the promise constructor instead.

    See http://goo.gl/sdkXL9
`);this.promise._rejectCallback(s)},e.prototype.progress=function(s){if(!(this instanceof e))throw new TypeError(`Illegal invocation, resolver resolve/reject must be called within a resolver context. Consider using the promise constructor instead.

    See http://goo.gl/sdkXL9
`);this.promise._progress(s)},e.prototype.cancel=function(s){this.promise.cancel(s)},e.prototype.timeout=function(){this.reject(new v("timeout"))},e.prototype.isResolved=function(){return this.promise.isResolved()},e.prototype.toJSON=function(){return this.promise.toJSON()},m.exports=e},{"./errors.js":13,"./es5.js":14,"./util.js":38}],26:[function(r,m,N){m.exports=function(n,x){var d={},v=r("./util.js"),h=r("./promise_resolver.js")._nodebackForPromise,_=v.withAppended,y=v.maybeWrapAsError,f=v.canEvaluate,u=r("./errors").TypeError,o="Async",t={__isPromisified__:!0},e=["arity","length","name","arguments","caller","callee","prototype","__isPromisified__"],l=new RegExp("^(?:"+e.join("|")+")$"),s=function(c){return v.isIdentifier(c)&&c.charAt(0)!=="_"&&c!=="constructor"};function w(c){return!l.test(c)}function R(c){try{return c.__isPromisified__===!0}catch(C){return!1}}function g(c,C,A){var F=v.getDataPropertyOrDefault(c,C+A,t);return F?R(F):!1}function j(c,C,A){for(var F=0;F<c.length;F+=2){var L=c[F];if(A.test(L)){for(var b=L.replace(A,""),I=0;I<c.length;I+=2)if(c[I]===b)throw new u(`Cannot promisify an API that has normal methods with '%s'-suffix

    See http://goo.gl/iWrZbw
`.replace("%s",C))}}}function k(c,C,A,F){for(var L=v.inheritedDataKeys(c),b=[],I=0;I<L.length;++I){var H=L[I],M=c[H],$=F===s?!0:s(H);typeof M=="function"&&!R(M)&&!g(c,H,C)&&F(H,M,c,$)&&b.push(H,M)}return j(b,C,A),b}var S=function(c){return c.replace(/([$])/,"\\$")},D;function T(c,C,A,F){var L=(function(){return this})(),b=c;typeof b=="string"&&(c=F);function I(){var H=C;C===d&&(H=this);var M=new n(x);M._captureStackTrace();var $=typeof b=="string"&&this!==L?this[b]:c,q=h(M);try{$.apply(H,_(arguments,q))}catch(z){M._rejectCallback(y(z),!0,!0)}return M}return v.notEnumerableProp(I,"__isPromisified__",!0),I}var i=f?D:T;function P(c,C,A,F){for(var L=new RegExp(S(C)+"$"),b=k(c,C,L,A),I=0,H=b.length;I<H;I+=2){var M=b[I],$=b[I+1],q=M+C;if(F===i)c[q]=i(M,d,M,$,C);else{var z=F($,function(){return i(M,d,M,$,C)});v.notEnumerableProp(z,"__isPromisified__",!0),c[q]=z}}return v.toFastProperties(c),c}function a(c,C){return i(c,C,void 0,c)}n.promisify=function(c,C){if(typeof c!="function")throw new u(`fn must be a function

    See http://goo.gl/916lJJ
`);if(R(c))return c;var A=a(c,arguments.length<2?d:C);return v.copyDescriptors(c,A,w),A},n.promisifyAll=function(c,C){if(typeof c!="function"&&typeof c!="object")throw new u(`the target of promisifyAll must be an object or a function

    See http://goo.gl/9ITlV0
`);C=Object(C);var A=C.suffix;typeof A!="string"&&(A=o);var F=C.filter;typeof F!="function"&&(F=s);var L=C.promisifier;if(typeof L!="function"&&(L=i),!v.isIdentifier(A))throw new RangeError(`suffix must be a valid identifier

    See http://goo.gl/8FZo5V
`);for(var b=v.inheritedDataKeys(c),I=0;I<b.length;++I){var H=c[b[I]];b[I]!=="constructor"&&v.isClass(H)&&(P(H.prototype,A,F,L),P(H,A,F,L))}return P(c,A,F,L)}}},{"./errors":13,"./promise_resolver.js":25,"./util.js":38}],27:[function(r,m,N){m.exports=function(n,x,d,v){var h=r("./util.js"),_=h.isObject,y=r("./es5.js");function f(o){for(var t=y.keys(o),e=t.length,l=new Array(e*2),s=0;s<e;++s){var w=t[s];l[s]=o[w],l[s+e]=w}this.constructor$(l)}h.inherits(f,x),f.prototype._init=function(){this._init$(void 0,-3)},f.prototype._promiseFulfilled=function(o,t){this._values[t]=o;var e=++this._totalResolved;if(e>=this._length){for(var l={},s=this.length(),w=0,R=this.length();w<R;++w)l[this._values[w+s]]=this._values[w];this._resolve(l)}},f.prototype._promiseProgressed=function(o,t){this._promise._progress({key:this._values[t+this.length()],value:o})},f.prototype.shouldCopyValues=function(){return!1},f.prototype.getActualLength=function(o){return o>>1};function u(o){var t,e=d(o);if(_(e))e instanceof n?t=e._then(n.props,void 0,void 0,void 0,void 0):t=new f(e).promise();else return v(`cannot await properties of a non-object

    See http://goo.gl/OsFKC8
`);return e instanceof n&&t._propagateFrom(e,4),t}n.prototype.props=function(){return u(this)},n.props=function(o){return u(o)}}},{"./es5.js":14,"./util.js":38}],28:[function(r,m,N){function n(d,v,h,_,y){for(var f=0;f<y;++f)h[f+_]=d[f+v],d[f+v]=void 0}function x(d){this._capacity=d,this._length=0,this._front=0}x.prototype._willBeOverCapacity=function(d){return this._capacity<d},x.prototype._pushOne=function(d){var v=this.length();this._checkCapacity(v+1);var h=this._front+v&this._capacity-1;this[h]=d,this._length=v+1},x.prototype._unshiftOne=function(d){var v=this._capacity;this._checkCapacity(this.length()+1);var h=this._front,_=(h-1&v-1^v)-v;this[_]=d,this._front=_,this._length=this.length()+1},x.prototype.unshift=function(d,v,h){this._unshiftOne(h),this._unshiftOne(v),this._unshiftOne(d)},x.prototype.push=function(d,v,h){var _=this.length()+3;if(this._willBeOverCapacity(_)){this._pushOne(d),this._pushOne(v),this._pushOne(h);return}var y=this._front+_-3;this._checkCapacity(_);var f=this._capacity-1;this[y+0&f]=d,this[y+1&f]=v,this[y+2&f]=h,this._length=_},x.prototype.shift=function(){var d=this._front,v=this[d];return this[d]=void 0,this._front=d+1&this._capacity-1,this._length--,v},x.prototype.length=function(){return this._length},x.prototype._checkCapacity=function(d){this._capacity<d&&this._resizeTo(this._capacity<<1)},x.prototype._resizeTo=function(d){var v=this._capacity;this._capacity=d;var h=this._front,_=this._length,y=h+_&v-1;n(this,0,this,v,y)},m.exports=x},{}],29:[function(r,m,N){m.exports=function(n,x,d,v){var h=r("./util.js").isArray,_=function(f){return f.then(function(u){return y(u,f)})};function y(f,u){var o=d(f);if(o instanceof n)return _(o);if(!h(f))return v(`expecting an array, a promise or a thenable

    See http://goo.gl/s8MMhc
`);var t=new n(x);u!==void 0&&t._propagateFrom(u,5);for(var e=t._fulfill,l=t._reject,s=0,w=f.length;s<w;++s){var R=f[s];R===void 0&&!(s in f)||n.cast(R)._then(e,l,void 0,t,null)}return t}n.race=function(f){return y(f,void 0)},n.prototype.race=function(){return y(this,void 0)}}},{"./util.js":38}],30:[function(r,m,N){m.exports=function(n,x,d,v,h){var _=n._getDomain,y=r("./async.js"),f=r("./util.js"),u=f.tryCatch,o=f.errorObj;function t(s,w,R,g){this.constructor$(s),this._promise._captureStackTrace(),this._preservedValues=g===h?[]:null,this._zerothIsAccum=R===void 0,this._gotAccum=!1,this._reducingIndex=this._zerothIsAccum?1:0,this._valuesPhase=void 0;var j=v(R,this._promise),k=!1,S=j instanceof n;S&&(j=j._target(),j._isPending()?j._proxyPromiseArray(this,-1):j._isFulfilled()?(R=j._value(),this._gotAccum=!0):(this._reject(j._reason()),k=!0)),S||this._zerothIsAccum||(this._gotAccum=!0);var D=_();this._callback=D===null?w:D.bind(w),this._accum=R,k||y.invoke(e,this,void 0)}function e(){this._init$(void 0,-5)}f.inherits(t,x),t.prototype._init=function(){},t.prototype._resolveEmptyArray=function(){(this._gotAccum||this._zerothIsAccum)&&this._resolve(this._preservedValues!==null?[]:this._accum)},t.prototype._promiseFulfilled=function(s,w){var R=this._values;R[w]=s;var g=this.length(),j=this._preservedValues,k=j!==null,S=this._gotAccum,D=this._valuesPhase,T;if(!D)for(D=this._valuesPhase=new Array(g),T=0;T<g;++T)D[T]=0;if(T=D[w],w===0&&this._zerothIsAccum?(this._accum=s,this._gotAccum=S=!0,D[w]=T===0?1:2):w===-1?(this._accum=s,this._gotAccum=S=!0):T===0?D[w]=1:(D[w]=2,this._accum=s),!!S){for(var i=this._callback,P=this._promise._boundValue(),a,c=this._reducingIndex;c<g;++c){if(T=D[c],T===2){this._reducingIndex=c+1;continue}if(T!==1)return;if(s=R[c],this._promise._pushContext(),k?(j.push(s),a=u(i).call(P,s,c,g)):a=u(i).call(P,this._accum,s,c,g),this._promise._popContext(),a===o)return this._reject(a.e);var C=v(a,this._promise);if(C instanceof n){if(C=C._target(),C._isPending())return D[c]=4,C._proxyPromiseArray(this,c);if(C._isFulfilled())a=C._value();else return this._reject(C._reason())}this._reducingIndex=c+1,this._accum=a}this._resolve(k?j:this._accum)}};function l(s,w,R,g){if(typeof w!="function")return d(`fn must be a function

    See http://goo.gl/916lJJ
`);var j=new t(s,w,R,g);return j.promise()}n.prototype.reduce=function(s,w){return l(this,s,w,null)},n.reduce=function(s,w,R,g){return l(s,w,R,g)}}},{"./async.js":2,"./util.js":38}],31:[function(r,m,N){var n,x=r("./util"),d=function(){throw new Error(`No async scheduler available

    See http://goo.gl/m3OTXk
`)};if(x.isNode&&typeof MutationObserver=="undefined"){var v=ht.setImmediate,h=process.nextTick;n=x.isRecentNode?function(_){v.call(ht,_)}:function(_){h.call(process,_)}}else typeof MutationObserver!="undefined"&&!(typeof window!="undefined"&&window.navigator&&window.navigator.standalone)?(n=function(_){var y=document.createElement("div"),f=new MutationObserver(_);return f.observe(y,{attributes:!0}),function(){y.classList.toggle("foo")}},n.isStatic=!0):typeof setImmediate!="undefined"?n=function(_){setImmediate(_)}:typeof setTimeout!="undefined"?n=function(_){setTimeout(_,0)}:n=d;m.exports=n},{"./util":38}],32:[function(r,m,N){m.exports=function(n,x){var d=n.PromiseInspection,v=r("./util.js");function h(_){this.constructor$(_)}v.inherits(h,x),h.prototype._promiseResolved=function(_,y){this._values[_]=y;var f=++this._totalResolved;f>=this._length&&this._resolve(this._values)},h.prototype._promiseFulfilled=function(_,y){var f=new d;f._bitField=268435456,f._settledValue=_,this._promiseResolved(y,f)},h.prototype._promiseRejected=function(_,y){var f=new d;f._bitField=134217728,f._settledValue=_,this._promiseResolved(y,f)},n.settle=function(_){return new h(_).promise()},n.prototype.settle=function(){return new h(this).promise()}}},{"./util.js":38}],33:[function(r,m,N){m.exports=function(n,x,d){var v=r("./util.js"),h=r("./errors.js").RangeError,_=r("./errors.js").AggregateError,y=v.isArray;function f(o){this.constructor$(o),this._howMany=0,this._unwrap=!1,this._initialized=!1}v.inherits(f,x),f.prototype._init=function(){if(this._initialized){if(this._howMany===0){this._resolve([]);return}this._init$(void 0,-5);var o=y(this._values);!this._isResolved()&&o&&this._howMany>this._canPossiblyFulfill()&&this._reject(this._getRangeError(this.length()))}},f.prototype.init=function(){this._initialized=!0,this._init()},f.prototype.setUnwrap=function(){this._unwrap=!0},f.prototype.howMany=function(){return this._howMany},f.prototype.setHowMany=function(o){this._howMany=o},f.prototype._promiseFulfilled=function(o){this._addFulfilled(o),this._fulfilled()===this.howMany()&&(this._values.length=this.howMany(),this.howMany()===1&&this._unwrap?this._resolve(this._values[0]):this._resolve(this._values))},f.prototype._promiseRejected=function(o){if(this._addRejected(o),this.howMany()>this._canPossiblyFulfill()){for(var t=new _,e=this.length();e<this._values.length;++e)t.push(this._values[e]);this._reject(t)}},f.prototype._fulfilled=function(){return this._totalResolved},f.prototype._rejected=function(){return this._values.length-this.length()},f.prototype._addRejected=function(o){this._values.push(o)},f.prototype._addFulfilled=function(o){this._values[this._totalResolved++]=o},f.prototype._canPossiblyFulfill=function(){return this.length()-this._rejected()},f.prototype._getRangeError=function(o){var t="Input array must contain at least "+this._howMany+" items but contains only "+o+" items";return new h(t)},f.prototype._resolveEmptyArray=function(){this._reject(this._getRangeError(0))};function u(o,t){if((t|0)!==t||t<0)return d(`expecting a positive integer

    See http://goo.gl/1wAmHx
`);var e=new f(o),l=e.promise();return e.setHowMany(t),e.init(),l}n.some=function(o,t){return u(o,t)},n.prototype.some=function(o){return u(this,o)},n._SomePromiseArray=f}},{"./errors.js":13,"./util.js":38}],34:[function(r,m,N){m.exports=function(n){function x(d){d!==void 0?(d=d._target(),this._bitField=d._bitField,this._settledValue=d._settledValue):(this._bitField=0,this._settledValue=void 0)}x.prototype.value=function(){if(!this.isFulfilled())throw new TypeError(`cannot get fulfillment value of a non-fulfilled promise

    See http://goo.gl/hc1DLj
`);return this._settledValue},x.prototype.error=x.prototype.reason=function(){if(!this.isRejected())throw new TypeError(`cannot get rejection reason of a non-rejected promise

    See http://goo.gl/hPuiwB
`);return this._settledValue},x.prototype.isFulfilled=n.prototype._isFulfilled=function(){return(this._bitField&268435456)>0},x.prototype.isRejected=n.prototype._isRejected=function(){return(this._bitField&134217728)>0},x.prototype.isPending=n.prototype._isPending=function(){return(this._bitField&402653184)===0},x.prototype.isResolved=n.prototype._isResolved=function(){return(this._bitField&402653184)>0},n.prototype.isPending=function(){return this._target()._isPending()},n.prototype.isRejected=function(){return this._target()._isRejected()},n.prototype.isFulfilled=function(){return this._target()._isFulfilled()},n.prototype.isResolved=function(){return this._target()._isResolved()},n.prototype._value=function(){return this._settledValue},n.prototype._reason=function(){return this._unsetRejectionIsUnhandled(),this._settledValue},n.prototype.value=function(){var d=this._target();if(!d.isFulfilled())throw new TypeError(`cannot get fulfillment value of a non-fulfilled promise

    See http://goo.gl/hc1DLj
`);return d._settledValue},n.prototype.reason=function(){var d=this._target();if(!d.isRejected())throw new TypeError(`cannot get rejection reason of a non-rejected promise

    See http://goo.gl/hPuiwB
`);return d._unsetRejectionIsUnhandled(),d._settledValue},n.PromiseInspection=x}},{}],35:[function(r,m,N){m.exports=function(n,x){var d=r("./util.js"),v=d.errorObj,h=d.isObject;function _(t,e){if(h(t)){if(t instanceof n)return t;if(u(t)){var l=new n(x);return t._then(l._fulfillUnchecked,l._rejectUncheckedCheckError,l._progressUnchecked,l,null),l}var s=d.tryCatch(y)(t);if(s===v){e&&e._pushContext();var l=n.reject(s.e);return e&&e._popContext(),l}else if(typeof s=="function")return o(t,s,e)}return t}function y(t){return t.then}var f={}.hasOwnProperty;function u(t){return f.call(t,"_promise0")}function o(t,e,l){var s=new n(x),w=s;l&&l._pushContext(),s._captureStackTrace(),l&&l._popContext();var R=!0,g=d.tryCatch(e).call(t,j,k,S);R=!1,s&&g===v&&(s._rejectCallback(g.e,!0,!0),s=null);function j(D){s&&(s._resolveCallback(D),s=null)}function k(D){s&&(s._rejectCallback(D,R,!0),s=null)}function S(D){s&&typeof s._progress=="function"&&s._progress(D)}return w}return _}},{"./util.js":38}],36:[function(r,m,N){m.exports=function(n,x){var d=r("./util.js"),v=n.TimeoutError,h=function(o,t){if(o.isPending()){var e;!d.isPrimitive(t)&&t instanceof Error?e=t:(typeof t!="string"&&(t="operation timed out"),e=new v(t)),d.markAsOriginatingFromRejection(e),o._attachExtraTrace(e),o._cancel(e)}},_=function(o){return y(+this).thenReturn(o)},y=n.delay=function(o,t){if(t===void 0){t=o,o=void 0;var e=new n(x);return setTimeout(function(){e._fulfill()},t),e}return t=+t,n.resolve(o)._then(_,null,null,t,void 0)};n.prototype.delay=function(o){return y(this,o)};function f(o){var t=this;return t instanceof Number&&(t=+t),clearTimeout(t),o}function u(o){var t=this;throw t instanceof Number&&(t=+t),clearTimeout(t),o}n.prototype.timeout=function(o,t){o=+o;var e=this.then().cancellable();e._cancellationParent=this;var l=setTimeout(function(){h(e,t)},o);return e._then(f,u,void 0,l,void 0)}}},{"./util.js":38}],37:[function(r,m,N){m.exports=function(n,x,d,v){var h=r("./errors.js").TypeError,_=r("./util.js").inherits,y=n.PromiseInspection;function f(g){for(var j=g.length,k=0;k<j;++k){var S=g[k];if(S.isRejected())return n.reject(S.error());g[k]=S._settledValue}return g}function u(g){setTimeout(function(){throw g},0)}function o(g){var j=d(g);return j!==g&&typeof g._isDisposable=="function"&&typeof g._getDisposer=="function"&&g._isDisposable()&&j._setDisposable(g._getDisposer()),j}function t(g,j){var k=0,S=g.length,D=n.defer();function T(){if(k>=S)return D.resolve();var i=o(g[k++]);if(i instanceof n&&i._isDisposable()){try{i=d(i._getDisposer().tryDispose(j),g.promise)}catch(P){return u(P)}if(i instanceof n)return i._then(T,u,null,null,null)}T()}return T(),D.promise}function e(g){var j=new y;return j._settledValue=g,j._bitField=268435456,t(this,j).thenReturn(g)}function l(g){var j=new y;return j._settledValue=g,j._bitField=134217728,t(this,j).thenThrow(g)}function s(g,j,k){this._data=g,this._promise=j,this._context=k}s.prototype.data=function(){return this._data},s.prototype.promise=function(){return this._promise},s.prototype.resource=function(){return this.promise().isFulfilled()?this.promise().value():null},s.prototype.tryDispose=function(g){var j=this.resource(),k=this._context;k!==void 0&&k._pushContext();var S=j!==null?this.doDispose(j,g):null;return k!==void 0&&k._popContext(),this._promise._unsetDisposable(),this._data=null,S},s.isDisposer=function(g){return g!=null&&typeof g.resource=="function"&&typeof g.tryDispose=="function"};function w(g,j,k){this.constructor$(g,j,k)}_(w,s),w.prototype.doDispose=function(g,j){var k=this.data();return k.call(g,g,j)};function R(g){return s.isDisposer(g)?(this.resources[this.index]._setDisposable(g),g.promise()):g}n.using=function(){var g=arguments.length;if(g<2)return x("you must pass at least 2 arguments to Promise.using");var j=arguments[g-1];if(typeof j!="function")return x(`fn must be a function

    See http://goo.gl/916lJJ
`);var k,S=!0;g===2&&Array.isArray(arguments[0])?(k=arguments[0],g=k.length,S=!1):(k=arguments,g--);for(var D=new Array(g),T=0;T<g;++T){var i=k[T];if(s.isDisposer(i)){var P=i;i=i.promise(),i._setDisposable(P)}else{var a=d(i);a instanceof n&&(i=a._then(R,null,null,{resources:D,index:T},void 0))}D[T]=i}var c=n.settle(D).then(f).then(function(C){c._pushContext();var A;try{A=S?j.apply(void 0,C):j.call(void 0,C)}finally{c._popContext()}return A})._then(e,l,void 0,D,void 0);return D.promise=c,c},n.prototype._setDisposable=function(g){this._bitField=this._bitField|262144,this._disposer=g},n.prototype._isDisposable=function(){return(this._bitField&262144)>0},n.prototype._getDisposer=function(){return this._disposer},n.prototype._unsetDisposable=function(){this._bitField=this._bitField&-262145,this._disposer=void 0},n.prototype.disposer=function(g){if(typeof g=="function")return new w(g,this,v());throw new h}}},{"./errors.js":13,"./util.js":38}],38:[function(r,m,N){var n=r("./es5.js"),x=typeof navigator=="undefined",d=(function(){try{var b={};return n.defineProperty(b,"f",{get:function(){return 3}}),b.f===3}catch(I){return!1}})(),v={e:{}},h;function _(){try{var b=h;return h=null,b.apply(this,arguments)}catch(I){return v.e=I,v}}function y(b){return h=b,_}var f=function(b,I){var H={}.hasOwnProperty;function M(){this.constructor=b,this.constructor$=I;for(var $ in I.prototype)H.call(I.prototype,$)&&$.charAt($.length-1)!=="$"&&(this[$+"$"]=I.prototype[$])}return M.prototype=I.prototype,b.prototype=new M,b.prototype};function u(b){return b==null||b===!0||b===!1||typeof b=="string"||typeof b=="number"}function o(b){return!u(b)}function t(b){return u(b)?new Error(i(b)):b}function e(b,I){var H=b.length,M=new Array(H+1),$;for($=0;$<H;++$)M[$]=b[$];return M[$]=I,M}function l(b,I,H){if(n.isES5){var M=Object.getOwnPropertyDescriptor(b,I);if(M!=null)return M.get==null&&M.set==null?M.value:H}else return{}.hasOwnProperty.call(b,I)?b[I]:void 0}function s(b,I,H){if(u(b))return b;var M={value:H,configurable:!0,enumerable:!1,writable:!0};return n.defineProperty(b,I,M),b}function w(b){throw b}var R=(function(){var b=[Array.prototype,Object.prototype,Function.prototype],I=function($){for(var q=0;q<b.length;++q)if(b[q]===$)return!0;return!1};if(n.isES5){var H=Object.getOwnPropertyNames;return function($){for(var q=[],z=Object.create(null);$!=null&&!I($);){var J;try{J=H($)}catch(ee){return q}for(var Z=0;Z<J.length;++Z){var X=J[Z];if(!z[X]){z[X]=!0;var tt=Object.getOwnPropertyDescriptor($,X);tt!=null&&tt.get==null&&tt.set==null&&q.push(X)}}$=n.getPrototypeOf($)}return q}}else{var M={}.hasOwnProperty;return function($){if(I($))return[];var q=[];t:for(var z in $)if(M.call($,z))q.push(z);else{for(var J=0;J<b.length;++J)if(M.call(b[J],z))continue t;q.push(z)}return q}}})(),g=/this\s*\.\s*\S+\s*=/;function j(b){try{if(typeof b=="function"){var I=n.names(b.prototype),H=n.isES5&&I.length>1,M=I.length>0&&!(I.length===1&&I[0]==="constructor"),$=g.test(b+"")&&n.names(b).length>0;if(H||M||$)return!0}return!1}catch(q){return!1}}function k(b){return b}var S=/^[a-z$_][a-z$_0-9]*$/i;function D(b){return S.test(b)}function T(b,I,H){for(var M=new Array(b),$=0;$<b;++$)M[$]=I+$+H;return M}function i(b){try{return b+""}catch(I){return"[no string representation]"}}function P(b){try{s(b,"isOperational",!0)}catch(I){}}function a(b){return b==null?!1:b instanceof Error.__BluebirdErrorTypes__.OperationalError||b.isOperational===!0}function c(b){return b instanceof Error&&n.propertyIsWritable(b,"stack")}var C=(function(){return"stack"in new Error?function(b){return c(b)?b:new Error(i(b))}:function(b){if(c(b))return b;try{throw new Error(i(b))}catch(I){return I}}})();function A(b){return{}.toString.call(b)}function F(b,I,H){for(var M=n.names(b),$=0;$<M.length;++$){var q=M[$];if(H(q))try{n.defineProperty(I,q,n.getDescriptor(b,q))}catch(z){}}}var L={isClass:j,isIdentifier:D,inheritedDataKeys:R,getDataPropertyOrDefault:l,thrower:w,isArray:n.isArray,haveGetters:d,notEnumerableProp:s,isPrimitive:u,isObject:o,canEvaluate:x,errorObj:v,tryCatch:y,inherits:f,withAppended:e,maybeWrapAsError:t,toFastProperties:k,filledRange:T,toString:i,canAttachTrace:c,ensureErrorObject:C,originatesFromRejection:a,markAsOriginatingFromRejection:P,classString:A,copyDescriptors:F,hasDevTools:typeof chrome!="undefined"&&chrome&&typeof chrome.loadTimes=="function",isNode:typeof process!="undefined"&&A(process).toLowerCase()==="[object process]"};L.isRecentNode=L.isNode&&(function(){var b=process.versions.node.split(".").map(Number);return b[0]===0&&b[1]>10||b[0]>0})(),L.isNode&&L.toFastProperties(process);try{throw new Error}catch(b){L.lastLineError=b}m.exports=L},{"./es5.js":14}]},{},[4])(4)}),typeof window!="undefined"&&window!==null?window.P=window.Promise:typeof self!="undefined"&&self!==null&&(self.P=self.Promise)})(st)),st.exports}var ot,xt;function St(){if(xt)return ot;xt=1;var U=Tt(),O=ut(),E=ft();r.prototype=Object.create(U.prototype),r.prototype.constructor=r;function r(m,N){U.call(this,m,N),this.baseURL=this.baseURL+"/checkout-invoice"}return r.prototype.create=function(){var m=this,N=m.generateRequestBody();return new E(function(n,x){O.post(m.baseURL+"/create").set(m.config).send(N).end(function(d,v){if(d)return x(d);if(v.body.response_code==="00")m.token=v.body.token,m.url=v.body.response_text,n(m.confirm());else{var h=new Error("Failed to create invoice.");h.data=v.body,x(h)}})})},r.prototype.confirm=function(m){var N=this,n=m||N.token;return new E(function(x,d){O.get(N.baseURL+"/confirm/"+n).set(N.config).end(function(v,h){if(v)return d(v);var _=h.body;if(_.response_code==="00")N.status=_.status,N.responseText=_.response_text,N.status==="completed"&&(N.customer=_.customer,N.receiptURL=_.receipt_url,N.receipt_identifier=_.receipt_identifier,N.provider_reference=_.provider_reference,_.custom_data&&Object.keys(_.custom_data).length>0&&(N.customData=_.custom_data)),N.totalAmount=_.invoice.total_amount,x();else{var y=new Error("Could not confirm invoice status.");y.data=_,d(y)}})})},ot=r,ot}var at,bt;function Bt(){if(bt)return at;bt=1;var U=Tt(),O=ut(),E=ft();r.prototype=Object.create(U.prototype),r.prototype.constructor=r;function r(m,N){U.call(this,m,N),this.baseURL=this.baseURL+"/opr"}return r.prototype.create=function(m){var N=this,n={invoice_data:N.generateRequestBody(),opr_data:{account_alias:String(m)}};return new E(function(x,d){O.post(N.baseURL+"/create").set(N.config).send(n).end(function(v,h){if(v)return d(v);if(h.body.response_code==="00")N.token=h.body.invoice_token,N.oprToken=h.body.token,N.responseText=h.body.description,x();else{var _=new Error("Failed to create invoice");_.data=h.body,d(_)}})})},r.prototype.charge=function(m,N){var n=this,x={token:m+"",confirm_token:N+""};return new E(function(d,v){O.post(n.baseURL+"/charge").set(n.config).send(x).end(function(h,_){if(h)return v(h);if(_.body.response_code==="00")n.responseText=_.body.response_text,n.status=_.body.invoice_data.status,n.receiptURL=_.body.invoice_data.receipt_url,n.customer=_.body.invoice_data.customer,d();else{var y=new Error("Failed to charge invoice. Check OPR/confirm token and try again.");y.data=_.body,v(y)}})})},at=r,at}const zt={},Qt=Object.freeze(Object.defineProperty({__proto__:null,default:zt},Symbol.toStringTag,{value:"Module"})),Yt=$t(Qt);var lt,jt;function Jt(){if(jt)return lt;jt=1;var U=ut(),O=ft(),E=Yt;function r(m){if(!(m&&m.config))throw new Error("Must be initialized with instance of paydunya.Setup");this.config=m.config,this.baseURL=m.baseURL+"/direct-pay"}return r.prototype.creditAccount=function(m,N){var n=this,x={account_alias:m,amount:Number(N)};return new O(function(d,v){U.post(n.baseURL+"/credit-account").set(n.config).send(x).end(function(h,_){if(h)return v(h);if(_.body.response_code==="00")n.responseText=_.body.response_text,n.description=_.body.description,n.transactionID=_.body.transaction_id,d();else{var y=new Error(new Error(E.format("Failed to credit account. Please ensure %s and %s are valid OR check your account balance.",m,N)));y.data=_.body,v(y)}})})},lt=r,lt}var wt;function Kt(){if(wt)return Q;wt=1;var U={};Q.Setup=Q.setup=O,Q.Store=Q.store=E,Q.CheckoutInvoice=Q.checkoutInvoice=St(),Q.OnsiteInvoice=Q.onsiteInvoice=Bt(),Q.DirectPay=Q.directPay=Jt();function O(r){this.config={},this.config["PAYDUNYA-MASTER-KEY"]=r&&r.masterKey||U.PAYDUNYA_MASTER_KEY,this.config["PAYDUNYA-PRIVATE-KEY"]=r&&r.privateKey||U.PAYDUNYA_PRIVATE_KEY,this.config["PAYDUNYA-TOKEN"]=r&&r.token||U.PAYDUNYA_TOKEN,this.config["Content-Type"]="application/json",r&&r.mode&&r.mode.toLowerCase()==="test"?this.baseURL="https://app.paydunya.com/sandbox-api/v1":this.baseURL="https://app.paydunya.com/api/v1"}function E(r){if(!(r&&r.name))throw new Error("Invalid parameters.");this.name=r.name,r.tagline&&(this.tagline=r.tagline),r.phoneNumber&&(this.phone_number=r.phoneNumber),r.postalAddress&&(this.postal_address=r.postalAddress),r.logoURL&&(this.logo_url=r.logoURL),r.websiteURL&&(this.website_url=r.websiteURL),r.cancelURL&&(this.cancel_url=r.cancelURL),r.returnURL&&(this.return_url=r.returnURL),r.callbackURL&&(this.callback_url=r.callbackURL)}return Q}var Gt=Kt();const kt=Ft(Gt);var Xt=St();const Wt=Ft(Xt),Zt=({handlePay:U,totalAmount:O,onClose:E,order:r,idOrder:m})=>{console.log(r),localStorage.setItem("idOrderPayment",null),localStorage.setItem("montant",null),localStorage.setItem("tokenOrderPayment",null),localStorage.setItem("statusOrderPayment",null);const N=Rt(),{payment:n,setUserPayment:x,setOrder:d,setPaymentDetails:v,setTotalAmount:h}=B.useContext(Nt),{user:_}=Et(),[y,f]=B.useState(!1),[u,o]=B.useState(!0),[t,e]=B.useState(null),[l,s]=B.useState(null),[w,R]=B.useState(null);B.useEffect(()=>{x(_),d(r),console.log("order "+m),console.log("motant "+O),console.log("user"),console.log(_);const k=new kt.Setup({masterKey:"voFGVcul-uCsd-1sw5-wfGz-ukqScIQoOyDu",privateKey:"live_private_KvbXuQU1IJ4z68hQOU9YeEtrUjW",publicKey:"live_public_wgK4JebXd3SfGDWN64sEIffD5XR",token:"cjTGi71WL8xOTCrsJisR",mode:"live"});e(k);const S=new kt.Store({name:"CCBM SHOP",email:"shop@ccbm.sn",tagline:"Votre boutique pour vos matriels lectromnger",phoneNumber:"+221 70 922 17 75",postalAddress:"Avenue Lamine Gueye,x Rue Marchand,Dakar-Senegal",logoURL:"https://www.ccbmshop.com/logo_192.png",websiteURL:"https://www.ccbmshop.com/"});s(S)},[]);const g=k=>{if(console.log("arriv"),f(!0),k.preventDefault(),t&&l&&O>0){const S=new Wt(t,l);console.log(S),r.order_lines.forEach(D=>{S.addItem(D.product_name,D.product_uom_qty,D.price_unit,D.price_subtotal)}),console.log(S),S.totalAmount=Math.ceil(O),r.type_sale==="order"?r.payment_mode=="echelonne"?S.description=`Paiement d'avance de ${V(Math.ceil(O))} pour la commande ${r.name}`:r.payment_mode=="online"&&(S.description=`Paiement de ${V(Math.ceil(O))} pour la commande ${r.name}`):r.type_sale==="preorder"?r.amount_residual>0?S.description=`Paiement de ${V(Math.ceil(O))} pour la prcommande ${r.name} avec un montant total restant de ${r.amount_total-O}`:S.description=`Paiement de ${V(Math.ceil(O))} pour la prcommande ${r.name}`:r.type_sale==="creditorder"&&(r.amount_residual>0?S.description=`Paiement de ${V(Math.ceil(O))} pour le crdit ${r.name} avec un montant total restant de ${r.amount_total-O}`:S.description=`Paiement de ${V(Math.ceil(O))} pour le crdit ${r.name}`),S.callbackURL="https://orbitcity.odoo.com/api/facture/paydunya",r.type_sale==="order"?S.returnURL=`http://localhost:5173/commandes/${m}/dtails`:r.type_sale==="creditorder"?S.returnURL=`http://localhost:5173/credit-commandes/${m}/dtails`:r.type_sale==="preorder"&&(S.returnURL=`http://localhost:5173/pre-commandes/${m}/dtails`),S.returnURL="http://localhost:5173/payment-state",console.log("invoice",S),console.log(r),v(S),h(S.totalAmount),console.log(S),S.create().then(function(){return K(this,null,function*(){R(S),console.log(S),Dt(m,O,r.order_lines.map(i=>({name:i.product_name,price:i.price_unit,quantity:i.product_uom_qty})));let D=null;r.type_sale==="order"?r.payment_mode=="echelonne"?D=`${_.id}-${m}-${O}-${r.name}-${r.type_sale}-${new Date().getTime().toString()}`:D=`${_.id}-${m}-${O}-${r.name}-${r.type_sale}`:r.type_sale==="preorder"?!r.first_payment_state&&!r.second_payment_state&&!r.third_payment_state?D=`${_.id}-${m}-${O}-${r.name}-${r.type_sale}-1`:r.first_payment_state&&!r.second_payment_state&&!r.third_payment_state?D=`${_.id}-${m}-${O}-${r.name}-${r.type_sale}-2`:D=`${_.id}-${m}-${O}-${r.name}-${r.type_sale}-3`:r.type_sale==="creditorder"?!r.first_payment_state&&!r.second_payment_state&&!r.third_payment_state&&!r.fourth_payment_state?D=`${_.id}-${m}-${O}-${r.name}-${r.type_sale}-1`:r.first_payment_state&&!r.second_payment_state&&!r.third_payment_state&&!r.fourth_payment_state?D=`${_.id}-${m}-${O}-${r.name}-${r.type_sale}-2`:r.first_payment_state&&r.second_payment_state&&r.third_payment_state&&!r.fourth_payment_state?D=`${_.id}-${m}-${O}-${r.name}-${r.type_sale}-3`:D=`${_.id}-${m}-${O}-${r.name}-${r.type_sale}-4`:D=`${_.id}-${m}-${O}-${r.name}-${r.type_sale}`;const T={transaction_id:D,amount:O,order_id:m,order_type:r.type_sale,order_name:r.name,partner_id:_.id,payment_token:S.token,payment_state:S.status};console.log("data payment",T),console.log(T);try{const i=yield G.setPaymentDetails(T);i.order_type==="order"?(Y.success("Merci de passer au paiement sur paydunya",{position:"top-center",autoClose:2e3}),N(`/commandes/${m}/dtails`)):i.order_type==="preorder"?(console.log("precommande"),Y.success("Merci de passer au paiement sur paydunya",{position:"top-center",autoClose:2e3}),N(`/pre-commandes/${m}/dtails`)):i.order_type==="creditorder"?(console.log("commande"),Y.success("Merci de passer au paiement sur paydunya",{position:"top-center",autoClose:2e3}),N(`/credit-commandes/${m}/dtails`)):i.payment_state==="completed"&&(Y.success("Paiement effectif",{position:"top-center",autoClose:2e3}),N(`/commandes/${m}/dtails`)),localStorage.setItem("urlOrderPayment",S.url),localStorage.setItem("statusOrderPayment",S.status),localStorage.setItem("tokenOrderPayment",S.token),localStorage.setItem("idDataPayment",i.id),localStorage.setItem("idOrderPayment",m),localStorage.setItem("montant",O),localStorage.setItem("responseTextOrderPayment",S.responseText)}catch(i){console.error("erreur lors de l'enregistrement details payment"),console.error(i),Y.error("Payment non effectif "+i.message,{position:"top-center",autoClose:5e3})}})}).catch(function(D){console.log(D),Y.error("Payment non effectif "+D,{position:"top-center",autoClose:5e3})}).finally(()=>{f(!1)})}},j=k=>{k.preventDefault(),te(w.url),o(!1),r.type_sale==="order"?(N(`/commandes/${m}/dtails`),N("/profile#order")):r.type_sale==="preorder"?N("/profile#preorder"):r.type_sale==="creditorder"&&N("/profile#commandes-a-credit")};return p.jsxs(et,{size:"xl",className:"h-auto",show:u,popup:!0,onClose:E,children:[p.jsx(et.Header,{}),p.jsx(et.Body,{children:p.jsx("div",{className:"fixed inset-0 p-4 flex flex-wrap justify-center items-center w-full h-full z-[1000] before:fixed before:inset-0 before:w-full before:h-full before:bg-[rgba(0,0,0,0.5)] overflow-auto font-[sans-serif]",children:p.jsxs("div",{className:"w-full max-w-lg bg-white shadow-lg rounded-lg p-8 relative",children:[p.jsxs("div",{className:"flex items-start border-b border-gray-300 pb-4",children:[p.jsxs("div",{className:"flex-1",children:[p.jsxs("h3",{className:"text-gray-800 text-xl font-bold",children:["Paiement"," ",r.type_sale=="order"?"Commande":r.type_sale=="preorder"?"Pr Commande":"Commande  crdit"," "]}),p.jsx("p",{className:"text-gray-600 text-sm mt-1",children:"Rsum dtaill de votre commande."})]}),p.jsx("p",{children:p.jsx(At,{onClick:E,className:"cursor-pointer hover:text-red-500 hover:scale-150 duration-300"})})]}),r&&p.jsx(p.Fragment,{children:p.jsxs("div",{className:"my-8",children:[p.jsx("table",{className:"w-full",children:p.jsx("thead",{children:p.jsxs("tr",{children:[p.jsx("th",{className:"text-left text-gray-800 text-sm py-2",children:"Nom de la commande :"}),p.jsx("th",{className:"text-right text-gray-800 text-sm py-2",children:r.name})]})})}),p.jsxs("table",{className:"w-full",children:[p.jsx("thead",{children:p.jsxs("tr",{children:[p.jsx("th",{className:"text-left text-gray-800 text-sm py-2",children:"Nom produit"}),p.jsx("th",{className:"text-right text-gray-800 text-sm py-2",children:"Prix total"})]})}),p.jsx("tbody",{children:r&&r.order_lines.map((k,S)=>p.jsxs("tr",{children:[p.jsxs("td",{className:"text-left text-gray-800 text-sm py-2",children:[k.product_name," (",k.product_uom_qty,")  "]}),p.jsx("td",{className:"text-right text-gray-800 text-sm py-2 font-medium",children:V(k.price_total)})]},S))})]}),p.jsx("table",{className:"w-full",children:p.jsxs("thead",{children:[p.jsxs("tr",{children:[p.jsx("th",{className:"text-left text-gray-800 text-sm py-2",children:"Total Commande (en FCFA) :"}),p.jsx("th",{className:"text-right text-gray-800 text-sm py-2",children:V(Math.ceil(r.amount_total))})]}),r.payment_mode=="echelonne"&&p.jsx(p.Fragment,{children:p.jsxs("tr",{children:[p.jsx("th",{className:"text-left text-gray-800 text-sm py-2",children:"Total  payer  (en FCFA) :"}),p.jsx("th",{className:"text-right text-gray-800 text-sm py-2",children:V(Math.ceil(O))})]})})]})}),p.jsx("br",{}),p.jsxs("div",{className:"flex max-sm:flex-col items-center gap-4 mt-8",children:[t&&l&&!w&&p.jsxs(ct,{onClick:g,disabled:y,pill:!0,className:"rounded-lg px-5 py-2.5 font-medium w-full hover:bg-red-500 hover:text-white text-xl",children:[" ",y&&p.jsxs(p.Fragment,{children:[p.jsx(Ct,{className:"mr-2 h-4 w-4 animate-spin"}),p.jsx("p",{children:"Validation"})]}),!y&&"Valider"]}),t&&l&&w&&p.jsx(ct,{disabled:!w,onClick:k=>j(k),color:"success",pill:!0,className:"rounded-lg px-5 py-2.5 font-medium w-full hover:bg-red-500 hover:text-white text-xl",children:"Passer au paiement"})]})]})})]})})})]})};function te(U){const O=window.open(U,"_blank","noopener,noreferrer");O&&(O.opener=null)}function ce(){const{id:U}=Mt(),{user:O}=Et();Rt();const[E,r]=B.useState(null),[m,N]=B.useState(!1),[n,x]=B.useState(0),[d,v]=B.useState(null),[h,_]=B.useState(!1),[y,f]=B.useState(0),[u,o]=B.useState(""),[t,e]=B.useState(null),[l,s]=B.useState(!1);console.log(U),B.useEffect(()=>{let k=!0;return K(null,null,function*(){N(!0);try{const D=yield Ht.getPreCommandeById(O.id,U);if(k){r(D),console.log(D);const T=yield G.getPaymentDetailsByIdOrder(D.id);e(T)}}catch(D){console.error("Erreur lors de la rcupration des modles",D)}finally{N(!1)}}),()=>{k=!1}},[]),B.useEffect(()=>{if(E){const k=E.first_payment_state&&y<1e3||!E.first_payment_state&&y<E.first_payment_amount||m;s(k)}},[E,y,m]);const w=k=>{k&&window.open(k,"_blank","noopener,noreferrer")},R=(k,S)=>K(null,null,function*(){console.log(S);try{const D=yield G.confirmInvoice(S.payment_token);if(D.response_code==="00"&&D.status==="completed"){const T=D.receipt_url;let i=D.customer.name,P=D.customer.email,a=D.customer.phone;if(yield G.updatePaymentDetails(S.id,D.status,T,i,P,a,!0))try{(yield G.createPrecommandePaimentMontant(S.order_id,S.amount,S.payment_token))&&Y.success("Paiement valid avec succs",{position:"top-center",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0})}catch(A){console.log(A)}finally{N(!1)}}else Y.error("Vrification du paiement echoue",{position:"top-center",autoClose:5e3})}catch(D){console.error("Erreur lors de la confirmation de l'invoice :",D.message)}finally{N(!1)}}),g=(k,S)=>K(null,null,function*(){k.preventDefault(),S<1e3?Y.warning("Le Montant doit tre strictement suprieur  1000 F CFA",{position:"top-center",autoClose:5e3}):_(!0),console.log(S,E.id)}),j=()=>K(null,null,function*(){console.log(n,d)});return p.jsxs(p.Fragment,{children:[p.jsx(Ot,{title:"CCBM Shop | Dtails Prcommande",description:"Dcouvrez les meilleures offres sur CCBM Shop, votre destination privilgie pour l'lectromnager de qualit. Explorez nos produits allant des rfrigrateurs aux tlviseurs intelligents, et profitez de promotions exclusives !",keywords:"lectromnager, boutique en ligne d'lectromnager, CCBM Shop, ccbme, appareils lectromnagers  prix rduits, smart TV, rfrigrateurs modernes, climatiseurs efficaces, promotions lectromnager"}),p.jsx(Pt,{childrenClasses:"pt-0 pb-0",children:p.jsxs("div",{className:"checkout-page-wrapper w-full bg-white pb-[60px]",children:[p.jsx("div",{className:"w-full mb-5",children:p.jsx(Lt,{title:"Dtails Pr Commande",breadcrumb:[{name:"Accueil",path:"/"},{name:"Prcommandes",path:"/profile#preorder"},{name:"Dtails Prcommande "}]})}),m&&p.jsx("div",{className:"flex justify-center items-center w-full h-full",children:p.jsx(pt,{size:60,className:"animate-spin"})}),E&&p.jsx("div",{className:"checkout-main-content w-full",children:p.jsxs("div",{className:"container-x mx-auto",children:[p.jsxs("div",{className:"w-full sm:mb-10 mb-5",children:[p.jsxs("div",{className:"sm:flex sm:space-x-[18px] s",children:[p.jsx("div",{className:"sm:w-1/3 w-full mb-5 h-[70px]",children:p.jsx("div",{className:"w-full h-full bg-[#F6F6F6] text-qblack flex justify-center items-center",children:p.jsxs("span",{className:"text-[15px] font-medium",children:["NPrcommande ",p.jsx("span",{children:E.name})]})})}),p.jsx("div",{className:" sm:w-1/3  flex-1 h-[70px]",children:p.jsx("div",{className:"w-full h-full bg-[#F6F6F6] text-qblack flex justify-center items-center",children:p.jsxs("span",{className:"text-[15px] font-medium",children:["Paiement :"," ",E.advance_payment_status==="not_paid"&&p.jsx("span",{className:"text-red-500",children:"Non Pay"}),E.advance_payment_status==="paid"&&p.jsx("span",{className:"text-green-500",children:" Pay "}),E.advance_payment_status==="partial"&&p.jsxs("span",{className:"text-yellow-500",children:[" ","Partiellement Pay"]})]})})}),p.jsx("div",{className:"sm:w-1/3 flex-1 h-[70px]",children:p.jsx("div",{className:"w-full h-full bg-[#F6F6F6] text-qblack flex justify-center items-center",children:p.jsxs("span",{className:"text-[15px] font-medium",children:["Statut :"," ",E.state=="sale"&&p.jsx("span",{className:"text-green-500",children:" Valide "}),E.state=="to_delivered"&&p.jsx("span",{className:"text-yellow-500",children:" En cours de livraison "}),E.state=="delivered"&&p.jsx("span",{className:"text-green-600",children:" Livre "}),E.state!="delivered"&&E.state!="sale"&&E.state!="to_delivered"&&p.jsx("span",{className:"text-gray-500",children:" Non valid "})]})})})]}),p.jsxs("div",{className:"flex flex-col sm:flex-row sm:space-x-[18px] space-y-5 sm:space-y-0 mb-5",children:[p.jsx("div",{className:"w-full sm:w-1/2 h-auto sm:h-[70px]",children:p.jsxs("div",{className:"w-full h-full bg-[#F6F6F6] text-qblack flex flex-col sm:flex-row justify-center items-center p-3 sm:p-0",children:[p.jsx("strong",{children:" Date Prcommande "}),p.jsx("div",{className:"flex flex-col sm:flex-row items-center mt-2 sm:mt-0 sm:ml-2",children:p.jsx("span",{className:"mt-1 sm:mt-0 sm:ml-2 capitalize",children:dt(E.date_order)})})]})}),p.jsx("div",{className:"w-full sm:w-1/2 h-auto sm:h-[70px]",children:p.jsxs("div",{className:"w-full h-full bg-[#F6F6F6] text-qblack flex flex-col sm:flex-row justify-center items-center p-3 sm:p-0",children:[p.jsx("strong",{children:"Date de livraison"}),p.jsx("div",{className:"flex flex-col sm:flex-row items-center mt-2 sm:mt-0 sm:ml-2",children:p.jsx("span",{className:"mt-1 sm:mt-0 sm:ml-2 capitalize",children:dt(E.commitment_date)})})]})})]}),p.jsxs("div",{className:"sm:flex sm:space-x-[18px] s",children:[p.jsx("div",{className:"sm:w-1/2 w-full mb-5 h-[70px]",children:p.jsxs("div",{className:"w-full h-full bg-[#F6F6F6] text-qblack flex flex-col sm:flex-row justify-center items-center p-3 sm:p-0",children:[p.jsx("strong",{children:"  Total Pay  "}),p.jsx("div",{className:"flex flex-col sm:flex-row items-center mt-2 sm:mt-0 sm:ml-2",children:p.jsx("span",{className:"mt-1 sm:mt-0 sm:ml-2 capitalize",children:V(E.amount_total-E.amount_residual)})})]})}),p.jsx("div",{className:"flex-1 h-[70px]",children:p.jsxs("div",{className:"w-full h-full bg-[#F6F6F6] text-qblack flex flex-col sm:flex-row justify-center items-center p-3 sm:p-0",children:[p.jsx("strong",{children:"     Total Restant  "}),p.jsx("div",{className:"flex flex-col sm:flex-row items-center mt-2 sm:mt-0 sm:ml-2",children:p.jsx("span",{className:"mt-1 sm:mt-0 sm:ml-2 capitalize",children:V(E.amount_residual)})})]})})]}),t&&t.length>0&&p.jsx(p.Fragment,{children:p.jsxs("div",{className:"w-full max-w-4xl mx-auto px-4 sm:px-6 lg:px-8",children:[p.jsx("h1",{className:"text-2xl sm:text-3xl text-qblack font-medium mb-5 text-center",children:"Rcapitulatif Paiement"}),p.jsxs("div",{className:"w-full px-4 sm:px-10 py-6 sm:py-[30px] border border-[#EDEDED] rounded-lg",children:[p.jsxs("div",{className:"mb-6",children:[p.jsx("p",{className:"text-sm sm:text-base font-medium text-qblack uppercase mb-2",children:"Dtails Paiements"}),p.jsx("div",{className:"w-full h-[1px] bg-[#EDEDED]"})]}),p.jsx("div",{className:"overflow-x-auto",children:p.jsxs("table",{className:"min-w-full bg-white",children:[p.jsx("thead",{className:"hidden sm:table-header-group",children:p.jsxs("tr",{children:[p.jsx("th",{className:"px-4 py-3 border-b border-gray-200 bg-gray-50 text-left text-xs leading-4 font-medium text-gray-500 uppercase tracking-wider",children:"Prnom & Nom"}),p.jsx("th",{className:"px-4 py-3 border-b border-gray-200 bg-gray-50 text-left text-xs leading-4 font-medium text-gray-500 uppercase tracking-wider",children:"Tlphone"}),p.jsx("th",{className:"px-4 py-3 border-b border-gray-200 bg-gray-50 text-left text-xs leading-4 font-medium text-gray-500 uppercase tracking-wider",children:"Email"}),p.jsx("th",{className:"px-4 py-3 border-b border-gray-200 bg-gray-50 text-left text-xs leading-4 font-medium text-gray-500 uppercase tracking-wider",children:"Montant Pay"}),p.jsx("th",{className:"px-4 py-3 border-b border-gray-200 bg-gray-50 text-left text-xs leading-4 font-medium text-gray-500 uppercase tracking-wider",children:"Facture"})]})}),p.jsx("tbody",{children:t.map((k,S)=>k.payment_state==="completed"&&p.jsxs("tr",{className:"sm:bg-white flex flex-col sm:table-row mb-6 sm:mb-0",children:[p.jsx("td",{className:"px-4 py-3 sm:border-b border-gray-200",children:p.jsxs("div",{className:"flex items-center justify-between sm:table-cell",children:[p.jsx("span",{className:"sm:hidden font-medium",children:"Prnom & Nom:"}),p.jsx("span",{className:"text-sm leading-5 text-gray-900",children:k.customer_name})]})}),p.jsx("td",{className:"px-4 py-3 sm:border-b border-gray-200",children:p.jsxs("div",{className:"flex items-center justify-between sm:table-cell",children:[p.jsx("span",{className:"sm:hidden font-medium",children:"Tlphone:"}),p.jsx("span",{className:"text-sm leading-5 text-gray-900",children:k.customer_phone})]})}),p.jsx("td",{className:"px-4 py-3 sm:border-b border-gray-200",children:p.jsxs("div",{className:"flex items-center justify-between sm:table-cell",children:[p.jsx("span",{className:"sm:hidden font-medium",children:"Email:"}),p.jsx("span",{className:"text-sm leading-5 text-gray-900",children:k.customer_email})]})}),p.jsx("td",{className:"px-4 py-3 sm:border-b border-gray-200",children:p.jsxs("div",{className:"flex items-center justify-between sm:table-cell",children:[p.jsx("span",{className:"sm:hidden font-medium",children:"Montant Pay:"}),p.jsx("span",{className:"text-sm leading-5 text-gray-900",children:V(k.amount)})]})}),p.jsx("td",{className:"px-4 py-3 sm:border-b border-gray-200",children:p.jsxs("div",{className:"flex items-center justify-between sm:table-cell",children:[p.jsx("span",{className:"sm:hidden font-medium",children:"Facture:"}),k.token_status?p.jsx("button",{className:"text-sm leading-5 text-blue-600 underline",onClick:()=>w(k.url_facture),children:"Ouvrir la facture"}):p.jsx("button",{className:"text-sm leading-5 text-blue-600 underline",onClick:D=>R(D,k),children:"Vrifier le paiement"})]})})]},S))})]})})]})]})})]}),p.jsxs("div",{className:"w-full max-w-4xl mx-auto px-4 sm:px-6 lg:px-8",children:[p.jsx("h1",{className:"text-2xl sm:text-3xl text-qblack font-medium mb-5 text-center",children:"Rcapitulatif de la commande"}),p.jsxs("div",{className:"w-full p-4 sm:p-6 border border-[#EDEDED] rounded-lg shadow-sm",children:[p.jsxs("div",{className:"sub-total mb-6",children:[p.jsxs("div",{className:" flex justify-between mb-5",children:[p.jsx("p",{className:"text-[13px] font-medium text-qblack uppercase",children:"Produit"}),p.jsx("p",{className:"text-[13px] font-medium text-qblack uppercase",children:"total"})]}),p.jsx("div",{className:"w-full h-[1px] bg-[#EDEDED]"})]}),p.jsx("div",{className:"product-list w-full mb-[30px]",children:p.jsx("ul",{className:"flex flex-col space-y-5",children:E.order_lines.map((k,S)=>p.jsx(p.Fragment,{children:p.jsx("li",{children:p.jsxs("div",{className:"flex justify-between items-center",children:[p.jsxs("div",{children:[p.jsxs("h4",{className:"text-[15px] text-qblack mb-2.5",children:[k.product_name,p.jsxs("sup",{className:"text-[13px] text-qgray ml-2 mt-2",children:["x ",k.product_uom_qty]})]}),p.jsx("p",{className:"text-[13px] text-qgray",children:k.description})]}),p.jsx("div",{children:p.jsx("span",{className:"text-[15px] text-qblack font-medium",children:V(k.price_total)})})]})},S)}))})}),p.jsx("div",{className:"w-full h-[1px] bg-[#EDEDED]"}),p.jsxs("div",{className:"space-y-4",children:[p.jsx("div",{className:"border-t pt-4 space-y-2",children:[{label:"Montant Total",value:V(E.amount_total)},{label:"Premier Tranche",value:V(E.first_payment_amount),date:E.first_payment_date,state:E.first_payment_state},{label:"Deuxieme Tranche",value:V(E.second_payment_amount),date:E.second_payment_date,state:E.second_payment_state},{label:"Troisieme Tranche",value:V(E.third_payment_amount),date:E.third_payment_date,state:E.third_payment_state}].map((k,S)=>p.jsxs("dl",{className:"flex flex-wrap items-center justify-between gap-2",children:[p.jsx("dt",{className:"text-sm text-gray-500",children:k.label}),k.date&&p.jsx("dd",{className:`text-xs sm:text-sm font-medium ${k.state?"text-green-500":"text-red-500"}`,children:k.date}),p.jsx("dd",{className:`text-sm sm:text-base font-medium ${k.state?"text-green-500":k.date?"text-red-500":"text-gray-900"}`,children:k.value})]},S))}),p.jsxs("dl",{className:"flex items-center justify-between gap-4 border-t border-gray-200 pt-2 dark:border-gray-700",children:[p.jsx("dt",{className:"text-lg font-bold text-gray-900 dark:text-white",children:"Total  payer"}),p.jsx("dd",{className:"text-lg font-bold text-gray-900 dark:text-white",children:V(E.amount_total)})]}),E.amount_residual>=0&&p.jsxs("dl",{className:"flex items-center justify-between gap-4 border-t border-gray-200 pt-2 dark:border-gray-700",children:[p.jsx("dt",{className:"text-lg font-bold text-gray-900 dark:text-white",children:"Total Pay"}),p.jsx("dd",{className:"text-lg font-bold text-green-500 dark:text-white",children:V(E.amount_total-E.amount_residual)})]}),E.amount_residual>=0&&p.jsxs("dl",{className:"flex items-center justify-between gap-4 border-t border-gray-200 pt-2 dark:border-gray-700",children:[p.jsx("dt",{className:"text-lg font-bold text-gray-900 dark:text-white",children:"Total Restant"}),p.jsx("dd",{className:"text-lg font-bold text-gray-900 dark:text-white",children:V(E.amount_residual)})]})]}),p.jsxs("div",{className:"w-full",children:[(E.advance_payment_status==="not_paid"||E.advance_payment_status==="partial")&&p.jsxs(p.Fragment,{children:[p.jsxs("div",{className:"input-item mb-5",children:[p.jsx("div",{className:"mb-2 inline-block",children:p.jsx(It,{htmlFor:"montant",value:"Montant  payer"})}),p.jsx(Ut,{id:"montant",placeholder:"1000",label:"Montant*",name:"montantAPayer",type:"number",value:y,max:E.amount_residual,min:E.first_payment_state?1e3:E.first_payment_amount,onChange:k=>{const S=k.target.value;S<=E.amount_residual&&f(S),!E.first_payment_state&&S<E.first_payment_amount?o(`Le montant entr doit tre suprieur ou gal  la premire tranche de ${V(E.first_payment_amount)}.`):o("")},required:!0,className:"invalid:border-red-500 invalid:text-red-600 focus:invalid:border-red-500 focus:invalid:ring-red-500"}),u&&p.jsx("p",{className:"text-red-600",children:u})]}),E&&p.jsx(p.Fragment,{children:E.state!=="sale"&&E.state!=="draft"?p.jsx("div",{className:"flex justify-center items-center mt-2",children:p.jsx("span",{className:"text-lg font-medium text-red-500 dark:text-white",children:"La prcommande est annule, vous ne pouvez pas passer  la caisse."})}):p.jsxs(ct,{type:"submit",onClick:k=>g(k,y),className:"rounded-lg px-5 py-2.5 font-medium w-full hover:bg-red-500 hover:text-white text-xl",disabled:l,children:[m&&p.jsx(Ct,{className:"mr-2 h-4 w-4 animate-spin"}),"Passer  la caisse (",V(y),")"]})}),h&&E&&p.jsx(Zt,{handlePay:j,totalAmount:y,onClose:()=>_(!1),order:E,idOrder:E.id})]}),E.advance_payment_status==="paid"&&p.jsx("div",{className:"flex justify-center items-center mt-2",children:p.jsx("span",{className:"text-lg font-medium text-green-500 dark:text-white",children:"Votre paiement est dj rgl"})})]})]})]})]})}),!E&&p.jsx(p.Fragment,{children:p.jsxs("div",{className:"flex justify-center items-center ",children:[p.jsx(pt,{className:"animate-spin"})," Prcommande non trouve"]})})]})})]})}export{ce as default};
