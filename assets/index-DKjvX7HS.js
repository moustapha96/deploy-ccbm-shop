import{C as M,j as e,f as N,N as O,u as T,k as B,l as L,o as $,A as z,s as V,m as I,B as p}from"./index-DwDdeQn7.js";import{b as l,u as R,L as H}from"./vendor-Cppah_1b.js";import{M as Q,P as G}from"./plus-B_E-7ReH.js";import{B as J}from"./BannerPub-C6CPlWRK.js";import{c as K,a as U}from"./creditCommandeService-Cx6Cqk-D.js";import"./truck-Co91W3AA.js";function W({produit:a}){const{updateCreditOrder:c}=l.useContext(M),d=m=>{m.preventDefault(),c(a,a.quantity+1)},o=m=>{console.log("produit.quantity"),console.log(a.quantity),m.preventDefault(),a.quantity>1&&c(a,a.quantity-1)};return e.jsx("div",{className:"w-[120px] h-[40px] px-[26px] flex items-center border border-qgray-border",children:e.jsxs("div",{className:"flex justify-between items-center w-full",children:[e.jsx("button",{onClick:o,type:"button",className:"text-base text-qgray",children:e.jsx(Q,{})}),e.jsx("span",{className:"text-qblack",children:a.quantity?a.quantity:0}),e.jsx("button",{onClick:d,type:"button",className:"text-base text-qgray",children:e.jsx(G,{})})]})})}function X({className:a}){const{creditOrder:c,clearCreditOrder:d,removeFromCreditOrder:o}=l.useContext(M);console.log(c);const m=(s,x)=>{s.preventDefault(),o(x)};return e.jsxs("div",{className:`w-full ${a||""}`,children:[e.jsx("div",{className:"relative w-full overflow-x-auto border border-[#EDEDED]",children:e.jsx("table",{className:"w-full text-sm text-left text-gray-500 dark:text-gray-400",children:e.jsxs("tbody",{children:[e.jsxs("tr",{className:"text-[13px] font-medium text-black bg-[#F6F6F6] whitespace-nowrap px-2 border-b default-border-bottom uppercase",children:[e.jsx("td",{className:"py-4 pl-10 block whitespace-nowrap min-w-[300px]",children:"product"}),e.jsx("td",{className:"py-4 whitespace-nowrap text-center",children:"Prix"}),e.jsx("td",{className:"py-4 whitespace-nowrap  text-center",children:"Quantité"}),e.jsx("td",{className:"py-4 whitespace-nowrap  text-center",children:"total"}),e.jsx("td",{className:"py-4 whitespace-nowrap text-right w-[114px]"})]}),c&&c.map((s,x)=>e.jsxs("tr",{className:"bg-white border-b hover:bg-gray-50",children:[e.jsx("td",{className:"pl-10  py-4  w-[380px]",children:e.jsxs("div",{className:"flex space-x-6 items-center",children:[e.jsx("div",{className:"w-[80px] h-[80px] overflow-hidden flex justify-center items-center border border-[#EDEDED]",children:e.jsx("img",{src:`${s.image_256?"data:image/png;base64,"+s.image_256:"https://readymadeui.com/images/coffee1.webp"}`,alt:"product",className:"w-full h-full object-contain"})}),e.jsx("div",{className:"flex-1 flex flex-col",children:e.jsx("p",{className:"font-medium text-[15px] text-qblack",children:s.name})})]})}),e.jsx("td",{className:"text-center py-4 px-2",children:e.jsx("div",{className:"flex space-x-1 items-center justify-center",children:e.jsxs("span",{className:"text-[15px] font-normal",children:[" ",N(s.creditorder_price)]})})}),e.jsx("td",{className:" py-4",children:e.jsx("div",{className:"flex justify-center items-center",children:e.jsx(W,{produit:s})})}),e.jsx("td",{className:"text-right py-4",children:e.jsx("div",{className:"flex space-x-1 items-center justify-center",children:e.jsxs("span",{className:"text-[15px] font-normal",children:[" ",N(s.creditorder_price*s.quantity)]})})}),e.jsx("td",{className:"text-right py-4",children:e.jsx("div",{className:"flex space-x-1 items-center justify-center",children:e.jsx("button",{onClick:i=>m(i,s),className:"duration-200 hover:scale-150",children:e.jsx(O,{className:"hover:text-red-500"})})})})]},x))]})})}),e.jsx("div",{className:" mt-3 transition-all duration-300 ease-in-out bg-gray-200 text-[15px]  rounded-lg font-medium text-black  text-center py-2",children:"Livraison gratuite sur Dakar"})]})}function ne({cartt:a=!0}){const c=R(),{creditOrder:d,getCreditOrderTotal:o,clearCreditOrder:m}=l.useContext(M),{user:s,parent:x}=T(),[i,q]=l.useState(50),[j,D]=l.useState(4),E=[30,40,50,60,70,80,90,100],[y,k]=l.useState(!1),[Y,A]=l.useState({});l.useEffect(()=>{i===100&&D(1)},[i]),l.useEffect(()=>{(async()=>{try{if(s!=null&&s.id){const n=await K(s.id);A(n||{})}}catch(n){console.warn("checkExistingCreditCommande error:",n)}})()},[s==null?void 0:s.id]);const _=l.useMemo(()=>{const t=o()||0,n=Math.min(100,Math.max(30,i||30)),r=Math.min(5,Math.max(1,j||1));if(!t)return[];if(n===100||r===1)return[{label:"Paiement unique",amount:t,dueAt:new Date}];const b=t*n/100,g=Math.max(0,t-b),u=r-1,h=g/u,F=Math.round(h*100)/100,v=[];v.push({label:`Acompte (${n}%)`,amount:Math.round(b*100)/100,dueAt:new Date});let w=0;for(let f=1;f<=u;f++){const C=new Date;C.setMonth(C.getMonth()+f);const P=f<u?F:Math.round((g-w)*100)/100;w=Math.round((w+P)*100)/100,v.push({label:`Mensualité ${f}/${u}`,amount:P,dueAt:C})}return v},[o,i,j]),S=async()=>{var t,n;k(!0);try{if(!s){p.dismiss(),p.warning("Merci de vous connecter",{position:"top-center",autoClose:5e3}),c("/login");return}if(!(d!=null&&d.length)){p.dismiss(),p.error("Veuillez ajouter au moins un article dans votre panier",{position:"top-center",autoClose:5e3});return}const r=Math.min(100,Math.max(30,i)),b=r===100?1:Math.min(5,Math.max(1,j)),g={partner_id:s.id,parent_id:x==null?void 0:x.id,type_sale:"creditorder",payment_mode:"online",state:"draft",commitment_date:new Date,acomptePercentage:r,nombreMois:b,order_lines:d.map(h=>({id:h.id,quantity:h.quantity,list_price:h.creditorder_price}))},u=await U(g);p.success("Votre commande a été créée avec succès",{position:"top-center",autoClose:5e3}),setTimeout(()=>{c(`/credit-commandes/${u.id}/détails`,{state:{commande:u}})},1200),m()}catch(r){console.log(((t=r==null?void 0:r.response)==null?void 0:t.data)||r),p.error(((n=r==null?void 0:r.response)==null?void 0:n.data)||"Commande crédit non validée",{position:"top-center",autoClose:5e3})}finally{k(!1)}};return e.jsxs(e.Fragment,{children:[e.jsx(B,{title:"CCBM Shop | Panier crédit",description:"Découvrez les meilleures offres sur CCBM Shop, votre destination privilégiée pour l'électroménager de qualité. Explorez nos produits allant des réfrigérateurs aux téléviseurs intelligents, et profitez de promotions exclusives !",keywords:"électroménager, boutique en ligne d'électroménager, CCBM Shop, ccbme, appareils électroménagers à prix réduits, smart TV, réfrigérateurs modernes, climatiseurs efficaces, promotions électroménager"}),e.jsxs(L,{childrenClasses:a?"pt-0 pb-0":"",children:[a===!1?e.jsx("div",{className:"cart-page-wrapper w-full",children:e.jsx("div",{className:"container-x mx-auto",children:e.jsx($,{paths:[{name:"Accueil",path:"/"},{name:"Panier crédit",path:"/credit-cart"}]})})}):e.jsxs("div",{className:"cart-page-wrapper w-full bg-white pb-[60px]",children:[e.jsx("div",{className:"w-full",children:e.jsx(z,{title:"Panier crédit",breadcrumb:[{name:"Accueil",path:"/"},{name:"Panier crédit",path:"/credit-cart"}]})}),e.jsx("div",{className:"w-full mt-[23px]",children:e.jsxs("div",{className:"container-x mx-auto",children:[e.jsx(X,{className:"mb-[30px]"}),e.jsx("div",{className:"w-full sm:flex justify-between",children:e.jsx("div",{className:"flex space-x-2.5 items-center",children:e.jsx(H,{to:"/boutique",children:e.jsx("div",{className:"w-[220px] h-[50px] bg-[#F6F6F6] flex justify-center items-center",children:e.jsx("span",{className:"text-sm font-semibold",children:"Continuer vos achats"})})})})}),e.jsx("div",{className:"w-full mt-[30px] flex sm:justify-end",children:e.jsx("div",{className:"sm:w-[420px] w-full border border-[#EDEDED] px-[20px] sm:px-[30px] py-[20px] sm:py-[26px] rounded-md",children:o()!==0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-1",children:"Acompte"}),e.jsx("select",{className:"w-full border rounded p-2",value:i,onChange:t=>q(Number(t.target.value)),children:E.map(t=>e.jsxs("option",{value:t,children:[t,"%"]},t))}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Minimum 30%. 100% = paiement en une fois."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-1",children:"Nombre de paiements (mois)"}),e.jsx("select",{className:"w-full border rounded p-2",value:j,onChange:t=>D(Number(t.target.value)),disabled:i===100,children:[1,2,3,4,5].map(t=>e.jsx("option",{value:t,children:t},t))}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Maximum 5 mensualités."})]})]}),e.jsx("div",{className:"border-t pt-4 space-y-2",children:_.map((t,n)=>e.jsxs("dl",{className:"flex flex-wrap items-center justify-between gap-2",children:[e.jsxs("dt",{className:"text-sm text-gray-500",children:[t.label,t.dueAt&&e.jsxs("span",{className:"ml-2 text-xs text-gray-400",children:["(échéance: ",new Date(t.dueAt).toLocaleDateString(),")"]})]}),e.jsx("dd",{className:"text-sm sm:text-base font-medium text-gray-900",children:N(t.amount)})]},`${t.label}-${n}`))}),e.jsxs("div",{className:"mt-4 flex justify-between",children:[e.jsx("span",{className:"text-[15px] text-gray-600",children:"Total commande"}),e.jsx("span",{className:"text-[16px] font-semibold",children:N(o())})]}),e.jsx("br",{}),e.jsxs(V,{type:"submit",className:"hover:bg-red-500 w-full bg-bleu-logo",onClick:S,disabled:y,children:[y&&e.jsx(I,{className:"mr-2 h-4 w-4 animate-spin"}),y?"Veuillez patientez...":"Valider le panier"]})]})})})]})})]}),e.jsx(J,{})]})]})}export{ne as default};
