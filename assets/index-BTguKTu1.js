var f=(s,l,a)=>new Promise((d,t)=>{var r=c=>{try{p(a.next(c))}catch(h){t(h)}},u=c=>{try{p(a.throw(c))}catch(h){t(h)}},p=c=>c.done?d(c.value):Promise.resolve(c.value).then(r,u);p((a=a.apply(s,l)).next())});import{C as y,j as e,f as g,Q as q,u as D,l as E,m as k,p as _,A as S,t as F,n as L,O as B,B as j}from"./index-BJ2Ssq_J.js";import{b as i,u as M,L as T}from"./vendor-KAqkdx26.js";import{P as N}from"./precommandeService-UY997qkc.js";import{B as A}from"./BannerPub-BERPWAXm.js";import"./UserContext-DT4YZ-cJ.js";import"./truck-CJVWri5p.js";function V({produit:s}){const{updatePreorder:l}=i.useContext(y),a=t=>{t.preventDefault(),l(s,s.quantity+1)},d=t=>{t.preventDefault(),s.quantity>1&&l(s,s.quantity-1)};return e.jsx("div",{className:"w-[120px] h-[40px] px-[26px] flex items-center border border-qgray-border",children:e.jsxs("div",{className:"flex justify-between items-center w-full",children:[e.jsx("button",{onClick:d,type:"button",className:"text-base text-qgray",children:"-"}),e.jsx("span",{className:"text-qblack",children:s.quantity?s.quantity:0}),e.jsx("button",{onClick:a,type:"button",className:"text-base text-qgray",children:"+"})]})})}function z({className:s}){const{preorder:l,removeFromPreorder:a}=i.useContext(y);console.log(l);const d=(t,r)=>{t.preventDefault(),a(r)};return e.jsxs("div",{className:`w-full ${s||""}`,children:[e.jsx("div",{className:"relative w-full overflow-x-auto border border-[#EDEDED]",children:e.jsx("table",{className:"w-full text-sm text-left text-gray-500 dark:text-gray-400",children:e.jsxs("tbody",{children:[e.jsxs("tr",{className:"text-[13px] font-medium text-black bg-[#F6F6F6] whitespace-nowrap px-2 border-b default-border-bottom uppercase",children:[e.jsx("td",{className:"py-4 pl-10 block whitespace-nowrap min-w-[300px]",children:"product"}),e.jsx("td",{className:"py-4 whitespace-nowrap text-center",children:"price"}),e.jsx("td",{className:"py-4 whitespace-nowrap  text-center",children:"quantity"}),e.jsx("td",{className:"py-4 whitespace-nowrap  text-center",children:"total"}),e.jsx("td",{className:"py-4 whitespace-nowrap text-right w-[114px]"})]}),l.map((t,r)=>e.jsxs("tr",{className:"bg-white border-b hover:bg-gray-50",children:[e.jsx("td",{className:"pl-10  py-4  w-[380px]",children:e.jsxs("div",{className:"flex space-x-6 items-center",children:[e.jsx("div",{className:"w-[80px] h-[80px] overflow-hidden flex justify-center items-center border border-[#EDEDED]",children:e.jsx("img",{src:`${t.image_256?"data:image/png;base64,"+t.image_256:"https://readymadeui.com/images/coffee1.webp"}`,alt:"product",className:"w-full h-full object-contain"})}),e.jsx("div",{className:"flex-1 flex flex-col",children:e.jsx("p",{className:"font-medium text-[15px] text-qblack",children:t.name})})]})}),e.jsx("td",{className:"text-center py-4 px-2",children:e.jsx("div",{className:"flex space-x-1 items-center justify-center",children:e.jsxs("span",{className:"text-[15px] font-normal",children:[" ",g(t.preorder_price)]})})}),e.jsx("td",{className:" py-4",children:e.jsx("div",{className:"flex justify-center items-center",children:e.jsx(V,{produit:t})})}),e.jsx("td",{className:"text-right py-4",children:e.jsx("div",{className:"flex space-x-1 items-center justify-center",children:e.jsxs("span",{className:"text-[15px] font-normal",children:[" ",g(t.preorder_price*t.quantity)]})})}),e.jsx("td",{className:"text-right py-4",children:e.jsx("div",{className:"flex space-x-1 items-center justify-center",children:e.jsx("button",{onClick:u=>d(u,t),className:"duration-200 hover:scale-150",children:e.jsx(q,{className:"hover:text-red-500"})})})})]},r))]})})}),e.jsx("div",{className:" mt-3 transition-all duration-300 ease-in-out bg-gray-200 text-[15px]  rounded-lg font-medium text-black  text-center py-2",children:"Livraison gratuite sur Dakar"})]})}function U({cart:s=!0}){const{getPreorderTotal:l,preorder:a,clearPreorder:d}=i.useContext(y),[t,r]=i.useState(!1),[u,p]=i.useState(!1),[c,h]=i.useState(null),w=M(),[I,$]=i.useState(!1),{user:b}=D(),[H,v]=i.useState(null),C=m=>f(null,null,function*(){if(m.preventDefault(),b){r(!0);const x={partner_id:b.id,type_sale:"preorder",state:"sale",commitment_date:new Date,order_lines:a.map(o=>({id:o.id,quantity:o.quantity,list_price:o.preorder_price}))};console.log(x);try{const o=yield N.createPreCommande(x);console.log(o),j.success("Commande créé avec succés",{position:"top-center",autoClose:5e3}),r(!1),w(`/pre-commandes/${o.id}/détails`),console.log(o),d()}catch(o){r(!1),j.error("Commande non validé ",{position:"top-center",autoClose:5e3}),console.error("Erreur lors de la récupération des modèles",o)}}const n={partner_id:null,type_sale:"preorder",state:"sale",commitment_date:new Date,order_lines:a.map(x=>({id:x.id,quantity:x.quantity,list_price:x.preorder_price}))};h(n),r(!0),p(!0)}),P=m=>f(null,null,function*(){console.log("Payment data: ",m),p(!1),r(!0);try{const n=yield N.createCommandeWitoutPartner(m);console.log(n),j.success("Précommande créé avec succés",{position:"top-center",autoClose:5e3}),w("/boutique"),console.log(n),d(),r(!1)}catch(n){j.error("Précommande non validé ",{position:"top-center",autoClose:5e3}),console.error("Erreur lors de la récupération des modèles",n),r(!1)}});return i.useEffect(()=>{const m=()=>f(null,null,function*(){try{const n=yield fetch("https://ipinfo.io/json?token=a7bca817c4bc37");if(!n.ok)throw new Error("Error fetching location data");const x=yield n.json();v(x)}catch(n){console.error("Error:",n)}});a.length>0&&m()},[a]),e.jsxs(e.Fragment,{children:[e.jsx(E,{title:"CCBM Shop | Panier Précommande ",description:"Découvrez les meilleures offres sur CCBM Shop, votre destination privilégiée pour l'électroménager de qualité. Explorez nos produits allant des réfrigérateurs aux téléviseurs intelligents, et profitez de promotions exclusives !",keywords:"électroménager, boutique en ligne d'électroménager, CCBM Shop, ccbme, appareils électroménagers à prix réduits, smart TV, réfrigérateurs modernes, climatiseurs efficaces, promotions électroménager"}),e.jsxs(k,{childrenClasses:s?"pt-0 pb-0":"",children:[s===!1?e.jsx("div",{className:"cart-page-wrapper w-full",children:e.jsx("div",{className:"container-x mx-auto",children:e.jsx(_,{paths:[{name:"Accueil",path:"/"},{name:"Validation panier Pré commande",path:"/pre-cart"}]})})}):e.jsxs("div",{className:"cart-page-wrapper w-full bg-white pb-[60px]",children:[e.jsx("div",{className:"w-full",children:e.jsx(S,{title:"Panier Précommande",breadcrumb:[{name:"Accueil",path:"/"},{name:"Validation panier Précommande",path:"/pre-cart"}]})}),e.jsx("div",{className:"w-full mt-[23px]",children:e.jsxs("div",{className:"container-x mx-auto",children:[e.jsx(z,{className:"mb-[30px]"}),e.jsx("div",{className:"w-full sm:flex justify-between",children:e.jsx("div",{className:"flex space-x-2.5 items-center",children:e.jsx(T,{to:"/boutique",children:e.jsx("div",{className:"w-[220px] h-[50px] bg-[#F6F6F6] flex justify-center items-center",children:e.jsx("span",{className:"text-sm font-semibold",children:"Continuer vos achats"})})})})}),e.jsx("div",{className:"w-full mt-[30px] flex sm:justify-end",children:e.jsxs("div",{className:"sm:w-[370px] w-full border border-[#EDEDED] px-[30px] py-[26px]",children:[e.jsx("div",{className:"total mb-6",children:e.jsxs("div",{className:" flex justify-between",children:[e.jsx("p",{className:"text-[18px] font-medium text-qblack",children:"Total panier"}),e.jsxs("p",{className:"text-[18px] font-medium text-qred",children:[" ",g(l())," "]})]})}),l()!=0&&e.jsxs(F,{type:"submit",className:"hover:bg-red-500  w-full bg-bleu-logo",onClick:m=>C(m),disabled:t,children:[t&&e.jsx(L,{className:"mr-2 h-4 w-4 animate-spin"}),"Valider le Panier"]})]})})]})}),u&&!b&&e.jsx(e.Fragment,{children:e.jsx(B,{handleCreatePartner:P,order:a,data:c,onClose:()=>p(!1)})})]}),e.jsx(A,{})]})]})}export{U as default};
