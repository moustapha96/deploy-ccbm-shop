import{c as k,d as v,j as e,R as A,n as M,g as P,h as S,k as T,l as E,o as q,L,p as F}from"./index-D_GqWmHf.js";import{b as l,c as I,u as R}from"./vendor-Cppah_1b.js";/**
 * @license lucide-react v0.400.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z=k("Tag",[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]]);function B({className:t,filterToggle:r,updateUrlParams:i}){var j;const{filters:c,updateFilters:o}=l.useContext(v),[s,x]=l.useState([]);l.useEffect(()=>{(async()=>{try{const n=await M.getTags();x(Array.isArray(n)?n:[])}catch(n){console.error("Erreur lors de la récupération des tags",n),x([])}})()},[]);const h=d=>{const[n,u]=d,y={...c,min:n,max:u,page:1};o(y),i(y)},p=d=>{const n=d.target.value,u={...c,tag:n,page:1};o(u),i(u)};return e.jsxs("div",{className:`filter-widget w-full fixed lg:relative left-0 top-0 h-screen z-10 lg:h-auto overflow-y-scroll lg:overflow-y-auto bg-white px-[30px] pt-[40px] ${t||""} ${r?"block":"hidden lg:block"}`,children:[e.jsxs("div",{className:"filter-subject-item pb-10 border-b border-qgray-border mt-10",children:[e.jsx("div",{className:"subject-title mb-[20px]",children:e.jsx("h1",{className:"text-black text-base font-500",children:"Filtrer par tags"})}),e.jsx("div",{className:"text-sm text-qgray",children:e.jsxs("select",{className:"w-full border border-qgray-border px-3 py-2 rounded",value:(j=c.tag)!=null?j:"All",onChange:p,children:[e.jsx("option",{value:"All",children:"Tous les tags"}),s.map(d=>e.jsx("option",{value:d.slug||d.name,children:d.name},d.id))]})})]}),e.jsxs("div",{className:"filter-subject-item pb-10 border-b border-qgray-border mt-10",children:[e.jsx("div",{className:"subject-title mb-[30px]",children:e.jsx("h1",{className:"text-black text-base font-500",children:"Échelle des prix"})}),e.jsx("div",{className:"price-range mb-5",children:e.jsx(A,{value:[c.min,c.max],onInput:h,min:1e3,max:5e6})}),e.jsxs("p",{className:"text-xs text-qblack font-400",children:["Prix (FCFA): ",c.min," - ",c.max]})]})]})}const O=({currentPage:t,totalPages:r,onPageChange:i})=>{const c=()=>{const s=[];for(let x=Math.max(2,t-2);x<=Math.min(r-1,t+2);x++)s.push(x);return t-2>2&&s.unshift("..."),t+2<r-1&&s.push("..."),s.unshift(1),r!==1&&s.push(r),s};return e.jsx("nav",{className:"flex justify-center items-center mt-8 px-4","aria-label":"Pagination",children:e.jsxs("ul",{className:"flex flex-wrap justify-center items-center space-x-1 md:space-x-2",children:[e.jsx("li",{children:e.jsx("button",{onClick:()=>i(Math.max(1,t-1)),disabled:t===1,className:"p-2 rounded-full bg-gray-200 text-gray-700 hover:bg-qyellow disabled:opacity-50 disabled:cursor-not-allowed","aria-label":"Previous page",children:e.jsx(P,{className:"w-5 h-5"})})}),c().map((o,s)=>e.jsx("li",{children:typeof o=="number"?e.jsx("button",{onClick:()=>i(o),className:`hidden sm:block px-3 py-2 rounded ${t===o?"bg-bleu-logo text-white":"bg-gray-200 text-gray-700 hover:bg-qyellow"}`,"aria-current":t===o?"page":void 0,children:o}):e.jsx("span",{className:"hidden sm:block px-3 py-2",children:o})},s)),e.jsx("li",{className:"sm:hidden",children:e.jsxs("span",{className:"px-3 py-2 text-gray-700",children:[t," / ",r]})}),e.jsx("li",{children:e.jsx("button",{onClick:()=>i(Math.min(r,t+1)),disabled:t===r,className:"p-2 rounded-full bg-gray-200 text-gray-700 hover:bg-qyellow disabled:opacity-50 disabled:cursor-not-allowed","aria-label":"Next page",children:e.jsx(S,{className:"w-5 h-5"})})})]})})};function V(){const{currentProductsPromo:t,totalProductsPromo:r,isLoadingProductPromo:i,fetchProdcutsPromo:c,updateFilters:o,filters:s,resetFilters:x,errorPromoList:h}=l.useContext(v),p=I(),j=R(),[d,n]=l.useState(""),u=l.useCallback(()=>{window.scrollTo({top:0,left:0,behavior:"smooth"})},[]),y=l.useCallback(()=>{const a=new URLSearchParams(p.search),m=Math.max(1,Number(a.get("page"))||1),b=Math.max(1e3,Number(a.get("min"))||1e3),f=Math.min(5e6,Math.max(b,Number(a.get("max"))||5e6));return{page:m,category:a.get("category")||"All",search:a.get("search")||"",min:b,max:f,limit:Number(a.get("limit"))||9,productType:a.get("productType")||"All",tag:a.get("tag")||"All"}},[p.search]);l.useEffect(()=>{const a=y();n(a.search),x(),o(a)},[p.pathname,p.search,x,o,y]),l.useEffect(()=>{c()},[c]);const N=l.useMemo(()=>{const a=r>0?(s.page-1)*s.limit+1:0,m=Math.min(s.page*s.limit,r),b=Math.ceil(r/s.limit);return{startIndex:a,endIndex:m,totalPages:b}},[s.page,s.limit,r]),g=l.useCallback(a=>{const m=new URLSearchParams(p.search);Object.entries(a).forEach(([b,f])=>{f==null||f===""||f==="All"?m.delete(b):m.set(b,String(f))}),j({search:m.toString()},{replace:!0}),u()},[p.search,j,u]),w=l.useCallback(a=>{g({...s,page:a})},[s,g]);l.useCallback(a=>{const m=a.target.value;n(m),g({...s,search:m,page:1})},[s,g]);const C=l.useCallback(a=>{g({...s,category:a||"All",page:1})},[s,g]);return e.jsxs(e.Fragment,{children:[e.jsx(T,{title:"CCBM Shop | En Promo",description:"Découvrez les meilleures offres promotionnelles sur CCBM Shop, votre destination privilégiée pour l'électroménager de qualité à prix réduits.",keywords:"électroménager, promotions, offres spéciales, CCBM Shop, ccbme, appareils électroménagers à prix réduits"}),e.jsx(E,{children:e.jsx("div",{className:"products-page-wrapper w-full",children:e.jsxs("div",{className:"container-x mx-auto px-4",children:[e.jsx(q,{}),e.jsxs("div",{className:"w-full lg:flex lg:space-x-[30px] mt-6",children:[e.jsx("aside",{className:"lg:w-[270px] mb-6 lg:mb-0",children:e.jsx(B,{updateUrlParams:g,handleCategoryChange:C})}),e.jsxs("main",{className:"flex-1",children:[e.jsx("div",{className:"products-sorting w-full bg-white flex flex-col md:flex-row justify-between items-center p-6 mb-6 rounded-lg shadow-sm",children:e.jsxs("p",{className:"font-400 text-sm text-gray-600 mb-2 md:mb-0",children:[e.jsx("span",{className:"text-gray-500",children:"Affichage"})," ",r>0?e.jsxs("span",{className:"font-medium text-gray-900",children:[N.startIndex,"–",N.endIndex," sur ",r," résultat",r>1?"s":""]}):e.jsx("span",{className:"font-medium text-gray-900",children:"0 résultat"})]})}),h&&e.jsxs("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg mb-6",role:"alert",children:[e.jsx("p",{className:"font-medium",children:"Erreur de chargement"}),e.jsx("p",{className:"text-sm mt-1",children:h})]}),i&&e.jsxs("div",{className:"flex flex-col justify-center items-center py-20",role:"status","aria-live":"polite",children:[e.jsx(L,{className:"animate-spin w-8 h-8 text-blue-500 mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Chargement des promotions..."})]}),!i&&!h&&t.length===0&&e.jsxs("div",{className:"flex flex-col justify-center items-center py-20 text-center",role:"status",children:[e.jsx(z,{className:"w-16 h-16 text-gray-300 mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-700 mb-2",children:"Aucune promotion trouvée"}),e.jsx("p",{className:"text-gray-500 max-w-md",children:s.category!=="All"||s.tag!=="All"||s.min>1e3||s.max<5e6?"Essayez de modifier vos filtres pour voir plus de promotions disponibles.":"Aucun produit en promotion disponible pour le moment. Revenez bientôt pour découvrir nos offres spéciales !"})]}),!i&&!h&&t.length>0&&e.jsx("div",{className:"grid xl:grid-cols-3 lg:grid-cols-2 grid-cols-1 sm:grid-cols-2 gap-6 mb-8",children:t.map(a=>e.jsx(F,{datas:a},a.id))}),!i&&!h&&N.totalPages>1&&e.jsx(O,{currentPage:s.page,totalPages:N.totalPages,onPageChange:w})]})]})]})})})]})}export{V as default};
