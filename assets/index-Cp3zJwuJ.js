import{P as v,u as T,j as e,R as k,n as A,g as M,h as q,k as S,l as F,o as P,L as E,p as I}from"./index-BI9smu61.js";import{b as o,c as L,u as R}from"./vendor-Cppah_1b.js";import{P as B}from"./package-0d-TPq1w.js";function z({className:r,filterToggle:l,updateUrlParams:n,type:b=3}){const{filters:s,updateFilters:i}=o.useContext(v),{user:a}=T(),x=c=>{i({...s,min:c[0],max:c[1],page:1}),n({...s,min:c[0],max:c[1],page:1})},m=c=>{const d=c.target.value;i({...s,productType:d,page:1}),n({...s,productType:d,page:1})},f=c=>{const d=c.target.value;i({...s,tag:d,page:1}),n({...s,tag:d,page:1})},[N,j]=o.useState([]);return o.useEffect(()=>{(async()=>{try{const d=await A.getTags();j(d)}catch(d){console.error("Erreur lors de la récupération des catégories",d)}})()},[]),e.jsxs("div",{className:`filter-widget w-full fixed lg:relative left-0 top-0 h-screen z-10 lg:h-auto overflow-y-scroll lg:overflow-y-auto bg-white px-[30px] pt-[40px] ${r||""} ${l?"block":"hidden lg:block"}`,children:[e.jsxs("div",{className:"filter-subject-item pb-10 border-b border-qgray-border",children:[e.jsx("div",{className:"subject-title mb-[20px]",children:e.jsx("h1",{className:"text-black text-base font-500",children:"Type de produits"})}),e.jsxs("div",{className:"flex flex-col gap-3 text-sm text-qgray",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",value:"All",name:"productType",checked:s.productType==="All",onChange:m}),"Tous les produits"]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",value:"promo",name:"productType",checked:s.productType==="promo",onChange:m}),"Produits en promo"]}),a&&a.adhesion=="accepted"&&a.parent_id&&e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",value:"credit",name:"productType",checked:s.productType==="credit",onChange:m}),"Produits à crédit"]})]})]}),e.jsxs("div",{className:"filter-subject-item pb-10 border-b border-qgray-border mt-10",children:[e.jsx("div",{className:"subject-title mb-[20px]",children:e.jsx("h1",{className:"text-black text-base font-500",children:"Filtrer par tags"})}),e.jsx("div",{className:"text-sm text-qgray",children:e.jsxs("select",{className:"w-full border border-qgray-border px-3 py-2 rounded",value:s.tag||"",onChange:f,children:[e.jsx("option",{value:"",children:"Tous les tags"}),N.map(c=>e.jsx("option",{value:c.slug||c.name,children:c.name},c.id))]})})]}),e.jsxs("div",{className:"filter-subject-item pb-10 border-b border-qgray-border mt-10",children:[e.jsx("div",{className:"subject-title mb-[30px]",children:e.jsx("h1",{className:"text-black text-base font-500",children:"Échelle des prix"})}),e.jsx("div",{className:"price-range mb-5",children:e.jsx(k,{value:[s.min,s.max],onInput:x,min:4e3,max:5e6})}),e.jsxs("p",{className:"text-xs text-qblack font-400",children:["Prix (FCFA): ",s.min," - ",s.max]})]})]})}const O=({currentPage:r,totalPages:l,onPageChange:n})=>{const b=()=>{const i=[];for(let a=Math.max(2,r-2);a<=Math.min(l-1,r+2);a++)i.push(a);return r-2>2&&i.unshift("..."),r+2<l-1&&i.push("..."),i.unshift(1),l!==1&&i.push(l),i};return e.jsx("nav",{className:"flex justify-center items-center mt-8 px-4","aria-label":"Pagination",children:e.jsxs("ul",{className:"flex flex-wrap justify-center items-center space-x-1 md:space-x-2",children:[e.jsx("li",{children:e.jsx("button",{onClick:()=>n(Math.max(1,r-1)),disabled:r===1,className:"p-2 rounded-full bg-gray-200 text-gray-700 hover:bg-qyellow disabled:opacity-50 disabled:cursor-not-allowed","aria-label":"Previous page",children:e.jsx(M,{className:"w-5 h-5"})})}),b().map((s,i)=>e.jsx("li",{children:typeof s=="number"?e.jsx("button",{onClick:()=>n(s),className:`hidden sm:block px-3 py-2 rounded ${r===s?"bg-bleu-logo text-white":"bg-gray-200 text-gray-700 hover:bg-qyellow"}`,"aria-current":r===s?"page":void 0,children:s}):e.jsx("span",{className:"hidden sm:block px-3 py-2",children:s})},i)),e.jsx("li",{className:"sm:hidden",children:e.jsxs("span",{className:"px-3 py-2 text-gray-700",children:[r," / ",l]})}),e.jsx("li",{children:e.jsx("button",{onClick:()=>n(Math.min(l,r+1)),disabled:r===l,className:"p-2 rounded-full bg-gray-200 text-gray-700 hover:bg-qyellow disabled:opacity-50 disabled:cursor-not-allowed","aria-label":"Next page",children:e.jsx(q,{className:"w-5 h-5"})})})]})})};function D(){const{currentProducts:r,totalProducts:l,isLoadingProduct:n,fetchProducts:b,updateFilters:s,resetFilters:i,filters:a,errorProduct:x}=o.useContext(v),m=L(),f=R(),[N,j]=o.useState(""),c=o.useCallback(()=>{window.scrollTo({top:0,left:0,behavior:"smooth"})},[]),d=o.useCallback(()=>{const t=new URLSearchParams(m.search),p=Math.max(1,Number.parseInt(t.get("page"))||1),u=Math.max(1e3,Number.parseInt(t.get("min"))||1e3),g=Math.min(5e6,Math.max(u,Number.parseInt(t.get("max"))||5e6));return{page:p,category:t.get("category")||"All",search:t.get("search")||"",min:u,max:g,limit:9,productType:t.get("productType")||"All",tag:t.get("tag")||"All"}},[m.search]);o.useEffect(()=>{const t=d();j(t.search),i(),s(t)},[m.pathname,m.search,i,s,d]),o.useEffect(()=>{b()},[b]);const y=o.useMemo(()=>{const t=l>0?(a.page-1)*a.limit+1:0,p=Math.min(a.page*a.limit,l),u=Math.ceil(l/a.limit);return{startIndex:t,endIndex:p,totalPages:u}},[a.page,a.limit,l]),h=o.useCallback(t=>{const p=new URLSearchParams(m.search);Object.entries(t).forEach(([u,g])=>{g!=null&&g!==""&&g!=="All"?p.set(u,g.toString()):p.delete(u)}),f({search:p.toString()},{replace:!0}),c()},[m.search,f,c]),w=o.useCallback(t=>{h({...a,page:t})},[a,h]);o.useCallback(t=>{const p=t.target.value;j(p),h({...a,search:p,page:1})},[a,h]);const C=o.useCallback(t=>{h({...a,category:t||"All",page:1})},[a,h]);return e.jsxs(e.Fragment,{children:[e.jsx(S,{title:"CCBM Shop | Boutique",description:"Découvrez les meilleures offres sur CCBM Shop, votre destination privilégiée pour l'électroménager de qualité.",keywords:"électroménager, boutique en ligne d'électroménager, CCBM Shop, ccbme, appareils électroménagers à prix réduits"}),e.jsx(F,{children:e.jsx("div",{className:"products-page-wrapper w-full",children:e.jsxs("div",{className:"container-x mx-auto px-4",children:[e.jsx(P,{}),e.jsxs("div",{className:"w-full lg:flex lg:space-x-[30px] mt-6",children:[e.jsx("aside",{className:"lg:w-[270px] mb-6 lg:mb-0",children:e.jsx(z,{handleCategoryChange:C,updateUrlParams:h})}),e.jsxs("main",{className:"flex-1",children:[e.jsx("div",{className:"products-sorting w-full bg-white flex flex-col md:flex-row justify-between items-center p-6 mb-6 rounded-lg shadow-sm",children:e.jsxs("p",{className:"font-400 text-sm text-gray-600 mb-2 md:mb-0",children:[e.jsx("span",{className:"text-gray-500",children:"Affichage"})," ",l>0?e.jsxs("span",{className:"font-medium text-gray-900",children:[y.startIndex,"–",y.endIndex," sur ",l," résultat",l>1?"s":""]}):e.jsx("span",{className:"font-medium text-gray-900",children:"0 résultat"})]})}),x&&e.jsxs("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg mb-6",role:"alert",children:[e.jsx("p",{className:"font-medium",children:"Erreur de chargement"}),e.jsx("p",{className:"text-sm mt-1",children:x})]}),n&&e.jsxs("div",{className:"flex flex-col justify-center items-center py-20",role:"status","aria-live":"polite",children:[e.jsx(E,{className:"animate-spin w-8 h-8 text-blue-500 mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Chargement des produits..."})]}),!n&&!x&&r.length===0&&e.jsxs("div",{className:"flex flex-col justify-center items-center py-20 text-center",role:"status",children:[e.jsx(B,{className:"w-16 h-16 text-gray-300 mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-700 mb-2",children:"Aucun produit trouvé"}),e.jsx("p",{className:"text-gray-500 max-w-md",children:a.search||a.category!=="All"||a.productType!=="All"?"Essayez de modifier vos filtres de recherche pour voir plus de résultats.":"Aucun produit disponible pour le moment. Revenez plus tard !"})]}),!n&&!x&&r.length>0&&e.jsx("div",{className:"grid xl:grid-cols-3 lg:grid-cols-2 grid-cols-1 sm:grid-cols-2 gap-6 mb-8",children:r.map(t=>e.jsx(I,{datas:t},t.id))}),!n&&!x&&y.totalPages>1&&e.jsx(O,{currentPage:a.page,totalPages:y.totalPages,onPageChange:w})]})]})]})})})]})}export{D as default};
