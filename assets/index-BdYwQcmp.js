var k=Object.defineProperty,q=Object.defineProperties;var S=Object.getOwnPropertyDescriptors;var v=Object.getOwnPropertySymbols;var T=Object.prototype.hasOwnProperty,P=Object.prototype.propertyIsEnumerable;var w=(t,s,a)=>s in t?k(t,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[s]=a,b=(t,s)=>{for(var a in s||(s={}))T.call(s,a)&&w(t,a,s[a]);if(v)for(var a of v(s))P.call(s,a)&&w(t,a,s[a]);return t},j=(t,s)=>q(t,S(s));var C=(t,s,a)=>new Promise((o,i)=>{var l=c=>{try{n(a.next(c))}catch(m){i(m)}},x=c=>{try{n(a.throw(c))}catch(m){i(m)}},n=c=>c.done?o(c.value):Promise.resolve(c.value).then(l,x);n((a=a.apply(t,s)).next())});import{e as A,j as e,R as E,o as F,h as M,i as L,l as R,m as $,p as B,L as I,q as O}from"./index-BJ2Ssq_J.js";import{b as p,c as z,u as U}from"./vendor-KAqkdx26.js";function D({className:t,filterToggle:s,updateUrlParams:a}){var m;const{filters:o,updateFilters:i}=p.useContext(A),[l,x]=p.useState([]);p.useEffect(()=>{C(null,null,function*(){try{const h=yield F.getTags();x(Array.isArray(h)?h:[])}catch(h){console.error("Erreur lors de la récupération des tags",h),x([])}})},[]);const n=d=>{const[h,u]=d,N=j(b({},o),{min:h,max:u,page:1});i(N),a(N)},c=d=>{const h=d.target.value,u=j(b({},o),{tag:h,page:1});i(u),a(u)};return e.jsxs("div",{className:`filter-widget w-full fixed lg:relative left-0 top-0 h-screen z-10 lg:h-auto overflow-y-scroll lg:overflow-y-auto bg-white px-[30px] pt-[40px] ${t||""} ${s?"block":"hidden lg:block"}`,children:[e.jsxs("div",{className:"filter-subject-item pb-10 border-b border-qgray-border mt-10",children:[e.jsx("div",{className:"subject-title mb-[20px]",children:e.jsx("h1",{className:"text-black text-base font-500",children:"Filtrer par tags"})}),e.jsx("div",{className:"text-sm text-qgray",children:e.jsxs("select",{className:"w-full border border-qgray-border px-3 py-2 rounded",value:(m=o.tag)!=null?m:"All",onChange:c,children:[e.jsx("option",{value:"All",children:"Tous les tags"}),l.map(d=>e.jsx("option",{value:d.slug||d.name,children:d.name},d.id))]})})]}),e.jsxs("div",{className:"filter-subject-item pb-10 border-b border-qgray-border mt-10",children:[e.jsx("div",{className:"subject-title mb-[30px]",children:e.jsx("h1",{className:"text-black text-base font-500",children:"Échelle des prix"})}),e.jsx("div",{className:"price-range mb-5",children:e.jsx(E,{value:[o.min,o.max],onInput:n,min:1e3,max:5e6})}),e.jsxs("p",{className:"text-xs text-qblack font-400",children:["Prix (FCFA): ",o.min," - ",o.max]})]})]})}const H=({currentPage:t,totalPages:s,onPageChange:a})=>{const o=()=>{const l=[];for(let x=Math.max(2,t-2);x<=Math.min(s-1,t+2);x++)l.push(x);return t-2>2&&l.unshift("..."),t+2<s-1&&l.push("..."),l.unshift(1),s!==1&&l.push(s),l};return e.jsx("nav",{className:"flex justify-center items-center mt-8 px-4","aria-label":"Pagination",children:e.jsxs("ul",{className:"flex flex-wrap justify-center items-center space-x-1 md:space-x-2",children:[e.jsx("li",{children:e.jsx("button",{onClick:()=>a(Math.max(1,t-1)),disabled:t===1,className:"p-2 rounded-full bg-gray-200 text-gray-700 hover:bg-qyellow disabled:opacity-50 disabled:cursor-not-allowed","aria-label":"Previous page",children:e.jsx(M,{className:"w-5 h-5"})})}),o().map((i,l)=>e.jsx("li",{children:typeof i=="number"?e.jsx("button",{onClick:()=>a(i),className:`hidden sm:block px-3 py-2 rounded ${t===i?"bg-bleu-logo text-white":"bg-gray-200 text-gray-700 hover:bg-qyellow"}`,"aria-current":t===i?"page":void 0,children:i}):e.jsx("span",{className:"hidden sm:block px-3 py-2",children:i})},l)),e.jsx("li",{className:"sm:hidden",children:e.jsxs("span",{className:"px-3 py-2 text-gray-700",children:[t," / ",s]})}),e.jsx("li",{children:e.jsx("button",{onClick:()=>a(Math.min(s,t+1)),disabled:t===s,className:"p-2 rounded-full bg-gray-200 text-gray-700 hover:bg-qyellow disabled:opacity-50 disabled:cursor-not-allowed","aria-label":"Next page",children:e.jsx(L,{className:"w-5 h-5"})})})]})})};function V(){const{currentProductsPromo:t,totalProductsPromo:s,isLoadingProductPromo:a,fetchProdcutsPromo:o,updateFilters:i,filters:l,resetFilters:x}=p.useContext(A),n=z(),c=U();p.useEffect(()=>{x();const r=new URLSearchParams(n.search),g={page:Number(r.get("page"))||1,category:r.get("category")||"All",search:r.get("search")||"",min:Number(r.get("min"))||1e3,max:Number(r.get("max"))||5e6,limit:Number(r.get("limit"))||9,productType:r.get("productType")||"All",tag:r.get("tag")||"All"};i(g),window.scrollTo({top:0,left:0,behavior:"smooth"})},[n.search,n.pathname]),p.useEffect(()=>{o()},[o,l]);const m=p.useCallback(r=>{const g=new URLSearchParams(n.search);Object.entries(r).forEach(([y,f])=>{f==null||f===""||f==="All"?g.delete(y):g.set(y,String(f))}),c({search:g.toString()},{replace:!0})},[n.search,c]),d=r=>{m(j(b({},l),{page:r})),window.scrollTo({top:0,left:0,behavior:"smooth"})},h=r=>{m(j(b({},l),{category:r||"All",page:1})),window.scrollTo({top:0,left:0,behavior:"smooth"})},u=s>0?(l.page-1)*l.limit+1:0,N=Math.min(l.page*l.limit,s);return e.jsxs(e.Fragment,{children:[e.jsx(R,{title:"CCBM Shop | En Promo",description:"Découvrez les meilleures offres promotionnelles sur CCBM Shop, votre destination privilégiée pour l'électroménager de qualité à prix réduits.",keywords:"électroménager, promotions, offres spéciales, CCBM Shop, ccbme, appareils électroménagers à prix réduits"}),e.jsx($,{children:e.jsx("div",{className:"products-page-wrapper w-full",children:e.jsxs("div",{className:"container-x mx-auto",children:[e.jsx(B,{}),e.jsxs("div",{className:"w-full lg:flex lg:space-x-[30px]",children:[e.jsx("div",{className:"lg:w-[270px]",children:e.jsx(D,{updateUrlParams:m,handleCategoryChange:h})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"products-sorting w-full bg-white flex flex-col md:flex-row justify-between p-[30px] mb-[40px]",children:e.jsxs("p",{className:"font-400 text-[13px]",children:[e.jsx("span",{className:"text-qgray",children:"Affichage"})," ",s>0?`${u}–${N} sur ${s} résultats`:"0 résultat"]})}),a?e.jsxs("div",{className:"flex justify-center items-center",children:[e.jsx(I,{className:"animate-spin"})," Chargement"]}):t.length===0?e.jsx("div",{className:"flex justify-center items-center",children:"Aucun produit en promotion trouvé"}):e.jsx("div",{className:"grid xl:grid-cols-3 grid-cols-2 gap-[30px]",children:t.map(r=>e.jsx(O,{datas:r},r.id))}),e.jsx(H,{currentPage:l.page,totalPages:Math.ceil(s/l.limit),onPageChange:d})]})]})]})})})]})}export{V as default};
