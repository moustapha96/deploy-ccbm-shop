import{u as k,G as E,f as n,j as t,L as D,k as $,l as B,A as z,B as L,D as I,T as O,s as P,m as q}from"./index-DwDdeQn7.js";import{m as R,b as i}from"./vendor-Cppah_1b.js";import{f as V}from"./date-format-qL-o8H-f.js";import{W}from"./wave-orange-payment-service-Bx7KoASn.js";function U(){const{id:s}=R(),{user:m}=k(),[e,N]=i.useState(null),[C,j]=i.useState(!1),[g,p]=i.useState(!1),[v,a]=i.useState(""),[c,b]=i.useState(0),[A,d]=i.useState(!0),M=i.useCallback(async()=>{try{const r=await E.getCommandeById(m.id,s);N(r)}catch(r){console.error("Erreur lors de la récupération des données de la commande",r)}},[m.id,s]);i.useEffect(()=>{M()},[M]);const f=i.useMemo(()=>String((e==null?void 0:e.type_sale)||"").toLowerCase()==="order",[e==null?void 0:e.type_sale]),w=i.useMemo(()=>Array.isArray(e==null?void 0:e.payment_lines)?e.payment_lines:null,[e]),y=i.useMemo(()=>w&&(w.find(r=>r.sequence===1)||w[0])||null,[w]),_=i.useMemo(()=>y?!y.state:!1,[y]),l=i.useMemo(()=>{const r=Number((e==null?void 0:e.amount_residual)||0);return f?r>0?50:0:(e==null?void 0:e.payment_mode)==="echelonne"?_&&y?Math.max(0,Number(y.amount)||0):r<=0?0:Math.min(Math.max(1e3,0),r):1e3},[e==null?void 0:e.amount_residual,e==null?void 0:e.payment_mode,f,_,y]);i.useEffect(()=>{if(e){if(f){b(l),a("");return}e.payment_mode==="echelonne"?(b(l),a("")):e.payment_mode==="online"?(b(Number(e.amount_total||0)),a("")):(b(0),a(""))}},[e,l,f]);const F=(r,u)=>{r.preventDefault();const h=Number((e==null?void 0:e.amount_residual)||0),o=Number(u||0);if(f){if(h<=0){L.info("Aucun montant restant à payer.");return}if(o<=0){a("Le montant doit être > 0.");return}if(o>h){a("Le montant ne doit pas dépasser le montant restant à payer.");return}a(""),p(!0);return}if(e.payment_mode==="echelonne"){if(h<=0){L.info("Aucun montant restant à payer.");return}if(_){if(o!==Number(l)){a(`Le montant doit être exactement l'acompte requis (${n(l)}).`);return}}else if(o<Number(l)){a(`Le montant doit être ≥ ${n(l)}.`);return}if(o>h){a("Le montant à payer ne doit pas dépasser le montant restant à payer");return}a(""),p(!0);return}if(e.payment_mode==="online"){if(o<1e3){a("Le montant minimum est de 1000 FCFA");return}if(o!==Number(e.amount_total||0)){a("Le montant à payer doit correspondre au total de la commande");return}a(""),p(!0);return}if(e.payment_mode==="domicile"){L.info("Le paiement se fera à domicile.");return}},S=async r=>{j(!1),L.success("Paiement validé avec succès")};return i.useEffect(()=>{if(!e)return;const r=Number((e==null?void 0:e.amount_residual)||0),u=Number(c||0);if(f){if(r<=0){d(!0);return}if(u<=0){a("Le montant doit être > 0."),d(!0);return}if(u>r){a("Le montant ne doit pas dépasser le montant restant à payer."),d(!0);return}a(""),d(!1);return}if(e.payment_mode==="echelonne"){if(r<=0){d(!0);return}if(_){const h=u===Number(l);d(!h),a(h?"":`Le montant doit être exactement l'acompte requis (${n(l)}).`);return}else{if(u<Number(l)){a(`Le montant doit être ≥ ${n(l)}.`),d(!0);return}if(u>r){a("Le montant à payer ne doit pas dépasser le montant restant à payer"),d(!0);return}a(""),d(!1);return}}if(e.payment_mode==="online"){u<1e3?(a("Le montant minimum est de 1000 FCFA"),d(!0)):u!==Number(e.amount_total||0)?(a("Le montant à payer doit correspondre au total de la commande"),d(!0)):(a(""),d(!1));return}d(!0)},[e,c,_,l,f]),e?t.jsxs(t.Fragment,{children:[t.jsx($,{title:"CCBM Shop | Détails commande",description:"Consultez les détails de votre commande sur CCBM Shop, votre destination pour l'électroménager de qualité.",keywords:"détails commande, CCBM Shop, ccbme, suivi commande, paiement électroménager"}),t.jsx(B,{childrenClasses:" pt-0 pb-0",children:t.jsxs("div",{className:"checkout-page-wrapper w-full bg-white pb-[60px]",children:[t.jsx("div",{className:"w-full mb-5",children:t.jsx(z,{title:"Détails Commande",breadcrumb:[{name:"Accueil",path:"/"},{name:"Commandes",path:"/profile#order"},{name:"Détails Commande"}]})}),t.jsx("div",{className:"checkout-main-content w-full",children:t.jsxs("div",{className:"container-x mx-auto",children:[t.jsxs("div",{className:"w-full sm:mb-10 mb-5",children:[t.jsxs("div",{className:"sm:flex sm:space-x-[18px]",children:[t.jsx(x,{label:"N°Commande",value:e.name}),e.payment_mode==="domicile"&&t.jsx(x,{label:"Paiement",value:e.advance_payment_status==="not_paid"?"A domicile":"Non Payé",className:e.advance_payment_status==="not_paid"?"text-red-500":"text-green-500"}),e.payment_mode==="online"&&t.jsx(x,{label:"Paiement",value:e.advance_payment_status==="not_paid"?"Non Payé":"Payé",className:e.advance_payment_status==="not_paid"?"text-red-500":"text-green-500"}),e.payment_mode==="echelonne"&&t.jsx(x,{label:"Paiement",value:e.advance_payment_status==="not_paid"?"Non Payé":e.advance_payment_status==="paid"?"Payé":"Partiellement Payé",className:e.advance_payment_status==="not_paid"?"text-red-500":e.advance_payment_status==="paid"?"text-green-500":e.advance_payment_status==="partial"?"text-yellow-500":""}),t.jsx(x,{label:"Statut",value:e.state==="sale"?"Validée":e.state==="to_delivered"?"En cours de livraison":e.state==="delivered"?"Livrée":"Non validé",className:e.state==="sale"?"text-green-500":e.state==="to_delivered"?"text-yellow-500":e.state==="delivered"?"text-green-600":"text-gray-500"})]}),e.payment_mode==="echelonne"&&t.jsx(t.Fragment,{children:t.jsxs("div",{className:"sm:flex sm:space-x-[18px] mt-5",children:[t.jsx(x,{label:"Montant Restant",value:`${n(e.amount_residual)}`}),t.jsx(x,{label:"Montant Total",value:["not_paid","paid"].includes(e.advance_payment_status)?t.jsx("span",{className:`text-${e.advance_payment_status==="not_paid"?"red":"green"}-500`,children:n(e.amount_total)}):t.jsxs(t.Fragment,{children:[" ",n(e.amount_total)]})}),t.jsx(x,{label:"Montant Avancé",value:n(e.amount_total-e.amount_residual)})]})}),t.jsxs("div",{className:"sm:flex sm:space-x-[18px] mt-5",children:[t.jsx(x,{label:"Mode de Paiement",value:e.payment_mode==="online"?"En ligne":e.payment_mode==="domicile"?"A domicile":"Echelonné"}),t.jsx(x,{label:"Date de livraison",value:V(e.commitment_date)})]})]}),t.jsx(G,{commande:e}),t.jsx(H,{commande:e,montantAPayer:c,setMontantAPayer:r=>{const u=Number((e==null?void 0:e.amount_residual)||0),h=Number(r||0),o=Math.min(h,u);if(b(o),f){o<=0?a("Le montant doit être > 0."):a("");return}e.payment_mode==="echelonne"?_?o!==Number(l)?a(`Le montant doit être exactement l'acompte requis (${n(l)}).`):a(""):o<Number(l)?a(`Le montant doit être ≥ ${n(l)}.`):a(""):e.payment_mode==="online"&&(o<1e3?a("Le montant minimum est de 1000 FCFA"):o!==Number(e.amount_total||0)?a("Le montant à payer doit correspondre au total de la commande"):a(""))},errorMontantAPayer:v,stateButton:A,isLoading:C,validerPaiment:F,minAmountToPay:l,acompteDue:_,isTypeOrder:f}),g&&e&&t.jsx(W,{handlePay:S,totalAmount:c,onClose:()=>p(!1),order:e,idOrder:e.id})]})})]})})]}):t.jsxs("div",{className:"flex justify-center items-center",children:[t.jsx(D,{className:"animate-spin mr-2"})," Chargement de la commande..."]})}const x=({label:s,value:m,className:e=""})=>t.jsx("div",{className:"sm:w-1/3 w-full mb-5 h-[70px]",children:t.jsx("div",{className:"w-full h-full bg-[#F6F6F6] text-qblack flex justify-center items-center",children:t.jsxs("span",{className:"text-[15px] font-medium",children:[s,"  : ",t.jsx("span",{className:e,children:m})]})})}),G=({commande:s})=>t.jsxs("div",{className:"w-full max-w-4xl mx-auto px-4 sm:px-6 lg:px-8",children:[t.jsx("h1",{className:"sm:text-2xl text-xl text-qblack font-medium mb-5",children:"Récapitulatif de la commande"}),t.jsxs("div",{className:"w-full p-4 sm:p-6 border border-[#EDEDED] rounded-lg shadow-sm",children:[t.jsx("div",{className:"sub-total mb-6",children:t.jsxs("div",{className:"flex justify-between mb-5",children:[t.jsx("p",{className:"text-[13px] font-medium text-qblack uppercase",children:"Produit"}),s.type_order==="commande"&&t.jsx("p",{className:"text-[13px] font-medium text-qblack uppercase",children:"Total"})]})}),t.jsx("div",{className:"product-list w-full mb-[30px]",children:t.jsx("ul",{className:"flex flex-col space-y-5",children:s.order_lines.map((m,e)=>t.jsx("li",{children:t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsxs("div",{children:[t.jsxs("h4",{className:"text-[15px] text-qblack mb-2.5",children:[m.product_name,t.jsx("sup",{className:"text-[13px] text-qgray ml-2 mt-2",children:s.type_order==="commande"&&t.jsxs("span",{children:[" = ",m.product_uom_qty," x ",n(m.price_total)]})})]}),t.jsx("p",{className:"text-[13px] text-qgray",children:m.description})]}),t.jsx("div",{children:s.type_order==="commande"&&t.jsx("span",{className:"text-[15px] text-qblack font-medium",children:n(m.price_total)})})]})},e))})}),t.jsx("div",{className:"mt-[30px]",children:t.jsxs("div",{className:"flex justify-between mb-5",children:[t.jsx("p",{className:"text-2xl font-medium text-qblack",children:"Total"}),t.jsx("p",{className:"text-2xl font-medium",children:["not_paid","paid"].includes(s.advance_payment_status)&&t.jsx("span",{className:`text-${s.advance_payment_status==="not_paid"?"red":"green"}-500`,children:n(s.amount_total)})})]})})]})]}),H=({commande:s,montantAPayer:m,setMontantAPayer:e,errorMontantAPayer:N,stateButton:C,isLoading:j,validerPaiment:g,minAmountToPay:p,acompteDue:v,isTypeOrder:a})=>t.jsx("div",{className:"w-full max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 mt-8",children:s.advance_payment_status==="not_paid"||s.advance_payment_status==="partial"?t.jsxs(t.Fragment,{children:[s.payment_mode==="domicile"&&t.jsx("div",{className:"flex justify-center items-center mt-2",children:t.jsx("span",{className:"text-lg font-medium text-red-500 dark:text-white",children:"Le paiement se fera à domicile"})}),(s.payment_mode==="echelonne"||a)&&t.jsxs("div",{children:[t.jsxs("div",{className:"input-item mb-5",children:[t.jsx("div",{className:"mb-2 inline-block",children:t.jsx(I,{htmlFor:"montant",value:"Montant à payer"})}),t.jsx(O,{id:"montant",placeholder:a?"Montant libre (> 0)":v?`Acompte requis: ${n(p)}`:"Minimum 1000 F CFA",label:"Montant*",name:"montantAPayer",type:"number",value:m,onChange:c=>e(c.target.value),max:s.amount_residual,min:a?1:v?Number(p):0,required:!0,className:"invalid:border-red-500 invalid:text-red-600 focus:invalid:border-red-500 focus:invalid:ring-red-500"}),N&&t.jsx("p",{className:"text-yellow-500",children:N})]}),t.jsxs(P,{type:"submit",onClick:c=>g(c,m),className:"rounded-lg px-5 py-2.5 font-medium w-full hover:bg-red-500 hover:text-white text-xl",disabled:C,children:[j&&t.jsx(q,{className:"mr-2 h-4 w-4 animate-spin"}),"Passer à la caisse (",n(m),")"]}),t.jsx("p",{className:"mt-2 text-xs text-gray-500 text-center",children:a?t.jsxs(t.Fragment,{children:["Paiement libre : choisissez le montant que vous souhaitez (strictement > 0), jusqu’à ",t.jsx("strong",{children:n(s.amount_residual)})," restant."]}):v?t.jsxs(t.Fragment,{children:["Acompte requis : ",t.jsx("strong",{children:n(p)}),". Vous devrez solder l’acompte avant de pouvoir payer librement."]}):t.jsxs(t.Fragment,{children:["Paiement libre : choisissez le montant que vous souhaitez (minimum ",t.jsx("strong",{children:n(Math.max(1e3,Number(p)||0))}),"), jusqu’à ",t.jsx("strong",{children:n(s.amount_residual)})," restant."]})})]}),s.payment_mode==="online"&&!a&&t.jsxs(P,{type:"submit",onClick:c=>g(c,s.amount_total),className:"rounded-lg px-5 py-2.5 font-medium w-full hover:bg-red-500 hover:text-white text-xl",disabled:j,children:[j&&t.jsx(q,{className:"mr-2 h-4 w-4 animate-spin"}),"Passer à la caisse (",n(s.amount_total),")"]})]}):t.jsx("div",{className:"w-full h-[50px] flex justify-center items-center",children:t.jsx("span",{className:"text-green-500",children:"Le paiement a été effectué avec succès"})})});export{U as default};
