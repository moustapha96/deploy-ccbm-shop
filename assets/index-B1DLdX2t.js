import{c as R,u as q,j as e,m as L,L as $,p as H,f as i,t as f,E as G,a0 as F,$ as S,U as J,a3 as M,B as x}from"./index-DUaE-c6P.js";import{m as X,u as K,b as d,L as V}from"./vendor-Bb8_f6lk.js";import{f as B}from"./date-format-qL-o8H-f.js";/**
 * @license lucide-react v0.400.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q=R("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);function ee(){const{id:o}=X(),u=K(),{user:b}=q(),[s,k]=d.useState(null),[C,P]=d.useState(!0),[A,D]=d.useState(!1),[h,N]=d.useState(""),[E,I]=d.useState(""),[l,y]=d.useState(null);d.useEffect(()=>{(async()=>{if(!o){u("/vente-en-cher");return}P(!0);try{const a=await M.getVenteCherById(o);if(k(a),a.current_price){const m=Math.max(1e3,Math.floor(a.current_price*.05));N((a.current_price+m).toString())}}catch(a){console.error("Erreur lors de la récupération de la vente en cher",a),x.error("Impossible de charger la vente en cher"),u("/vente-en-cher")}finally{P(!1)}})()},[o,u]),d.useEffect(()=>{if(!(s!=null&&s.end_datetime)||s.state!=="open"){y(null);return}const t=()=>{const m=new Date().getTime(),c=new Date(s.end_datetime).getTime()-m;if(c<=0){y({days:0,hours:0,minutes:0,seconds:0,expired:!0});return}const n=Math.floor(c/(1e3*60*60*24)),p=Math.floor(c%(1e3*60*60*24)/(1e3*60*60)),U=Math.floor(c%(1e3*60*60)/(1e3*60)),O=Math.floor(c%(1e3*60)/1e3);y({days:n,hours:p,minutes:U,seconds:O,expired:!1})};t();const a=setInterval(t,1e3);return()=>clearInterval(a)},[s==null?void 0:s.end_datetime,s==null?void 0:s.state]);const z=async t=>{var _,c;if(t.preventDefault(),!b){x.info("Vous devez être connecté pour miser"),u("/login");return}if(!h||parseFloat(h)<=0){x.error("Veuillez entrer un montant valide");return}const a=parseFloat(h),m=(s==null?void 0:s.current_price)||(s==null?void 0:s.start_price)||0;if(a<=m){x.error(`Votre mise doit être supérieure au prix actuel (${i(m)})`);return}D(!0);try{await M.createBid(o,{partner_id:b.id,amount:a,note:E||""}),x.success("Votre mise a été enregistrée avec succès !"),I("");const n=await M.getVenteCherById(o);if(k(n),n.current_price){const p=Math.max(1e3,Math.floor(n.current_price*.05));N((n.current_price+p).toString())}}catch(n){console.error("Erreur lors de la création de la mise",n);const p=((c=(_=n.response)==null?void 0:_.data)==null?void 0:c.error)||n.message||"Impossible de créer la mise";x.error(p)}finally{D(!1)}};if(C)return e.jsx(L,{children:e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx($,{className:"animate-spin h-8 w-8"})})});if(!s)return null;const r=s.product||{},v=s.bids||[],g=s.state==="open",T=s.state==="closed"||s.state==="cancelled",j=s.current_price||s.start_price||0,w=j+Math.max(1e3,Math.floor(j*.05));return e.jsx(L,{children:e.jsx("div",{className:"vente-cher-detail-wrapper w-full",children:e.jsxs("div",{className:"container-x mx-auto",children:[e.jsx(H,{paths:[{name:"Accueil",path:"/"},{name:"Vente en cher",path:"/vente-en-cher"},{name:s.name||"Détail",path:`/vente-cher/${o}`}]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 mt-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsx("div",{className:"bg-white p-6 rounded-lg shadow-md",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-6",children:[e.jsx("div",{className:"flex-shrink-0",children:r.image_256?e.jsx("img",{src:`data:image/png;base64,${r.image_256}`,alt:r.name||"Produit",className:"w-full md:w-64 h-64 object-contain bg-gray-50 rounded-lg cursor-pointer hover:opacity-90 transition-opacity",onClick:()=>r.id&&u(`/produits/${r.id}/details`)}):e.jsx("div",{className:"w-full md:w-64 h-64 bg-gray-200 rounded-lg flex items-center justify-center",children:e.jsx("span",{className:"text-gray-400",children:"Pas d'image"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"text-2xl font-bold mb-2",children:r.name||r.display_name}),r.categ_id&&e.jsxs("p",{className:"text-gray-600 mb-2",children:["Catégorie: ",r.categ_id]}),r.tags&&Array.isArray(r.tags)&&r.tags.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"Tags:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:r.tags.map(t=>e.jsx("span",{className:"inline-block px-3 py-1 bg-blue-100 text-blue-800 text-sm font-medium rounded-full",children:t.name},t.id))})]}),e.jsx("div",{className:"grid grid-cols-2 gap-4 my-4 p-4 bg-gray-50 rounded-lg",children:r.list_price>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Prix catalogue"}),e.jsxs("p",{className:"text-lg font-semibold text-gray-900",children:[i(r.list_price)," XOF"]})]})}),r.description&&e.jsx("p",{className:"text-gray-700 mt-4 mb-4 line-clamp-3",children:r.description}),r.id&&e.jsx(V,{to:`/produits/${r.id}/details`,children:e.jsxs(f,{className:"bg-bleu-logo hover:bg-blue-700 flex items-center gap-2 mt-4",children:[e.jsx(G,{className:"w-4 h-4"}),"Voir les détails complets du produit"]})})]})]})}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-md",children:[e.jsxs("h2",{className:"text-xl font-bold mb-4 flex items-center gap-2",children:[e.jsx(F,{className:"w-5 h-5"}),"Informations de la vente"]}),g&&l&&!l.expired&&e.jsxs("div",{className:"mb-6 p-4 bg-red-50 border-2 border-red-200 rounded-lg",children:[e.jsxs("p",{className:"text-sm font-semibold text-red-900 mb-3 flex items-center gap-2",children:[e.jsx(S,{className:"w-4 h-4"}),"Temps restant"]}),e.jsxs("div",{className:"flex gap-4 justify-center",children:[l.days>0&&e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-red-600",children:String(l.days).padStart(2,"0")}),e.jsx("div",{className:"text-xs text-red-700 uppercase",children:"Jours"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-red-600",children:String(l.hours).padStart(2,"0")}),e.jsx("div",{className:"text-xs text-red-700 uppercase",children:"Heures"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-red-600",children:String(l.minutes).padStart(2,"0")}),e.jsx("div",{className:"text-xs text-red-700 uppercase",children:"Minutes"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-red-600",children:String(l.seconds).padStart(2,"0")}),e.jsx("div",{className:"text-xs text-red-700 uppercase",children:"Secondes"})]})]})]}),g&&l&&l.expired&&e.jsx("div",{className:"mb-6 p-4 bg-gray-100 border-2 border-gray-300 rounded-lg text-center",children:e.jsx("p",{className:"text-lg font-semibold text-gray-700",children:"La vente est terminée"})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Prix de départ"}),e.jsxs("p",{className:"text-lg font-semibold text-gray-900",children:[i(s.start_price||0)," ",s.currency]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Prix actuel"}),e.jsxs("p",{className:"text-2xl font-bold text-bleu-logo",children:[i(j)," ",s.currency]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Nombre de mises"}),e.jsx("p",{className:"text-lg font-semibold",children:s.bid_count||0})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"État"}),e.jsxs("span",{className:`inline-block px-3 py-1 rounded-full text-sm font-semibold ${g?"bg-green-100 text-green-800":T?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"}`,children:[s.state==="open"&&"Ouverte",s.state==="closed"&&"Fermée",s.state==="cancelled"&&"Annulée",s.state==="draft"&&"Brouillon"]})]}),s.start_datetime&&e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-gray-600 flex items-center gap-1",children:[e.jsx(S,{className:"w-4 h-4"}),"Début"]}),e.jsx("p",{className:"text-sm font-semibold",children:B(s.start_datetime)})]}),s.end_datetime&&e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-gray-600 flex items-center gap-1",children:[e.jsx(S,{className:"w-4 h-4"}),"Fin"]}),e.jsx("p",{className:"text-sm font-semibold",children:B(s.end_datetime)})]})]})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-md",children:[e.jsxs("h2",{className:"text-xl font-bold mb-4 flex items-center gap-2",children:[e.jsx(Q,{className:"w-5 h-5"}),"Historique des mises (",v.length,")"]}),v.length===0?e.jsx("p",{className:"text-gray-500 text-center py-8",children:"Aucune mise pour le moment. Soyez le premier à miser !"}):e.jsx("div",{className:"space-y-3",children:v.sort((t,a)=>a.amount!==t.amount?a.amount-t.amount:new Date(a.create_date)-new Date(t.create_date)).map((t,a)=>e.jsx("div",{className:`p-4 rounded-lg border ${a===0?"bg-green-50 border-green-200":"bg-gray-50 border-gray-200"}`,children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(J,{className:"w-4 h-4 text-gray-600"}),e.jsx("span",{className:"font-semibold",children:"Anonyme"}),a===0&&e.jsx("span",{className:"text-xs bg-green-500 text-white px-2 py-1 rounded",children:"Meilleure offre"})]}),t.note&&e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:t.note}),t.create_date&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:B(t.create_date)})]}),e.jsx("div",{className:"text-right",children:e.jsxs("p",{className:"text-lg font-bold text-bleu-logo",children:[i(t.amount)," ",t.currency||s.currency]})})]})},t.id))})]})]}),e.jsx("div",{className:"lg:col-span-1",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-md sticky top-4",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Faire une mise"}),g?b?e.jsxs("form",{onSubmit:z,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Montant de votre mise (minimum: ",i(w)," ",s.currency,")"]}),e.jsx("input",{type:"number",min:w,step:"1000",value:h,onChange:t=>N(t.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-bleu-logo focus:border-transparent",placeholder:`Minimum: ${i(w)}`,required:!0}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Prix actuel: ",i(j)," ",s.currency]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Note (optionnel)"}),e.jsx("textarea",{value:E,onChange:t=>I(t.target.value),rows:3,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-bleu-logo focus:border-transparent",placeholder:"Ajoutez une note à votre mise..."})]}),e.jsx(f,{type:"submit",className:"w-full bg-bleu-logo hover:bg-blue-700",disabled:A,children:A?e.jsxs(e.Fragment,{children:[e.jsx($,{className:"animate-spin mr-2 h-4 w-4"}),"Envoi en cours..."]}):e.jsxs(e.Fragment,{children:[e.jsx(F,{className:"mr-2 h-4 w-4"}),"Placer ma mise"]})}),e.jsx("p",{className:"text-xs text-gray-500 text-center",children:"En plaçant une mise, vous acceptez les conditions de la vente en cher."})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-gray-600 mb-4",children:"Vous devez être connecté pour miser."}),e.jsx(V,{to:"/login",children:e.jsx(f,{className:"w-full bg-bleu-logo",children:"Se connecter"})})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsxs("p",{className:"text-gray-600 mb-4",children:["Cette vente en cher est ",T?"fermée":"non disponible","."]}),e.jsx(V,{to:"/vente-en-cher",children:e.jsx(f,{className:"w-full bg-bleu-logo",children:"Voir les autres ventes"})})]})]})})]})]})})})}export{ee as default};
