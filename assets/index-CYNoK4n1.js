import{u as O,B as o,j as e,k as H,l as W,A as U,m as E,f as a,D as X,T as G,s as J,y as L,F as K}from"./index-BI9smu61.js";import{m as Q,c as Y,u as Z,b as l}from"./vendor-Cppah_1b.js";import{g as ee}from"./creditCommandeService-hfqRTjD7.js";import{f as F}from"./date-format-qL-o8H-f.js";import{W as se}from"./wave-orange-payment-service-Bw_1cY_9.js";import{T}from"./truck-DrprSTaD.js";function ie(){const{id:v}=Q(),j=Y(),P=Z(),{user:x}=O(),[s,z]=l.useState(null),[p,D]=l.useState(!0),[w,k]=l.useState(!1),[c,q]=l.useState(0),[A,f]=l.useState(""),[B,N]=l.useState(!1),M=t=>{if(!t)return"En cours";switch(String(t).toLowerCase()){case"pending":return"En cours de validation";case"validated":return"Validé";case"rejected":return"Rejeté";default:return"En cours"}},S=t=>{if(!t)return e.jsx(T,{className:"w-5 h-5 text-blue-500"});switch(String(t).toLowerCase()){case"pending":return e.jsx(L,{className:"w-5 h-5 text-yellow-500"});case"validated":return e.jsx(K,{className:"w-5 h-5 text-green-500"});case"rejected":return e.jsx(L,{className:"w-5 h-5 text-red-500"});default:return e.jsx(T,{className:"w-5 h-5 text-blue-500"})}},y=l.useCallback(async()=>{if(!(!(x!=null&&x.id)||!v))try{k(!0);const t=await ee(x.id,v);z(t)}catch(t){console.error(t),o.error("Impossible de charger les détails de la commande")}finally{D(!1),k(!1)}},[x==null?void 0:x.id,v]);l.useEffect(()=>{y()},[y]);const u=l.useMemo(()=>!(s!=null&&s.payment_lines)||!Array.isArray(s.payment_lines)?null:s.payment_lines.find(t=>t.sequence===1)||s.payment_lines[0]||null,[s]),m=l.useMemo(()=>Number((u==null?void 0:u.amount)||0),[u]),d=l.useMemo(()=>u?!u.state:!1,[u]),i=l.useMemo(()=>{const t=Number((s==null?void 0:s.amount_residual)||0);return t<=0?0:Math.min(50,t)},[s==null?void 0:s.amount_residual]);l.useEffect(()=>{!p&&s&&(q(d?m:i),f(""))},[p,s,d,m,i]);const R=()=>{if(!d&&c<50){o.warning("Le montant doit être supérieur à 50 F CFA");return}N(!0)},V=t=>{t.preventDefault();const n=Number((s==null?void 0:s.amount_residual)||0),r=Number(c||0);if(n<=0){o.info("Aucun montant restant à payer.");return}if(d){if(r<m){o.warning(`Le montant doit être au moins l'acompte requis (${a(m)}).`,{position:"top-center",autoClose:5e3});return}if(r>n){o.warning("Le montant à payer ne doit pas dépasser le montant restant à payer.",{position:"top-center",autoClose:5e3});return}}else{if(r<i){o.warning(`Le montant doit être ≥ ${a(i)}.`,{position:"top-center",autoClose:5e3});return}if(r>n){o.warning("Le montant à payer ne doit pas dépasser le montant restant à payer.",{position:"top-center",autoClose:5e3});return}}N(!0)},h=l.useCallback(async()=>{N(!1),await y(),o.success("Paiement confirmé, page mise à jour.")},[y]);l.useEffect(()=>{const t=n=>{if(n.key==="statusOrderPayment"){const r=(n.newValue||"").replace(/"/g,"");["succeeded","completed","paid","success"].includes(r)&&h()}};return window.addEventListener("storage",t),()=>window.removeEventListener("storage",t)},[h]),l.useEffect(()=>{if(new URLSearchParams(j.search).get("payment")==="success"){const n=j.pathname;P(n,{replace:!0}),h()}},[j.search,j.pathname,P,h]);const g=(s==null?void 0:s.validation_rh_state)==="validated"&&(s==null?void 0:s.validation_admin_state)==="validated",_=Number((s==null?void 0:s.amount_residual)||0),b=_<=0,$=!g||b,I=p||!g||b||(d?Number(c)<m||Number(c)>_:Number(c)<i||Number(c)>_);return e.jsxs(e.Fragment,{children:[e.jsx(H,{title:"CCBM Shop | Détails Commande à Crédit",description:"Découvrez les meilleures offres sur CCBM Shop, votre destination privilégiée pour l'électroménager de qualité. Explorez nos produits allant des réfrigérateurs aux téléviseurs intelligents, et profitez de promotions exclusives !",keywords:"électroménager, boutique en ligne d'électroménager, CCBM Shop, ccbme, appareils électroménagers à prix réduits, smart TV, réfrigérateurs modernes, climatiseurs efficaces, promotions électroménager"}),e.jsx(W,{childrenClasses:"pt-0 pb-0",children:e.jsxs("div",{className:"checkout-page-wrapper w-full bg-white pb-[60px]",children:[e.jsx("div",{className:"w-full mb-5",children:e.jsx(U,{title:"Détails Commande à Crédit",breadcrumb:[{name:"Accueil",path:"/"},{name:"Commande à Crédits",path:"/profile#commandes-a-credit"},{name:"Détails Commande à crédit "}]})}),p&&e.jsx(E,{className:"mr-2 h-4 w-4 animate-spin"}),s&&e.jsx("div",{className:"checkout-main-content w-full",children:e.jsxs("div",{className:"container-x mx-auto",children:[e.jsxs("div",{className:"w-full sm:mb-10 mb-5",children:[e.jsxs("div",{className:"sm:flex sm:space-x-[18px]",children:[e.jsx("div",{className:"sm:w-1/3 w-full mb-5 h-[70px]",children:e.jsx("div",{className:"w-full h-full bg-[#F6F6F6] text-qblack flex justify-center items-center",children:e.jsxs("span",{className:"text-[15px] font-medium",children:["N°Commande à Crédit ",e.jsx("span",{children:s.name})]})})}),e.jsx("div",{className:" sm:w-1/3  flex-1 h-[70px]",children:e.jsx("div",{className:"w-full h-full bg-[#F6F6F6] text-qblack flex justify-center items-center",children:e.jsxs("span",{className:"text-[15px] font-medium",children:["Paiement :"," ",s.advance_payment_status==="not_paid"&&e.jsx("span",{className:"text-red-500",children:"Non Payé"}),s.advance_payment_status==="paid"&&e.jsx("span",{className:"text-green-500",children:" Payé "}),s.advance_payment_status==="partial"&&e.jsx("span",{className:"text-yellow-500",children:" Partiellement Payé"})]})})}),e.jsx("div",{className:"sm:w-1/3 flex-1 h-[70px]",children:e.jsxs("div",{className:"w-full h-full bg-[#F6F6F6] text-qblack flex flex-col sm:flex-row justify-center items-center p-3 sm:p-0",children:[e.jsx("strong",{children:" Statut : "})," ",e.jsx("div",{className:"flex flex-col sm:flex-row items-center mt-2 sm:mt-0 sm:ml-2",children:e.jsxs("span",{className:"mt-1 sm:mt-0 sm:ml-2 capitalize",children:[s.state==="sale"&&e.jsx("span",{className:"text-green-500",children:"Validé"}),s.state==="draft"&&e.jsx("span",{className:"text-yellow-500",children:"En cours de traitement"}),s.state==="cancel"&&e.jsx("span",{className:"text-yellow-500",children:"Annulée"}),s.state==="delivered"&&e.jsx("span",{className:"text-green-600",children:"Livrée"}),s.state==="to_delivered"&&e.jsx("span",{className:"text-yellow-500",children:"En cours de livraison"}),s.state==="validation"&&e.jsx("span",{className:"text-yellow-500",children:"En cours de validation"})]})})]})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:space-x-[18px] space-y-5 sm:space-y-0 mb-5",children:[e.jsx("div",{className:"w-full sm:w-1/2 h-auto sm:h-[70px]",children:e.jsxs("div",{className:"w-full h-full bg-[#F6F6F6] text-qblack flex flex-col sm:flex-row justify-center items-center p-3 sm:p-0",children:[e.jsx("strong",{children:"Validation RH"}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center mt-2 sm:mt-0 sm:ml-2",children:[e.jsx("span",{className:"hidden sm:inline-block",children:S(s.validation_rh_state)}),e.jsx("span",{className:"mt-1 sm:mt-0 sm:ml-2 capitalize",children:M(s.validation_rh_state)})]})]})}),e.jsx("div",{className:"w-full sm:w-1/2 h-auto sm:h-[70px]",children:e.jsxs("div",{className:"w-full h-full bg-[#F6F6F6] text-qblack flex flex-col sm:flex-row justify-center items-center p-3 sm:p-0",children:[e.jsx("strong",{children:"Approbation CCBM"}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center mt-2 sm:mt-0 sm:ml-2",children:[e.jsx("span",{className:"hidden sm:inline-block",children:S(s.validation_admin_state)}),e.jsx("span",{className:"mt-1 sm:mt-0 sm:ml-2 capitalize",children:M(s.validation_admin_state)})]})]})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:space-x-[18px] space-y-5 sm:space-y-0 mb-5",children:[e.jsx("div",{className:"w-full sm:w-1/2 h-auto sm:h-[70px]",children:e.jsxs("div",{className:"w-full h-full bg-[#F6F6F6] text-qblack flex flex-col sm:flex-row justify-center items-center p-3 sm:p-0",children:[e.jsx("strong",{children:" Date commande "}),e.jsx("div",{className:"flex flex-col sm:flex-row items-center mt-2 sm:mt-0 sm:ml-2",children:e.jsx("span",{className:"mt-1 sm:mt-0 sm:ml-2 capitalize",children:F(s.date_order)})})]})}),e.jsx("div",{className:"w-full sm:w-1/2 h-auto sm:h-[70px]",children:e.jsxs("div",{className:"w-full h-full bg-[#F6F6F6] text-qblack flex flex-col sm:flex-row justify-center items-center p-3 sm:p-0",children:[e.jsx("strong",{children:"Date de livraison"}),e.jsx("div",{className:"flex flex-col sm:flex-row items-center mt-2 sm:mt-0 sm:ml-2",children:e.jsx("span",{className:"mt-1 sm:mt-0 sm:ml-2 capitalize",children:F(s.commitment_date)})})]})})]}),e.jsxs("div",{className:"sm:flex sm:space-x-[18px]",children:[e.jsx("div",{className:"sm:w-1/2 w-full mb-5 h-[70px]",children:e.jsxs("div",{className:"w-full h-full bg-[#F6F6F6] text-qblack flex flex-col sm:flex-row justify-center items-center p-3 sm:p-0",children:[e.jsx("strong",{children:" Total Payé  "}),e.jsx("div",{className:"flex flex-col sm:flex-row items-center mt-2 sm:mt-0 sm:ml-2",children:e.jsx("span",{className:"mt-1 sm:mt-0 sm:ml-2 capitalize",children:a(s.amount_total-s.amount_residual)})})]})}),e.jsx("div",{className:"flex-1 h-[70px]",children:e.jsxs("div",{className:"w-full h-full bg-[#F6F6F6] text-qblack flex flex-col sm:flex-row justify-center items-center p-3 sm:p-0",children:[e.jsx("strong",{children:" Total Restant   "}),e.jsx("div",{className:"flex flex-col sm:flex-row items-center mt-2 sm:mt-0 sm:ml-2",children:e.jsx("span",{className:"mt-1 sm:mt-0 sm:ml-2 capitalize",children:a(s.amount_residual)})})]})})]})]}),e.jsxs("div",{className:"w-full max-w-4xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl text-qblack font-medium mb-5 text-center",children:"Récapitulatif de la commande"}),e.jsx("div",{className:"w-full p-4 sm:p-6 border border-[#EDEDED] rounded-lg shadow-sm",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center border-b pb-4",children:[e.jsx("p",{className:"text-sm font-medium text-qblack uppercase",children:"Produit"}),e.jsx("p",{className:"text-sm font-medium text-qblack uppercase",children:"Total"})]}),e.jsx("div",{className:"space-y-4",children:Array.isArray(s.order_lines)&&s.order_lines.map((t,n)=>e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("h4",{className:"text-sm sm:text-base text-qblack mb-1",children:[t.product_name,e.jsxs("sup",{className:"text-xs text-qgray ml-1",children:["x ",t.product_uom_qty]})]}),!!t.description&&e.jsx("p",{className:"text-xs sm:text-sm text-qgray",children:t.description})]}),e.jsx("span",{className:"text-sm sm:text-base text-qblack font-medium",children:a(t.price_total)})]},n))}),e.jsxs("div",{className:"border-t pt-4 space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("dt",{className:"text-sm text-gray-500",children:["Mode crédit : ",s.creditorder_month_count," paiement(s)"]}),e.jsxs("dd",{className:"text-sm text-gray-900 font-medium",children:["Total: ",a(s.amount_total)]})]}),Array.isArray(s.payment_lines)&&s.payment_lines.map((t,n)=>{var r;return e.jsxs("dl",{className:"flex flex-wrap items-center justify-between gap-2",children:[e.jsxs("dt",{className:"text-sm text-gray-500",children:[`Paiement ${n+1}`,t.due_date&&e.jsxs("span",{className:"ml-2 text-xs text-gray-400",children:["(échéance: ",F(t.due_date),")"]})]}),e.jsxs("dd",{className:`text-sm sm:text-base font-medium ${t.state?"text-green-600":"text-gray-900"}`,children:[a(t.amount)," ",t.state?"✓":""]})]},(r=t.sequence)!=null?r:n)})]}),e.jsxs("div",{className:"border-t pt-4 space-y-2",children:[e.jsxs("dl",{className:"flex items-center justify-between gap-2",children:[e.jsx("dt",{className:"text-base sm:text-lg font-bold text-gray-900",children:"Total à payer"}),e.jsx("dd",{className:"text-base sm:text-lg font-bold text-gray-900",children:a(s.amount_total)})]}),e.jsxs("dl",{className:"flex items-center justify-between gap-2",children:[e.jsx("dt",{className:"text-base sm:text-lg font-bold text-gray-900",children:"Total Payé"}),e.jsx("dd",{className:"text-base sm:text-lg font-bold text-green-600",children:a(s.amount_total-s.amount_residual)})]}),e.jsxs("dl",{className:"flex items-center justify-between gap-2",children:[e.jsx("dt",{className:"text-base sm:text-lg font-bold text-gray-900",children:"Total Restant"}),e.jsx("dd",{className:"text-base sm:text-lg font-bold text-gray-900",children:a(s.amount_residual)})]})]}),g&&!b?e.jsxs("div",{className:"mt-6",children:[e.jsx(X,{htmlFor:"montant",children:"Montant à payer"}),e.jsx(G,{id:"montant",type:"number",value:c,disabled:$,onChange:t=>{const n=Number((s==null?void 0:s.amount_residual)||0),r=Number(t.target.value||0),C=Math.min(r,n);q(C),d?C<m?f(`Le montant doit être au moins l'acompte requis (${a(m)}).`):f(""):C<i?f(`Le montant doit être ≥ ${a(i)}.`):f("")},min:d?m:i,max:s.amount_residual,placeholder:d?`Acompte minimum: ${a(m)} (vous pouvez payer plus)`:`Minimum ${a(i)}`,className:"mt-1"}),A&&e.jsx("p",{className:"text-red-500 mt-1",children:A}),e.jsxs(J,{onClick:V,className:"mt-4 w-full",disabled:I||w,children:[(p||w)&&e.jsx(E,{className:"mr-2 h-4 w-4 animate-spin"}),w?"Mise à jour...":`Passer à la caisse (${a(c)})`]}),d?e.jsxs("p",{className:"mt-2 text-xs text-gray-500 text-center",children:["Acompte requis : ",e.jsx("strong",{children:a(m)})," minimum. Vous pouvez payer ",e.jsx("em",{children:"au moins"})," l’acompte (et plus si vous voulez), sans dépasser le restant."]}):e.jsxs("p",{className:"mt-2 text-xs text-gray-500 text-center",children:["Paiement libre : choisissez le montant que vous souhaitez (minimum"," ",e.jsx("strong",{children:a(i)}),"), jusqu’à"," ",e.jsx("strong",{children:a(s.amount_residual)})," restant."]})]}):e.jsxs(e.Fragment,{children:[!g&&e.jsx("p",{className:"text-yellow-500 mt-4 text-center text-base sm:text-xl",children:"Merci d'attendre la validation de la commande à crédit par la RH et CCBM"}),b&&e.jsx("p",{className:"text-green-600 mt-4 text-center text-base sm:text-xl",children:"Votre paiement est déjà réglé"})]})]})}),B&&s&&e.jsx(se,{handlePay:R,totalAmount:c,onClose:()=>N(!1),order:s,idOrder:s.id,onSuccess:h})]})]})}),!s&&e.jsx("div",{className:"flex justify-center items-center ",children:"Commande à Crédit non trouvée"})]})})]})}export{ie as default};
